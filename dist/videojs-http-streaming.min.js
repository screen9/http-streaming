/*! @name @videojs/http-streaming @version 1.11.0-alpha.1 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("global/document"),require("global/window"),require("video.js")):"function"==typeof define&&define.amd?define(["exports","global/document","global/window","video.js"],e):e((t=t||self).httpStreaming={},t.document,t.window,t.videojs)}(this,function(t,e,i,n){"use strict";function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n;var s,o=(function(t,e){var i,n,r,a,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var r=s.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=n.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var l=o.path,h=l.substring(0,l.lastIndexOf("/")+1)+a.path;d.path=s.normalizePath(h)}else d.path=o.path,a.params||(d.params=o.params,a.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(d)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(r,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s}(s={exports:{}}),s.exports),u=function(t,e){return/^[a-z]+:/i.test(e)?e:(/\/\//i.test(t)||(t=o.buildAbsoluteURL(i.location.href,t)),o.buildAbsoluteURL(t,e))},d=function(t,e,i){return t&&i.responseURL&&e!==i.responseURL?i.responseURL:e};
/*! @name m3u8-parser @version 4.4.0 @license Apache-2.0 */
function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var c=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t].splice(i,1),i>-1},e.trigger=function(t){var e,i,n,r=this.listeners[t];if(r)if(2===arguments.length)for(i=r.length,e=0;e<i;++e)r[e].call(this,arguments[1]);else for(n=Array.prototype.slice.call(arguments,1),i=r.length,e=0;e<i;++e)r[e].apply(this,n)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),f=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return h(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(c),p=function(t){for(var e,i=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},r=i.length;r--;)""!==i[r]&&((e=/([^=]*)=(.*)/.exec(i[r]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),n[e[0]]=e[1]);return n},m=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}h(e,t);var i=e.prototype;return i.push=function(t){var e,i,n=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce(function(e,i){var n=i(t);return n===t?e:e.concat([n])},[t]).forEach(function(t){for(var r=0;r<n.customParsers.length;r++)if(n.customParsers[r].call(n,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))n.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return i={type:"tag",tagType:"inf"},e[1]&&(i.duration=parseFloat(e[1])),e[2]&&(i.title=e[2]),void n.trigger("data",i);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"targetduration"},e[1]&&(i.duration=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"totalduration"},e[1]&&(i.duration=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"version"},e[1]&&(i.version=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"media-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return i={type:"tag",tagType:"playlist-type"},e[1]&&(i.playlistType=e[1]),void n.trigger("data",i);if(e=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"byterange"},e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),void n.trigger("data",i);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return i={type:"tag",tagType:"allow-cache"},e[1]&&(i.allowed=!/NO/.test(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"map"},e[1]){var a=p(e[1]);if(a.URI&&(i.uri=a.URI),a.BYTERANGE){var s=a.BYTERANGE.split("@"),o=s[0],u=s[1];i.byterange={},o&&(i.byterange.length=parseInt(o,10)),u&&(i.byterange.offset=parseInt(u,10))}}n.trigger("data",i)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"stream-inf"},e[1]){if(i.attributes=p(e[1]),i.attributes.RESOLUTION){var d=i.attributes.RESOLUTION.split("x"),l={};d[0]&&(l.width=parseInt(d[0],10)),d[1]&&(l.height=parseInt(d[1],10)),i.attributes.RESOLUTION=l}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}n.trigger("data",i)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return i={type:"tag",tagType:"media"},e[1]&&(i.attributes=p(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-ENDLIST/.exec(t))n.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))n.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return i={type:"tag",tagType:"program-date-time"},e[1]&&(i.dateTimeString=e[1],i.dateTimeObject=new Date(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return i={type:"tag",tagType:"key"},e[1]&&(i.attributes=p(e[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void n.trigger("data",i);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return i={type:"tag",tagType:"start"},e[1]&&(i.attributes=p(e[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out-cont"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-in"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);n.trigger("data",{type:"tag",data:t.slice(4)})}}}else n.trigger("data",{type:"comment",text:t.slice(1)})}):this.trigger("data",{type:"uri",uri:t}))},i.addParser=function(t){var e=this,i=t.expression,n=t.customType,r=t.dataParser,a=t.segment;"function"!=typeof r&&(r=function(t){return t}),this.customParsers.push(function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:r(t),customType:n,segment:a}),!0})},i.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push(function(t){return e.test(t)?i(t):t})},e}(c);function g(t){for(var e=i.atob(t||""),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}var y,_,v,b,T,S,I=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new f,e.parseStream=new m,e.lineStream.pipe(e.parseStream);var i,n,r=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e),a=[],s={},o={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},u=0;return e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},e.parseStream.on("data",function(t){var e,d;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(s.byterange=e,e.length=t.length,"offset"in t||(this.trigger("info",{message:"defaulting offset to zero"}),t.offset=0)),"offset"in t&&(s.byterange=e,e.offset=t.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(s.duration=t.duration),0===t.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:g(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(n.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else n=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,u=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){i={},t.uri&&(i.uri=t.uri),t.byterange&&(i.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||o,t.attributes?(s.attributes||(s.attributes={}),l(s.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||o,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var i=this.manifest.mediaGroups[t.attributes.TYPE];i[t.attributes["GROUP-ID"]]=i[t.attributes["GROUP-ID"]]||{},e=i[t.attributes["GROUP-ID"]],(d={default:/yes/i.test(t.attributes.DEFAULT)}).default?d.autoselect=!0:d.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(d.language=t.attributes.LANGUAGE),t.attributes.URI&&(d.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(d.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(d.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(d.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=d}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){u+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),s.dateTimeString=t.dateTimeString,s.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):this.manifest.targetDuration=t.duration},totalduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+t.duration}):this.manifest.totalDuration=t.duration},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){s.cueOut=t.data},"cue-out-cont":function(){s.cueOutCont=t.data},"cue-in":function(){s.cueIn=t.data}}[t.tagType]||function(){}).call(r)},uri:function(){s.uri=t.uri,a.push(s),!this.manifest.targetDuration||"duration"in s||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),n&&(s.key=n),s.timeline=u,i&&(s.map=i),s={}},comment:function(){},custom:function(){t.segment?(s.custom=s.custom||{},s.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(r)}),e}h(e,t);var i=e.prototype;return i.push=function(t){this.lineStream.push(t)},i.end=function(){this.lineStream.push("\n")},i.addParser=function(t){this.parseStream.addParser(t)},i.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(c),w=n.mergeOptions,A=n.EventTarget,L=n.log,U=function(t,e){["AUDIO","SUBTITLES"].forEach(function(i){for(var n in t.mediaGroups[i])for(var r in t.mediaGroups[i][n]){var a=t.mediaGroups[i][n][r];e(a,i,n,r)}})},E=function(t,e){var i=w(t,{}),n=i.playlists[e.uri];if(!n)return null;if(n.segments&&e.segments&&n.segments.length===e.segments.length&&n.endList===e.endList&&n.mediaSequence===e.mediaSequence)return null;var r=w(n,e);n.segments&&(r.segments=function(t,e,i){var n=e.slice();i=i||0;for(var r=Math.min(t.length,e.length+i),a=i;a<r;a++)n[a-i]=w(t[a],n[a-i]);return n}(n.segments,e.segments,e.mediaSequence-n.mediaSequence)),r.segments.forEach(function(t){!function(t,e){t.resolvedUri||(t.resolvedUri=u(e,t.uri)),t.key&&!t.key.resolvedUri&&(t.key.resolvedUri=u(e,t.key.uri)),t.map&&!t.map.resolvedUri&&(t.map.resolvedUri=u(e,t.map.uri))}(t,r.resolvedUri)});for(var a=0;a<i.playlists.length;a++)i.playlists[a].uri===e.uri&&(i.playlists[a]=r);return i.playlists[e.uri]=r,i},k=function(t){for(var e=t.playlists.length;e--;){var i=t.playlists[e];t.playlists[i.uri]=i,i.resolvedUri=u(t.uri,i.uri),i.id=e,i.attributes||(i.attributes={},L.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))}},O=function(t){U(t,function(e){e.uri&&(e.resolvedUri=u(t.uri,e.uri))})},P=function(t,e){var i=t.segments[t.segments.length-1];return e&&i&&i.duration?1e3*i.duration:500*(t.targetDuration||10)},D=function(t){function e(e,i,n){var r;void 0===n&&(n={}),r=t.call(this)||this;var a=n,s=a.withCredentials,o=void 0!==s&&s,d=a.handleManifestRedirects,l=void 0!==d&&d;r.srcUrl=e,r.hls_=i,r.withCredentials=o,r.handleManifestRedirects=l;var h=i.options_;if(r.customTagParsers=h&&h.customTagParsers||[],r.customTagMappers=h&&h.customTagMappers||[],!r.srcUrl)throw new Error("A non-empty playlist URL is required");return r.state="HAVE_NOTHING",r.on("mediaupdatetimeout",function(){"HAVE_METADATA"===r.state&&(r.state="HAVE_CURRENT_METADATA",r.request=r.hls_.xhr({uri:u(r.master.uri,r.media().uri),withCredentials:r.withCredentials},function(t,e){if(r.request)return t?r.playlistRequestError(r.request,r.media().uri,"HAVE_METADATA"):void r.haveMetadata(r.request,r.media().uri)}))}),r}r(e,t);var n=e.prototype;return n.playlistRequestError=function(t,e,i){this.request=null,i&&(this.state=i),this.error={playlist:this.master.playlists[e],status:t.status,message:"HLS playlist request error at URL: "+e+".",responseText:t.responseText,code:t.status>=500?4:2},this.trigger("error")},n.haveMetadata=function(t,e){var n=this;this.request=null,this.state="HAVE_METADATA";var r=new I;this.customTagParsers.forEach(function(t){return r.addParser(t)}),this.customTagMappers.forEach(function(t){return r.addTagMapper(t)}),r.push(t.responseText),r.end(),r.manifest.uri=e,r.manifest.attributes=r.manifest.attributes||{};var a=E(this.master,r.manifest);this.targetDuration=r.manifest.targetDuration,a?(this.master=a,this.media_=this.master.playlists[r.manifest.uri]):this.trigger("playlistunchanged"),this.media().endList||(i.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=i.setTimeout(function(){n.trigger("mediaupdatetimeout")},P(this.media(),!!a))),this.trigger("loadedplaylist")},n.dispose=function(){this.stopRequest(),i.clearTimeout(this.mediaUpdateTimeout),i.clearTimeout(this.finalRenditionTimeout)},n.stopRequest=function(){if(this.request){var t=this.request;this.request=null,t.onreadystatechange=null,t.abort()}},n.media=function(t,e){var n=this;if(!t)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof t){if(!this.master.playlists[t])throw new Error("Unknown playlist URI: "+t);t=this.master.playlists[t]}if(i.clearTimeout(this.finalRenditionTimeout),e){var r=t.targetDuration/2*1e3||5e3;this.finalRenditionTimeout=i.setTimeout(this.media.bind(this,t,!1),r)}else{var a=this.state,s=!this.media_||t.uri!==this.media_.uri;if(this.master.playlists[t.uri].endList)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=t,void(s&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(s){if(this.state="SWITCHING_MEDIA",this.request){if(t.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.hls_.xhr({uri:t.resolvedUri,withCredentials:this.withCredentials},function(e,i){if(n.request){if(t.resolvedUri=d(n.handleManifestRedirects,t.resolvedUri,i),e)return n.playlistRequestError(n.request,t.uri,a);n.haveMetadata(i,t.uri),"HAVE_MASTER"===a?n.trigger("loadedmetadata"):n.trigger("mediachange")}})}}},n.pause=function(){this.stopRequest(),i.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},n.load=function(t){var e=this;i.clearTimeout(this.mediaUpdateTimeout);var n=this.media();if(t){var r=n?n.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=i.setTimeout(function(){return e.load()},r)}else this.started?n&&!n.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()},n.start=function(){var t=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(e,n){if(t.request){if(t.request=null,e)return t.error={status:n.status,message:"HLS playlist request error at URL: "+t.srcUrl+".",responseText:n.responseText,code:2},"HAVE_NOTHING"===t.state&&(t.started=!1),t.trigger("error");var r=new I;return t.customTagParsers.forEach(function(t){return r.addParser(t)}),t.customTagMappers.forEach(function(t){return r.addTagMapper(t)}),r.push(n.responseText),r.end(),t.state="HAVE_MASTER",t.srcUrl=d(t.handleManifestRedirects,t.srcUrl,n),r.manifest.uri=t.srcUrl,r.manifest.playlists?(t.master=r.manifest,k(t.master),O(t.master),t.trigger("loadedplaylist"),void(t.request||t.media(r.manifest.playlists[0]))):(t.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:i.location.href,playlists:[{uri:t.srcUrl,id:0,resolvedUri:t.srcUrl,attributes:{}}]},t.master.playlists[t.srcUrl]=t.master.playlists[0],t.haveMetadata(n,t.srcUrl),t.trigger("loadedmetadata"))}})},e}(A),C=n.createTimeRange,R=function(t,e,i){if(void 0===e&&(e=t.mediaSequence+t.segments.length),e<t.mediaSequence)return 0;var n=function(t,e){var i=0,n=e-t.mediaSequence,r=t.segments[n];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;n--;){if(void 0!==(r=t.segments[n]).end)return{result:i+r.end,precise:!0};if(i+=r.duration,void 0!==r.start)return{result:i+r.start,precise:!0}}return{result:i,precise:!1}}(t,e);if(n.precise)return n.result;var r=function(t,e){for(var i,n=0,r=e-t.mediaSequence;r<t.segments.length;r++){if(void 0!==(i=t.segments[r]).start)return{result:i.start-n,precise:!0};if(n+=i.duration,void 0!==i.end)return{result:i.end-n,precise:!0}}return{result:-1,precise:!1}}(t,e);return r.precise?r.result:n.result+i},x=function(t,e,n){if(!t)return 0;if("number"!=typeof n&&(n=0),void 0===e){if(t.totalDuration)return t.totalDuration;if(!t.endList)return i.Infinity}return R(t,e,n)},M=function(t,e,i){var n=0;if(e>i){var r=[i,e];e=r[0],i=r[1]}if(e<0){for(var a=e;a<Math.min(0,i);a++)n+=t.targetDuration;e=0}for(var s=e;s<i;s++)n+=t.segments[s].duration;return n},F=function(t){if(!t.segments.length)return 0;for(var e=t.segments.length-1,i=t.segments[e].duration||t.targetDuration,n=i+2*t.targetDuration;e--&&!((i+=t.segments[e].duration)>=n););return Math.max(0,e)},B=function(t,e,i){if(!t||!t.segments)return null;if(t.endList)return x(t);if(null===e)return null;e=e||0;var n=i?F(t):t.segments.length;return R(t,t.mediaSequence+n,e)},N=function(t){return t-Math.floor(t)==0},q=function(t,e){if(N(e))return e+.1*t;for(var i=e.toString().split(".")[1].length,n=1;n<=i;n++){var r=Math.pow(10,n),a=e*r;if(N(a)||n===i)return(a+t)/r}},V=q.bind(null,1),G=q.bind(null,-1),H=function(t){return t.excludeUntil&&t.excludeUntil>Date.now()},W=function(t){return t.excludeUntil&&t.excludeUntil===1/0},j=function(t){var e=H(t);return!t.disabled&&!e},z=function(t,e){return e.attributes&&e.attributes[t]},X=function(t,e){if(1===t.playlists.length)return!0;var i=e.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===t.playlists.filter(function(t){return!!j(t)&&(t.attributes.BANDWIDTH||0)<i}).length},Y={duration:x,seekable:function(t,e){var i=e||0,n=B(t,e,!0);return null===n?C():C(i,n)},safeLiveIndex:F,getMediaInfoForTime:function(t,e,i,n){var r,a,s=t.segments.length,o=e-n;if(o<0){if(i>0)for(r=i-1;r>=0;r--)if(a=t.segments[r],(o+=G(a.duration))>0)return{mediaIndex:r,startTime:n-M(t,i,r)};return{mediaIndex:0,startTime:e}}if(i<0){for(r=i;r<0;r++)if((o-=t.targetDuration)<0)return{mediaIndex:0,startTime:e};i=0}for(r=i;r<s;r++)if(a=t.segments[r],(o-=V(a.duration))<0)return{mediaIndex:r,startTime:n+M(t,i,r)};return{mediaIndex:s-1,startTime:e}},isEnabled:j,isDisabled:function(t){return t.disabled},isBlacklisted:H,isIncompatible:W,playlistEnd:B,isAes:function(t){for(var e=0;e<t.segments.length;e++)if(t.segments[e].key)return!0;return!1},hasAttribute:z,estimateSegmentRequestTime:function(t,e,i,n){return void 0===n&&(n=0),z("BANDWIDTH",i)?(t*i.attributes.BANDWIDTH-8*n)/e:NaN},isLowestEnabledRendition:X},Q=n.xhr,K=n.mergeOptions,$=function(){return function t(e,i){e=K({timeout:45e3},e);var r=t.beforeRequest||n.Hls.xhr.beforeRequest;if(r&&"function"==typeof r){var a=r(e);a&&(e=a)}var s=Q(e,function(t,e){var n=s.response;!t&&n&&(s.responseTime=Date.now(),s.roundTripTime=s.responseTime-s.requestTime,s.bytesReceived=n.byteLength||n.length,s.bandwidth||(s.bandwidth=Math.floor(s.bytesReceived/s.roundTripTime*8*1e3))),e.headers&&(s.responseHeaders=e.headers),t&&"ETIMEDOUT"===t.code&&(s.timedout=!0),t||s.aborted||200===e.statusCode||206===e.statusCode||0===e.statusCode||(t=new Error("XHR Failed with a response of: "+(s&&(n||s.responseText)))),i(t,s)}),o=s.abort;return s.abort=function(){return s.aborted=!0,o.apply(s,arguments)},s.uri=e.uri,s.requestTime=Date.now(),s}},J=function(t){var e,i,n={};return t.byterange&&(n.Range=(i=(e=t.byterange).offset+e.length-1,"bytes="+e.offset+"-"+i)),n},Z=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},tt=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),et=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},it=function(){var t=[[[],[],[],[],[]],[[],[],[],[],[]]],e=t[0],i=t[1],n=e[4],r=i[4],a=void 0,s=void 0,o=void 0,u=[],d=[],l=void 0,h=void 0,c=void 0,f=void 0,p=void 0;for(a=0;a<256;a++)d[(u[a]=a<<1^283*(a>>7))^a]=a;for(s=o=0;!n[s];s^=l||1,o=d[o]||1)for(c=(c=o^o<<1^o<<2^o<<3^o<<4)>>8^255&c^99,n[s]=c,r[c]=s,p=16843009*u[h=u[l=u[s]]]^65537*h^257*l^16843008*s,f=257*u[c]^16843008*c,a=0;a<4;a++)e[a][s]=f=f<<24^f>>>8,i[a][c]=p=p<<24^p>>>8;for(a=0;a<5;a++)e[a]=e[a].slice(0),i[a]=i[a].slice(0);return t},nt=null,rt=function(){function t(e){Z(this,t),nt||(nt=it()),this._tables=[[nt[0][0].slice(),nt[0][1].slice(),nt[0][2].slice(),nt[0][3].slice(),nt[0][4].slice()],[nt[1][0].slice(),nt[1][1].slice(),nt[1][2].slice(),nt[1][3].slice(),nt[1][4].slice()]];var i=void 0,n=void 0,r=void 0,a=void 0,s=void 0,o=this._tables[0][4],u=this._tables[1],d=e.length,l=1;if(4!==d&&6!==d&&8!==d)throw new Error("Invalid aes key size");for(a=e.slice(0),s=[],this._key=[a,s],i=d;i<4*d+28;i++)r=a[i-1],(i%d==0||8===d&&i%d==4)&&(r=o[r>>>24]<<24^o[r>>16&255]<<16^o[r>>8&255]<<8^o[255&r],i%d==0&&(r=r<<8^r>>>24^l<<24,l=l<<1^283*(l>>7))),a[i]=a[i-d]^r;for(n=0;i;n++,i--)r=a[3&n?i:i-4],s[n]=i<=4||n<4?r:u[0][o[r>>>24]]^u[1][o[r>>16&255]]^u[2][o[r>>8&255]]^u[3][o[255&r]]}return t.prototype.decrypt=function(t,e,i,n,r,a){var s=this._key[1],o=t^s[0],u=n^s[1],d=i^s[2],l=e^s[3],h=void 0,c=void 0,f=void 0,p=s.length/4-2,m=void 0,g=4,y=this._tables[1],_=y[0],v=y[1],b=y[2],T=y[3],S=y[4];for(m=0;m<p;m++)h=_[o>>>24]^v[u>>16&255]^b[d>>8&255]^T[255&l]^s[g],c=_[u>>>24]^v[d>>16&255]^b[l>>8&255]^T[255&o]^s[g+1],f=_[d>>>24]^v[l>>16&255]^b[o>>8&255]^T[255&u]^s[g+2],l=_[l>>>24]^v[o>>16&255]^b[u>>8&255]^T[255&d]^s[g+3],g+=4,o=h,u=c,d=f;for(m=0;m<4;m++)r[(3&-m)+a]=S[o>>>24]<<24^S[u>>16&255]<<16^S[d>>8&255]<<8^S[255&l]^s[g++],h=o,o=u,u=d,d=l,l=h},t}(),at=function(){function t(){Z(this,t),this.listeners={}}return t.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t].splice(i,1),i>-1},t.prototype.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var i=e.length,n=0;n<i;++n)e[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),a=e.length,s=0;s<a;++s)e[s].apply(this,r)},t.prototype.dispose=function(){this.listeners={}},t.prototype.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),st=function(t){function e(){Z(this,e);var i=et(this,t.call(this,at));return i.jobs=[],i.delay=1,i.timeout_=null,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},e.prototype.push=function(t){this.jobs.push(t),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},e}(at),ot=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},ut=function(t,e,i){var n=new Int32Array(t.buffer,t.byteOffset,t.byteLength>>2),r=new rt(Array.prototype.slice.call(e)),a=new Uint8Array(t.byteLength),s=new Int32Array(a.buffer),o=void 0,u=void 0,d=void 0,l=void 0,h=void 0,c=void 0,f=void 0,p=void 0,m=void 0;for(o=i[0],u=i[1],d=i[2],l=i[3],m=0;m<n.length;m+=4)h=ot(n[m]),c=ot(n[m+1]),f=ot(n[m+2]),p=ot(n[m+3]),r.decrypt(h,c,f,p,s,m),s[m]=ot(s[m]^o),s[m+1]=ot(s[m+1]^u),s[m+2]=ot(s[m+2]^d),s[m+3]=ot(s[m+3]^l),o=h,u=c,d=f,l=p;return a},dt=function(){function t(e,i,n,r){Z(this,t);var a=t.STEP,s=new Int32Array(e.buffer),o=new Uint8Array(e.byteLength),u=0;for(this.asyncStream_=new st,this.asyncStream_.push(this.decryptChunk_(s.subarray(u,u+a),i,n,o)),u=a;u<s.length;u+=a)n=new Uint32Array([ot(s[u-4]),ot(s[u-3]),ot(s[u-2]),ot(s[u-1])]),this.asyncStream_.push(this.decryptChunk_(s.subarray(u,u+a),i,n,o));this.asyncStream_.push(function(){var t;r(null,(t=o).subarray(0,t.byteLength-t[t.byteLength-1]))})}return t.prototype.decryptChunk_=function(t,e,i,n){return function(){var r=ut(t,e,i);n.set(r,t.byteOffset)}},tt(t,null,[{key:"STEP",get:function(){return 32e3}}]),t}(),lt=function(t,e){return t.start(e)+"-"+t.end(e)},ht=function(t,e){var i=t.toString(16);return"00".substring(0,2-i.length)+i+(e%2?" ":"")},ct=function(t){return t>=32&&t<126?String.fromCharCode(t):"."},ft=function(t){var e={};return Object.keys(t).forEach(function(i){var n=t[i];ArrayBuffer.isView(n)?e[i]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[i]=n}),e},pt=function(t){var e=t.byterange||{length:1/0,offset:0};return[e.length,e.offset,t.resolvedUri].join(",")},mt=function(t){return t.resolvedUri},gt=function(t){for(var e=Array.prototype.slice.call(t),i="",n=0;n<e.length/16;n++)i+=e.slice(16*n,16*n+16).map(ht).join("")+" "+e.slice(16*n,16*n+16).map(ct).join("")+"\n";return i},yt=Object.freeze({createTransferableMessage:ft,initSegmentId:pt,segmentKeyId:mt,hexDump:gt,tagDump:function(t){var e=t.bytes;return gt(e)},textRanges:function(t){var e,i="";for(e=0;e<t.length;e++)i+=lt(t,e)+" ";return i}}),_t=function(t,e){var i,r=[];if(t&&t.length)for(i=0;i<t.length;i++)e(t.start(i),t.end(i))&&r.push([t.start(i),t.end(i)]);return n.createTimeRanges(r)},vt=function(t,e){return _t(t,function(t,i){return t-.1<=e&&i+.1>=e})},bt=function(t,e){return _t(t,function(t){return t-1/30>=e})},Tt=function(t){var e=[];if(!t||!t.length)return"";for(var i=0;i<t.length;i++)e.push(t.start(i)+" => "+t.end(i));return e.join(", ")},St=function(t){for(var e=[],i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e},It=function(t){return!!t&&"object"==typeof t},wt=function t(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return i.reduce(function(e,i){return Object.keys(i).forEach(function(n){Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=e[n].concat(i[n]):It(e[n])&&It(i[n])?e[n]=t(e[n],i[n]):e[n]=i[n]}),e},{})},At=function(t){return t.reduce(function(t,e){return t.concat(e)},[])},Lt=function(t){if(!t.length)return[];for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e},Ut=function(t,e){return function(t,e){var i,n,r,a,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var r=s.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=n.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var l=o.path,h=l.substring(0,l.lastIndexOf("/")+1)+a.path;d.path=s.normalizePath(h)}else d.path=o.path,a.params||(d.params=o.params,a.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(d)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(r,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s}(e={exports:{}}),e.exports}(),Et=function(t,e){return/^[a-z]+:/i.test(e)?e:(/\/\//i.test(t)||(t=Ut.buildAbsoluteURL(i.location.href,t)),Ut.buildAbsoluteURL(t,e))},kt=function(t){var e=t.baseUrl,i=void 0===e?"":e,n=t.source,r=void 0===n?"":n,a=t.range,s=void 0===a?"":a,o=t.indexRange,u=void 0===o?"":o,d={uri:r,resolvedUri:Et(i||"",r)};if(s||u){var l=(s||u).split("-"),h=parseInt(l[0],10),c=parseInt(l[1],10);d.byterange={length:c-h+1,offset:h}}return d},Ot={static:function(t){var e=t.duration,i=t.timescale,n=void 0===i?1:i,r=t.sourceDuration;return{start:0,end:Math.ceil(r/(e/n))}},dynamic:function(t){var e=t.NOW,i=t.clientOffset,n=t.availabilityStartTime,r=t.timescale,a=void 0===r?1:r,s=t.duration,o=t.start,u=void 0===o?0:o,d=t.minimumUpdatePeriod,l=void 0===d?0:d,h=t.timeShiftBufferDepth,c=void 0===h?1/0:h,f=(e+i)/1e3,p=n+u,m=f+l-p,g=Math.ceil(m*a/s),y=Math.floor((f-p-c)*a/s),_=Math.floor((f-p)*a/s);return{start:Math.max(0,y),end:Math.min(g,_)}}},Pt=function(t){var e=t.type,i=void 0===e?"static":e,n=t.duration,r=t.timescale,a=void 0===r?1:r,s=t.sourceDuration,o=Ot[i](t),u=function(t,e){for(var i=[],n=t;n<e;n++)i.push(n);return i}(o.start,o.end).map(function(t){return function(e,i){var n=t.duration,r=t.timescale,a=void 0===r?1:r,s=t.periodIndex,o=t.startNumber;return{number:(void 0===o?1:o)+e,duration:n/a,timeline:s,time:i*n}}}(t));if("static"===i){var d=u.length-1;u[d].duration=s-n/a*d}return u},Dt=function(t){var e=t.baseUrl,i=t.initialization,n=void 0===i?{}:i,r=t.sourceDuration,a=t.timescale,s=void 0===a?1:a,o=t.indexRange,u=void 0===o?"":o,d=t.duration;if(!e)throw new Error("NO_BASE_URL");var l=kt({baseUrl:e,source:n.sourceURL,range:n.range}),h=kt({baseUrl:e,source:e,indexRange:u});if(h.map=l,d){var c=Pt(t);c.length&&(h.duration=c[0].duration,h.timeline=c[0].timeline)}else r&&(h.duration=r/s,h.timeline=0);return h.number=0,[h]},Ct=function(t,e,i){for(var n=t.sidx.map?t.sidx.map:null,r=t.sidx.duration,a=t.timeline||0,s=t.sidx.byterange,o=s.offset+s.length,u=e.timescale,d=e.references.filter(function(t){return 1!==t.referenceType}),l=[],h=o+e.firstOffset,c=0;c<d.length;c++){var f=e.references[c],p=f.referencedSize,m=f.subsegmentDuration,g=Dt({baseUrl:i,timescale:u,timeline:a,periodIndex:a,duration:m,sourceDuration:r,indexRange:h+"-"+(h+p-1)})[0];n&&(g.map=n),l.push(g),h+=p}return t.segments=l,t},Rt=function(t){var e;return(e=t.reduce(function(t,e){var i,n=e.attributes.id+(e.attributes.lang||"");return t[n]?(e.segments[0]&&(e.segments[0].discontinuity=!0),(i=t[n].segments).push.apply(i,e.segments),e.attributes.contentProtection&&(t[n].attributes.contentProtection=e.attributes.contentProtection)):t[n]=e,t},{}),Object.keys(e).map(function(t){return e[t]})).map(function(t){var e;return t.discontinuityStarts=(e=t.segments,"discontinuity",e.reduce(function(t,e,i){return e.discontinuity&&t.push(i),t},[])),t})},xt=function(t,e){if(void 0===e&&(e={}),!Object.keys(e).length)return t;for(var i in t){var n=t[i];if(n.sidx){var r=n.sidx.uri+"-"+(void 0,o=(s=n.sidx.byterange).offset+s.length-1,s.offset+"-"+o),a=e[r]&&e[r].sidx;n.sidx&&a&&Ct(n,a,n.sidx.resolvedUri)}}var s,o;return t},Mt=function(t){var e,i=t.attributes,n=t.segments,r=t.sidx,a={attributes:(e={NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs},e["PROGRAM-ID"]=1,e),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:"",targetDuration:i.duration,segments:n,mediaSequence:n.length?n[0].number:1};return i.contentProtection&&(a.contentProtection=i.contentProtection),r&&(a.sidx=r),a},Ft=function(t){var e,i=t.attributes,n=t.segments,r=t.sidx,a={attributes:(e={NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth},e["PROGRAM-ID"]=1,e),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:"",targetDuration:i.duration,segments:n,mediaSequence:n.length?n[0].number:1};return i.contentProtection&&(a.contentProtection=i.contentProtection),r&&(a.sidx=r),a},Bt=function(t,e,i){var n=t.NOW,r=t.clientOffset,a=t.availabilityStartTime,s=t.timescale,o=void 0===s?1:s,u=t.start,d=void 0===u?0:u,l=t.minimumUpdatePeriod,h=(n+r)/1e3+(void 0===l?0:l)-(a+d);return Math.ceil((h*o-e)/i)},Nt=function(t,e){for(var i=t.type,n=void 0===i?"static":i,r=t.minimumUpdatePeriod,a=void 0===r?0:r,s=t.media,o=void 0===s?"":s,u=t.sourceDuration,d=t.timescale,l=void 0===d?1:d,h=t.startNumber,c=void 0===h?1:h,f=t.periodIndex,p=[],m=-1,g=0;g<e.length;g++){var y=e[g],_=y.d,v=y.r||0,b=y.t||0;m<0&&(m=b),b&&b>m&&(m=b);var T=void 0;if(v<0){var S=g+1;T=S===e.length?"dynamic"===n&&a>0&&o.indexOf("$Number$")>0?Bt(t,m,_):(u*l-m)/_:(e[S].t-m)/_}else T=v+1;for(var I=c+p.length+T,w=c+p.length;w<I;)p.push({number:w,duration:_/l,time:m,timeline:f}),m+=_,w++}return p},qt=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,Vt=function(t,e){return t.replace(qt,function(t){return function(e,i,n,r){if("$$"===e)return"$";if(void 0===t[i])return e;var a=""+t[i];return"RepresentationID"===i?a:(r=n?parseInt(r,10):1,a.length>=r?a:""+new Array(r-a.length+1).join("0")+a)}}(e))},Gt=function(t,e){var i={RepresentationID:t.id,Bandwidth:t.bandwidth||0},n=t.initialization,r=void 0===n?{sourceURL:"",range:""}:n,a=kt({baseUrl:t.baseUrl,source:Vt(r.sourceURL,i),range:r.range});return function(t,e){return t.duration||e?t.duration?Pt(t):Nt(t,e):[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodIndex}]}(t,e).map(function(e){i.Number=e.number,i.Time=e.time;var n=Vt(t.media||"",i);return{uri:n,timeline:e.timeline,duration:e.duration,resolvedUri:Et(t.baseUrl||"",n),map:a,number:e.number}})},Ht=function(t,e){var i=t.duration,n=t.segmentUrls,r=void 0===n?[]:n;if(!i&&!e||i&&e)throw new Error("SEGMENT_TIME_UNSPECIFIED");var a,s=r.map(function(e){return function(t,e){var i=t.baseUrl,n=t.initialization,r=void 0===n?{}:n,a=kt({baseUrl:i,source:r.sourceURL,range:r.range}),s=kt({baseUrl:i,source:e.media,range:e.mediaRange});return s.map=a,s}(t,e)});return i&&(a=Pt(t)),e&&(a=Nt(t,e)),a.map(function(t,e){if(s[e]){var i=s[e];return i.timeline=t.timeline,i.duration=t.duration,i.number=t.number,i}}).filter(function(t){return t})},Wt=function(t){var e,i,n=t.attributes,r=t.segmentInfo;r.template?(i=Gt,e=wt(n,r.template)):r.base?(i=Dt,e=wt(n,r.base)):r.list&&(i=Ht,e=wt(n,r.list));var a={attributes:n};if(!i)return a;var s=i(e,r.timeline);if(e.duration){var o=e,u=o.duration,d=o.timescale,l=void 0===d?1:d;e.duration=u/l}else s.length?e.duration=s.reduce(function(t,e){return Math.max(t,Math.ceil(e.duration))},0):e.duration=0;return a.attributes=e,a.segments=s,r.base&&e.indexRange&&(a.sidx=s[0],a.segments=[]),a},jt=function(t,e){return Lt(t.childNodes).filter(function(t){return t.tagName===e})},zt=function(t){return t.textContent.trim()},Xt=function(t){var e=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(t);if(!e)return 0;var i=e.slice(1),n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],u=i[5];return 31536e3*parseFloat(n||0)+2592e3*parseFloat(r||0)+86400*parseFloat(a||0)+3600*parseFloat(s||0)+60*parseFloat(o||0)+parseFloat(u||0)},Yt={mediaPresentationDuration:function(t){return Xt(t)},availabilityStartTime:function(t){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e=t)&&(e+="Z"),Date.parse(e)/1e3;var e},minimumUpdatePeriod:function(t){return Xt(t)},timeShiftBufferDepth:function(t){return Xt(t)},start:function(t){return Xt(t)},width:function(t){return parseInt(t,10)},height:function(t){return parseInt(t,10)},bandwidth:function(t){return parseInt(t,10)},startNumber:function(t){return parseInt(t,10)},timescale:function(t){return parseInt(t,10)},duration:function(t){var e=parseInt(t,10);return isNaN(e)?Xt(t):e},d:function(t){return parseInt(t,10)},t:function(t){return parseInt(t,10)},r:function(t){return parseInt(t,10)},DEFAULT:function(t){return t}},Qt=function(t){return t&&t.attributes?Lt(t.attributes).reduce(function(t,e){var i=Yt[e.name]||Yt.DEFAULT;return t[e.name]=i(e.value),t},{}):{}},Kt={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},$t=function(t,e){return e.length?At(t.map(function(t){return e.map(function(e){return Et(t,zt(e))})})):t},Jt=function(t){var e=jt(t,"SegmentTemplate")[0],i=jt(t,"SegmentList")[0],n=i&&jt(i,"SegmentURL").map(function(t){return wt({tag:"SegmentURL"},Qt(t))}),r=jt(t,"SegmentBase")[0],a=i||e,s=a&&jt(a,"SegmentTimeline")[0],o=i||r||e,u=o&&jt(o,"Initialization")[0],d=e&&Qt(e);d&&u?d.initialization=u&&Qt(u):d&&d.initialization&&(d.initialization={sourceURL:d.initialization});var l={template:d,timeline:s&&jt(s,"S").map(function(t){return Qt(t)}),list:i&&wt(Qt(i),{segmentUrls:n,initialization:Qt(u)}),base:r&&wt(Qt(r),{initialization:Qt(u)})};return Object.keys(l).forEach(function(t){l[t]||delete l[t]}),l},Zt=function(t,e,n){return function(r){var a=Qt(r),s=$t(e,jt(r,"BaseURL")),o=jt(r,"Role")[0],u={role:Qt(o)},d=wt(t,a,u),l=jt(r,"ContentProtection").reduce(function(t,e){var n=Qt(e),r=Kt[n.schemeIdUri];if(r){t[r]={attributes:n};var a=jt(e,"cenc:pssh")[0];if(a){var s=zt(a),o=s&&function(t){for(var e=i.atob(t),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(s);t[r].pssh=o}}return t},{});Object.keys(l).length&&(d=wt(d,{contentProtection:l}));var h=Jt(r),c=jt(r,"Representation"),f=wt(n,h);return At(c.map(function(t,e,i){return function(n){var r=jt(n,"BaseURL"),a=$t(e,r),s=wt(t,Qt(n)),o=Jt(n);return a.map(function(t){return{segmentInfo:wt(i,o),attributes:wt(s,{baseUrl:t})}})}}(d,s,f)))}},te=function(t){if(""===t)throw new Error("DASH_EMPTY_MANIFEST");var e=(new i.DOMParser).parseFromString(t,"application/xml"),n=e&&"MPD"===e.documentElement.tagName?e.documentElement:null;if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error("DASH_INVALID_XML");return n},ee=function(t,e){return void 0===e&&(e={}),function(t,e){var i;if(void 0===e&&(e={}),!t.length)return{};var n=t[0].attributes,r=n.sourceDuration,a=n.minimumUpdatePeriod,s=void 0===a?0:a,o=Rt(t.filter(function(t){var e=t.attributes;return"video/mp4"===e.mimeType||"video"===e.contentType})).map(Ft),u=Rt(t.filter(function(t){var e=t.attributes;return"audio/mp4"===e.mimeType||"audio"===e.contentType})),d=t.filter(function(t){var e=t.attributes;return"text/vtt"===e.mimeType||"text"===e.contentType}),l={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(i={AUDIO:{},VIDEO:{}},i["CLOSED-CAPTIONS"]={},i.SUBTITLES={},i),uri:"",duration:r,playlists:xt(o,e),minimumUpdatePeriod:1e3*s};return u.length&&(l.mediaGroups.AUDIO.audio=function(t,e){var i;void 0===e&&(e={});var n=u.reduce(function(t,n){var r=n.attributes.role&&n.attributes.role.value||"",a=n.attributes.lang||"",s="main";if(a){var o=r?" ("+r+")":"";s=""+n.attributes.lang+o}return t[s]&&t[s].playlists[0].attributes.BANDWIDTH>n.attributes.bandwidth?t:(t[s]={language:a,autoselect:!0,default:"main"===r,playlists:xt([Mt(n)],e),uri:""},void 0===i&&"main"===r&&((i=n).default=!0),t)},{});return i||(n[Object.keys(n)[0]].default=!0),n}(0,e)),d.length&&(l.mediaGroups.SUBTITLES.subs=function(t,e){return void 0===e&&(e={}),d.reduce(function(t,i){var n,r,a,s,o=i.attributes.lang||"text";return t[o]?t:(t[o]={language:o,default:!1,autoselect:!1,playlists:xt([(n=i,a=n.attributes,s=n.segments,void 0===s&&(s=[{uri:a.baseUrl,timeline:a.periodIndex,resolvedUri:a.baseUrl||"",duration:a.sourceDuration,number:0}],a.duration=a.sourceDuration),{attributes:(r={NAME:a.id,BANDWIDTH:a.bandwidth},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===(a.type||"static"),timeline:a.periodIndex,resolvedUri:a.baseUrl||"",targetDuration:a.duration,segments:s,mediaSequence:s.length?s[0].number:1})],e),uri:""},t)},{})}(0,e)),l}(function(t,e){void 0===e&&(e={});var n=e,r=n.manifestUri,a=void 0===r?"":r,s=n.NOW,o=void 0===s?Date.now():s,u=n.clientOffset,d=void 0===u?0:u,l=jt(t,"Period");if(!l.length)throw new Error("INVALID_NUMBER_OF_PERIOD");var h=Qt(t),c=$t([a],jt(t,"BaseURL"));return h.sourceDuration=h.mediaPresentationDuration||0,h.NOW=o,h.clientOffset=d,At(l.map(function(t,e){return function(n,r){var a=$t(e,jt(n,"BaseURL")),s=Qt(n),o=parseInt(s.id,10),u=i.isNaN(o)?r:o,d=wt(t,{periodIndex:u}),l=jt(n,"AdaptationSet"),h=Jt(n);return At(l.map(Zt(d,a,h)))}}(h,c)))}(te(t),e).map(Wt),e.sidxMapping)},ie=function(t){return t>>>0},ne=function(t){return("00"+t.toString(16)).slice(-2)};v=function(t){return y(t,["moov","trak"]).reduce(function(t,e){var i,n,r,a,s;return(i=y(e,["tkhd"])[0])?(n=i[0],a=ie(i[r=0===n?12:20]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3]),(s=y(e,["mdia","mdhd"])[0])?(r=0===(n=s[0])?12:20,t[a]=ie(s[r]<<24|s[r+1]<<16|s[r+2]<<8|s[r+3]),t):null):null},{})},b=function(t,e){var i,n,r;return i=y(e,["moof","traf"]),n=[].concat.apply([],i.map(function(e){return y(e,["tfhd"]).map(function(i){var n,r;return n=ie(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),r=t[n]||9e4,(y(e,["tfdt"]).map(function(t){var e,i;return e=t[0],i=ie(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),1===e&&(i*=Math.pow(2,32),i+=ie(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),i})[0]||1/0)/r})})),r=Math.min.apply(null,n),isFinite(r)?r:0},T=function(t){var e=y(t,["moov","trak"]),i=[];return e.forEach(function(t){var e=y(t,["mdia","hdlr"]),n=y(t,["tkhd"]);e.forEach(function(t,e){var r,a,s=_(t.subarray(8,12)),o=n[e];"vide"===s&&(a=0===(r=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?r.getUint32(12):r.getUint32(20),i.push(a))})}),i},S=function(t){var e=y(t,["moov","trak"]),i=[];return e.forEach(function(t){var e,n,r={},a=y(t,["tkhd"])[0];a&&(n=(e=new DataView(a.buffer,a.byteOffset,a.byteLength)).getUint8(0),r.id=0===n?e.getUint32(12):e.getUint32(20));var s=y(t,["mdia","hdlr"])[0];if(s){var o=_(s.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var u=y(t,["mdia","minf","stbl","stsd"])[0];if(u){var d=u.subarray(8);r.codec=_(d.subarray(4,8));var l,h=y(d,[r.codec])[0];h&&(/^[a-z]vc[1-9]$/i.test(r.codec)?(l=h.subarray(78),"avcC"===_(l.subarray(4,8))&&l.length>11?(r.codec+=".",r.codec+=ne(l[9]),r.codec+=ne(l[10]),r.codec+=ne(l[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)&&(l=h.subarray(28),"esds"===_(l.subarray(4,8))&&l.length>20&&0!==l[19]?(r.codec+="."+ne(l[19]),r.codec+="."+ne(l[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"))}var c=y(t,["mdia","mdhd"])[0];if(c&&a){var f=0===n?12:20;r.timescale=ie(c[f]<<24|c[f+1]<<16|c[f+2]<<8|c[f+3])}i.push(r)}),i};var re,ae,se,oe={findBox:y=function(t,e){var i,n,r,a,s,o=[];if(!e.length)return null;for(i=0;i<t.byteLength;)n=ie(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]),r=_(t.subarray(i+4,i+8)),a=n>1?i+n:t.byteLength,r===e[0]&&(1===e.length?o.push(t.subarray(i+8,a)):(s=y(t.subarray(i+8,a),e.slice(1))).length&&(o=o.concat(s))),i=a;return o},parseType:_=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),(e+=String.fromCharCode(t[2]))+String.fromCharCode(t[3])},timescale:v,startTime:b,videoTrackIds:T,tracks:S},ue=oe.findBox,de=oe.parseType,le=function(t){return new Date(1e3*t-20828448e5)},he=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},ce=function(t){var e,i,n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[];for(e=0;e+4<t.length;e+=i)if(i=n.getUint32(e),e+=4,i<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&t[e]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+t[e]&31)}return r},fe={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:re(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,r,a=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},o=31&t[5];for(n=6,r=0;r<o;r++)i=a.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,r=0;r<e;r++)i=a.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:de(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(de(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:re(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:re(t.subarray(8))}},hdlr:function(t){var e={version:new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:de(t.subarray(8,12)),name:""},i=8;for(i=24;i<t.byteLength;i++){if(0===t[i]){i++;break}e.name+=String.fromCharCode(t[i])}return e.name=decodeURIComponent(escape(e.name)),e},mdat:function(t){return{byteLength:t.byteLength,nals:ce(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,r={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===r.version?(n+=4,r.creationTime=le(i.getUint32(n)),n+=8,r.modificationTime=le(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=8,r.duration=i.getUint32(n)):(r.creationTime=le(i.getUint32(n)),n+=4,r.modificationTime=le(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=4,r.duration=i.getUint32(n)),n+=4,e=i.getUint16(n),r.language+=String.fromCharCode(96+(e>>10)),r.language+=String.fromCharCode(96+((992&e)>>5)),r.language+=String.fromCharCode(96+(31&e)),r},mdia:function(t){return{boxes:re(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:re(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return t.byteLength>28&&(i.streamDescriptor=re(t.subarray(28))[0]),i},moof:function(t){return{boxes:re(t)}},moov:function(t){return{boxes:re(t)}},mvex:function(t){return{boxes:re(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=le(e.getUint32(i)),i+=8,n.modificationTime=le(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8,n.duration=e.getUint32(i)):(n.creationTime=le(e.getUint32(i)),i+=4,n.modificationTime=le(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4,n.duration=e.getUint32(i)),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},r=i.getUint16(22);for(e=24;r;e+=12,r--)n.references.push({referenceType:(128&t[e])>>>7,referencedSize:2147483647&i.getUint32(e),subsegmentDuration:i.getUint32(e+4),startsWithSap:!!(128&t[e+8]),sapType:(112&t[e+8])>>>4,sapDeltaTime:268435455&i.getUint32(e+8)});return n},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:re(t)}},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},r=i.getUint32(4);for(e=8;r;e+=4,r--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)r.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return r},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:re(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},r=i.getUint32(4);for(e=8;r;e+=8,r--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return fe.ftyp(t)},tfdt:function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:t[4]<<24|t[5]<<16|t[6]<<8|t[7]};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=t[8]<<24|t[9]<<16|t[10]<<8|t[11]),e},tfhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],a=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],u=32&n.flags[2],d=65536&n.flags[0],l=131072&n.flags[0];return e=8,r&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),a&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),o&&(n.defaultSampleSize=i.getUint32(e),e+=4),u&&(n.defaultSampleFlags=i.getUint32(e)),d&&(n.durationIsEmpty=!0),!r&&l&&(n.baseDataOffsetIsMoof=!0),n},tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=le(e.getUint32(i)),i+=8,n.modificationTime=le(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8,n.duration=e.getUint32(i)):(n.creationTime=le(e.getUint32(i)),i+=4,n.modificationTime=le(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4,n.duration=e.getUint32(i)),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/16,n},traf:function(t){return{boxes:re(t)}},trak:function(t){return{boxes:re(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],u=4&i.flags[1],d=8&i.flags[1],l=n.getUint32(4),h=8;for(r&&(i.dataOffset=n.getInt32(h),h+=4),a&&l&&(e={flags:he(t.subarray(h,h+4))},h+=4,s&&(e.duration=n.getUint32(h),h+=4),o&&(e.size=n.getUint32(h),h+=4),d&&(e.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(e),l--);l--;)e={},s&&(e.duration=n.getUint32(h),h+=4),o&&(e.size=n.getUint32(h),h+=4),u&&(e.flags=he(t.subarray(h,h+4)),h+=4),d&&(e.compositionTimeOffset=n.getUint32(h),h+=4),i.samples.push(e);return i},"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}},pe={inspect:re=function(t){for(var e,i,n,r,a,s=0,o=[],u=new ArrayBuffer(t.length),d=new Uint8Array(u),l=0;l<t.length;++l)d[l]=t[l];for(e=new DataView(u);s<t.byteLength;)i=e.getUint32(s),n=de(t.subarray(s+4,s+8)),r=i>1?s+i:t.byteLength,(a=(fe[n]||function(t){return{data:t}})(t.subarray(s+8,r))).size=i,a.type=n,o.push(a),s=r;return o},textify:ae=function(t,e){var i;return e=e||0,i=new Array(2*e+1).join(" "),t.map(function(t,n){return i+t.type+"\n"+Object.keys(t).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(e){var n=i+"  "+e+": ",r=t[e];if(r instanceof Uint8Array||r instanceof Uint32Array){var a=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return a?1===a.length?n+"<"+a.join("").slice(1)+">":n+"<\n"+a.map(function(t){return i+"  "+t}).join("\n")+"\n"+i+"  >":n+"<>"}return n+JSON.stringify(r,null,2).split("\n").map(function(t,e){return 0===e?t:i+"  "+t}).join("\n")}).join("\n")+(t.boxes?"\n"+ae(t.boxes,e+1):"")}).join("\n")},parseTfdt:fe.tfdt,parseHdlr:fe.hdlr,parseTfhd:fe.tfhd,parseTrun:fe.trun,parseSidx:fe.sidx},me=n.EventTarget,ge=n.mergeOptions,ye=function(t,e){for(var i,n=ge(t,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod}),r=0;r<e.playlists.length;r++){var a=E(n,e.playlists[r]);a?n=a:i=!0}return U(e,function(t,e,r,a){if(t.playlists&&t.playlists.length){var s=t.playlists[0].uri,o=E(n,t.playlists[0]);o&&((n=o).mediaGroups[e][r][a].playlists[0]=n.playlists[s],i=!1)}}),i?null:n},_e=function(t){var e=t.byterange.offset+t.byterange.length-1;return t.uri+"-"+t.byterange.offset+"-"+e},ve=function(t,e){var i,n,r={};for(var a in t){var s=t[a].sidx;if(s){var o=_e(s);if(!e[o])break;i=e[o].sidxInfo,n=s,(Boolean(!i.map&&!n.map)||Boolean(i.map&&n.map&&i.map.byterange.offset===n.map.byterange.offset&&i.map.byterange.length===n.map.byterange.length))&&i.uri===n.uri&&i.byterange.offset===n.byterange.offset&&i.byterange.length===n.byterange.length&&(r[o]=e[o])}}return r},be=function(t,e,i,r,a){var s={uri:d(r.handleManifestRedirects,t.resolvedUri),byterange:t.byterange,playlist:e};return i(n.mergeOptions(s,{responseType:"arraybuffer",headers:J(s)}),a)},Te=function(t){function e(e,i,n,r){var s;void 0===n&&(n={}),s=t.call(this)||this;var o=n,u=o.withCredentials,d=void 0!==u&&u,l=o.handleManifestRedirects,h=void 0!==l&&l;if(s.hls_=i,s.withCredentials=d,s.handleManifestRedirects=h,!e)throw new Error("A non-empty playlist URL or playlist is required");return s.on("minimumUpdatePeriod",function(){s.refreshXml_()}),s.on("mediaupdatetimeout",function(){s.refreshMedia_(s.media().uri)}),s.state="HAVE_NOTHING",s.loadedPlaylists_={},"string"==typeof e?(s.srcUrl=e,s.sidxMapping_={},a(s)):(s.setupChildLoader(r,e),s)}r(e,t);var n=e.prototype;return n.setupChildLoader=function(t,e){this.masterPlaylistLoader_=t,this.childPlaylist_=e},n.dispose=function(){this.stopRequest(),this.loadedPlaylists_={},i.clearTimeout(this.minimumUpdatePeriodTimeout_),i.clearTimeout(this.mediaRequest_),i.clearTimeout(this.mediaUpdateTimeout)},n.hasPendingRequest=function(){return this.request||this.mediaRequest_},n.stopRequest=function(){if(this.request){var t=this.request;this.request=null,t.onreadystatechange=null,t.abort()}},n.sidxRequestFinished_=function(t,e,i,n){var r=this;return function(a,s){if(r.request){if(r.request=null,a)return r.error={status:s.status,message:"DASH playlist request error at URL: "+t.uri,response:s.response,code:2},i&&(r.state=i),r.trigger("error"),n(e,null);var o=new Uint8Array(s.response),u=pe.parseSidx(o.subarray(8));return n(e,u)}}},n.media=function(t){var e=this;if(!t)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var n=this.state;if("string"==typeof t){if(!this.master.playlists[t])throw new Error("Unknown playlist URI: "+t);t=this.master.playlists[t]}var r=!this.media_||t.uri!==this.media_.uri;if(r&&this.loadedPlaylists_[t.uri]&&this.loadedPlaylists_[t.uri].endList)return this.state="HAVE_METADATA",this.media_=t,void(r&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(r)if(this.media_&&this.trigger("mediachanging"),t.sidx){var a,s;this.masterPlaylistLoader_?(a=this.masterPlaylistLoader_.master,s=this.masterPlaylistLoader_.sidxMapping_):(a=this.master,s=this.sidxMapping_);var o=_e(t.sidx);s[o]={sidxInfo:t.sidx},this.request=be(t.sidx,t,this.hls_.xhr,{handleManifestRedirects:this.handleManifestRedirects},this.sidxRequestFinished_(t,a,n,function(i,r){if(!i||!r)throw new Error("failed to request sidx");s[o].sidx=r,e.haveMetadata({startingState:n,playlist:i.playlists[t.uri]})}))}else this.mediaRequest_=i.setTimeout(this.haveMetadata.bind(this,{startingState:n,playlist:t}),0)},n.haveMetadata=function(t){var e=t.startingState,i=t.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[i.uri]=i,this.mediaRequest_=null,this.refreshMedia_(i.uri),"HAVE_MASTER"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")},n.pause=function(){this.stopRequest(),i.clearTimeout(this.mediaUpdateTimeout),i.clearTimeout(this.minimumUpdatePeriodTimeout_),"HAVE_NOTHING"===this.state&&(this.started=!1)},n.load=function(t){var e=this;i.clearTimeout(this.mediaUpdateTimeout),i.clearTimeout(this.minimumUpdatePeriodTimeout_);var n=this.media();if(t){var r=n?n.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=i.setTimeout(function(){return e.load()},r)}else this.started?this.trigger("loadedplaylist"):this.start()},n.parseMasterXml=function(){var t=ee(this.masterXml_,{manifestUri:this.srcUrl,clientOffset:this.clientOffset_,sidxMapping:this.sidxMapping_});t.uri=this.srcUrl;for(var e=0;e<t.playlists.length;e++){var i="placeholder-uri-"+e;t.playlists[e].uri=i,t.playlists[i]=t.playlists[e]}return U(t,function(e,i,n,r){if(e.playlists&&e.playlists.length){var a="placeholder-uri-"+i+"-"+n+"-"+r;e.playlists[0].uri=a,t.playlists[a]=e.playlists[0]}}),k(t),O(t),t},n.start=function(){var t=this;this.started=!0,this.masterPlaylistLoader_?this.mediaRequest_=i.setTimeout(this.haveMaster_.bind(this),0):this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(e,i){if(t.request){if(t.request=null,e)return t.error={status:i.status,message:"DASH playlist request error at URL: "+t.srcUrl,responseText:i.responseText,code:2},"HAVE_NOTHING"===t.state&&(t.started=!1),t.trigger("error");t.masterXml_=i.responseText,i.responseHeaders&&i.responseHeaders.date?t.masterLoaded_=Date.parse(i.responseHeaders.date):t.masterLoaded_=Date.now(),t.srcUrl=d(t.handleManifestRedirects,t.srcUrl,i),t.syncClientServerClock_(t.onClientServerClockSync_.bind(t))}})},n.syncClientServerClock_=function(t){var e,i=this,n=(e=this.masterXml_,function(t){var e=jt(t,"UTCTiming")[0];if(!e)return null;var i=Qt(e);switch(i.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":i.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":i.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":i.method="DIRECT",i.value=Date.parse(i.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return i}(te(e)));return null===n?(this.clientOffset_=this.masterLoaded_-Date.now(),t()):"DIRECT"===n.method?(this.clientOffset_=n.value-Date.now(),t()):void(this.request=this.hls_.xhr({uri:u(this.srcUrl,n.value),method:n.method,withCredentials:this.withCredentials},function(e,r){if(i.request){if(e)return i.clientOffset_=i.masterLoaded_-Date.now(),t();var a;a="HEAD"===n.method?r.responseHeaders&&r.responseHeaders.date?Date.parse(r.responseHeaders.date):i.masterLoaded_:Date.parse(r.responseText),i.clientOffset_=a-Date.now(),t()}}))},n.haveMaster_=function(){this.state="HAVE_MASTER",this.mediaRequest_=null,this.masterPlaylistLoader_?this.media_||this.media(this.childPlaylist_):(this.master=this.parseMasterXml(),this.trigger("loadedplaylist"))},n.onClientServerClockSync_=function(){var t=this;this.haveMaster_(),this.hasPendingRequest()||this.media_||this.media(this.master.playlists[0]),this.master&&this.master.minimumUpdatePeriod&&(this.minimumUpdatePeriodTimeout_=i.setTimeout(function(){t.trigger("minimumUpdatePeriod")},this.master.minimumUpdatePeriod))},n.refreshXml_=function(){var t=this;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(e,n){if(t.request){if(t.request=null,e)return t.error={status:n.status,message:"DASH playlist request error at URL: "+t.srcUrl,responseText:n.responseText,code:2},"HAVE_NOTHING"===t.state&&(t.started=!1),t.trigger("error");t.masterXml_=n.responseText,t.sidxMapping_=function(t,e,i,n){var r=ee(t,{manifestUri:e,clientOffset:i}),a=ve(r.playlists,n);return U(r,function(t,e,i,r){if(t.playlists&&t.playlists.length){var s=t.playlists;a=ge(a,ve(s,n))}}),a}(t.masterXml_,t.srcUrl,t.clientOffset_,t.sidxMapping_);var r=t.parseMasterXml(),a=ye(t.master,r),s=t.media().sidx;if(a)if(s){var o=_e(s);if(!t.sidxMapping_[o]){var u=t.media();t.request=be(u.sidx,u,t.hls_.xhr,{handleManifestRedirects:t.handleManifestRedirects},t.sidxRequestFinished_(u,r,t.state,function(e,n){if(!e||!n)throw new Error("failed to request sidx on minimumUpdatePeriod");t.sidxMapping_[o].sidx=n,t.minimumUpdatePeriodTimeout_=i.setTimeout(function(){t.trigger("minimumUpdatePeriod")},t.master.minimumUpdatePeriod),t.refreshMedia_(t.media().uri)}))}}else t.master=a;t.minimumUpdatePeriodTimeout_=i.setTimeout(function(){t.trigger("minimumUpdatePeriod")},t.master.minimumUpdatePeriod)}})},n.refreshMedia_=function(t){var e,n,r=this;if(!t)throw new Error("refreshMedia_ must take a media uri");this.masterPlaylistLoader_?(e=this.masterPlaylistLoader_.master,n=this.masterPlaylistLoader_.parseMasterXml()):(e=this.master,n=this.parseMasterXml());var a=ye(e,n);a?(this.masterPlaylistLoader_?this.masterPlaylistLoader_.master=a:this.master=a,this.media_=a.playlists[t]):(this.media_=n.playlists[t],this.trigger("playlistunchanged")),this.media().endList||(this.mediaUpdateTimeout=i.setTimeout(function(){r.trigger("mediaupdatetimeout")},P(this.media(),!!a))),this.trigger("loadedplaylist")},e}(me),Se={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},Ie=function(t){for(var e=new Uint8Array(new ArrayBuffer(t.length)),i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e.buffer},we=[],Ae=function(t){var e=t.transmuxer,i=t.bytes,n=t.audioAppendStart,r=t.gopsToAlignWith,a=t.isPartial,s=t.remux,o=t.onData,u=t.onTrackInfo,d=t.onAudioTimingInfo,l=t.onVideoTimingInfo,h=t.onVideoSegmentTimingInfo,c=t.onId3,f=t.onCaptions,p=t.onDone,m={isPartial:a,buffer:[]};if(e.onmessage=function(t){se&&("data"===t.data.action&&function(t,e,i){var n=t.data.segment,r=n.type,a=n.initSegment,s=n.captions,o=n.captionStreams,u=n.metadata,d=n.videoFrameDtsTime;e.buffer.push({captions:s,captionStreams:o,metadata:u});var l=t.data.segment.boxes||{data:t.data.segment.data},h={type:r,data:new Uint8Array(l.data,l.data.byteOffset,l.data.byteLength),initSegment:new Uint8Array(a.data,a.byteOffset,a.byteLength)};d&&(h.videoFrameDtsTime=d),i(h)}(t,m,o),"trackinfo"===t.data.action&&u(t.data.trackInfo),"gopInfo"===t.data.action&&function(t,e){e.gopInfo=t.data.gopInfo}(t,m),"audioTimingInfo"===t.data.action&&d(t.data.audioTimingInfo),"videoTimingInfo"===t.data.action&&l(t.data.videoTimingInfo),"videoSegmentTimingInfo"===t.data.action&&h(t.data.videoSegmentTimingInfo),"id3Frame"===t.data.action&&c([t.data.id3Frame],t.data.id3Frame.dispatchType),"caption"===t.data.action&&f(t.data.caption),"transmuxed"===t.data.type&&(e.onmessage=null,function(t){var e=t.transmuxedData,i=t.callback;e.buffer=[],i(e)}({transmuxedData:m,callback:p}),Le()))},n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==s&&e.postMessage({action:"setRemux",remux:s}),i.byteLength){var g=i instanceof ArrayBuffer?i:i.buffer,y=i instanceof ArrayBuffer?0:i.byteOffset;e.postMessage({action:"push",data:g,byteOffset:y,byteLength:i.byteLength},[g])}e.postMessage({action:a?"partialFlush":"flush"})},Le=function(){se=null,we.length&&("function"==typeof(se=we.shift())?se():Ae(se))},Ue=function(t,e){t.postMessage({action:e}),Le()},Ee=function(t,e){if(!se)return se=t,void Ue(e,t);we.push(Ue.bind(null,e,t))},ke=function(t){Ee("reset",t)},Oe=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var n;return!!t[e]&&(n=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(n,1),n>-1)},this.trigger=function(e){var i,n,r,a;if(i=t[e])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(a=[],n=arguments.length,n=1;n<arguments.length;++n)a.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,a)}},this.dispose=function(){t={}}}};Oe.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(e){t.flush(e)}),this.on("partialdone",function(e){t.partialFlush(e)}),this.on("endedtimeline",function(e){t.endTimeline(e)}),this.on("reset",function(e){t.reset(e)}),t},Oe.prototype.push=function(t){this.trigger("data",t)},Oe.prototype.flush=function(t){this.trigger("done",t)},Oe.prototype.partialFlush=function(t){this.trigger("partialdone",t)},Oe.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},Oe.prototype.reset=function(t){this.trigger("reset",t)};var Pe=Oe,De=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},Ce=function(t){var e,i;Ce.prototype.init.call(this),this.type_=t||"shared",this.push=function(t){"shared"!==this.type_&&t.type!==this.type_||(void 0===i&&(i=t.dts),t.dts=De(t.dts,i),t.pts=De(t.pts,i),e=t.dts,this.trigger("data",t))},this.flush=function(){i=e,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,e=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ce.prototype=new Pe;var Re=function(t){var e=31&t[1];return(e<<=8)|t[2]},xe=function(t){return!!(64&t[1])},Me=function(t){var e=0;return(48&t[3])>>>4>1&&(e+=t[4]+1),e},Fe=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Be={parseType:function(t,e){var i=Re(t);return 0===i?"pat":i===e?"pmt":e?"pes":null},parsePat:function(t){var e=xe(t),i=4+Me(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},parsePmt:function(t){var e={},i=xe(t),n=4+Me(t);if(i&&(n+=t[n]+1),1&t[n+5]){var r;r=3+((15&t[n+1])<<8|t[n+2])-4;for(var a=12+((15&t[n+10])<<8|t[n+11]);a<r;){var s=n+a;e[(31&t[s+1])<<8|t[s+2]]=t[s],a+=5+((15&t[s+3])<<8|t[s+4])}return e}},parsePayloadUnitStartIndicator:xe,parsePesType:function(t,e){switch(e[Re(t)]){case 27:return"video";case 15:return"audio";case 21:return"timed-metadata";default:return null}},parsePesTime:function(t){if(!xe(t))return null;var e=4+Me(t);if(e>=t.byteLength)return null;var i,n=null;return 192&(i=t[e+7])&&((n={}).pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},videoPacketContainsKeyFrame:function(t){for(var e=4+Me(t),i=t.subarray(e),n=0,r=0,a=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===Fe(31&i[r+3])&&(a=!0);do{n++}while(1!==i[n]&&n<i.length);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Fe(31&i[r+3])&&(a=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===Fe(31&i[r+3])&&(a=!0),a}},Ne=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],qe=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},Ve={isLikelyAacData:function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},parseId3TagSize:function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return(16&t[e+5])>>4?i+20:i+10},parseAdtsSize:function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},parseType:function(t,e){return t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&t[e]&&240==(240&t[e+1])?"audio":null},parseSampleRate:function(t){for(var e=0;e+5<t.length;){if(255===t[e]&&240==(246&t[e+1]))return Ne[(60&t[e+2])>>>2];e++}return null},parseAacTimestamp:function(t){var e,i,n;e=10,64&t[5]&&(e+=4,e+=qe(t.subarray(10,14)));do{if((i=qe(t.subarray(e+4,e+8)))<1)return null;if("PRIV"===String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3])){n=t.subarray(e+10,e+i+10);for(var r=0;r<n.byteLength;r++)if(0===n[r]){if("com.apple.streaming.transportStreamTimestamp"===unescape(function(t,e,i){var n,r="";for(n=0;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r}(n,0,r))){var a=n.subarray(r+1),s=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;return(s*=4)+(3&a[7])}break}}e+=10,e+=i}while(e<t.byteLength);return null}},Ge=(function(t){return 9e4*t},function(t,e){return t*e},function(t){return t/9e4},function(t,e){return t/e},9e4),He=De,We={};We.ts=Be,We.aac=Ve;var je=function(t,e,i){for(var n,r,a,s,o=0,u=188,d=!1;u<=t.byteLength;)if(71!==t[o]||71!==t[u]&&u!==t.byteLength)o++,u++;else{switch(n=t.subarray(o,u),We.ts.parseType(n,e.pid)){case"pes":r=We.ts.parsePesType(n,e.table),a=We.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=We.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),d=!0)}if(d)break;o+=188,u+=188}for(o=(u=t.byteLength)-188,d=!1;o>=0;)if(71!==t[o]||71!==t[u]&&u!==t.byteLength)o--,u--;else{switch(n=t.subarray(o,u),We.ts.parseType(n,e.pid)){case"pes":r=We.ts.parsePesType(n,e.table),a=We.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=We.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),d=!0)}if(d)break;o-=188,u-=188}},ze=function(t,e,i){for(var n,r,a,s,o,u,d,l=0,h=188,c=!1,f={data:[],size:0};h<t.byteLength;)if(71!==t[l]||71!==t[h])l++,h++;else{switch(n=t.subarray(l,h),We.ts.parseType(n,e.pid)){case"pes":if(r=We.ts.parsePesType(n,e.table),a=We.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(a&&!c&&(s=We.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),c=!0),!i.firstKeyFrame)){if(a&&0!==f.size){for(o=new Uint8Array(f.size),u=0;f.data.length;)d=f.data.shift(),o.set(d,u),u+=d.byteLength;if(We.ts.videoPacketContainsKeyFrame(o)){var p=We.ts.parsePesTime(o);p?(i.firstKeyFrame=p,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}f.size=0}f.data.push(n),f.size+=n.byteLength}}if(c&&i.firstKeyFrame)break;l+=188,h+=188}for(l=(h=t.byteLength)-188,c=!1;l>=0;)if(71!==t[l]||71!==t[h])l--,h--;else{switch(n=t.subarray(l,h),We.ts.parseType(n,e.pid)){case"pes":r=We.ts.parsePesType(n,e.table),a=We.ts.parsePayloadUnitStartIndicator(n),"video"===r&&a&&(s=We.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),c=!0)}if(c)break;l-=188,h-=188}},Xe=function(t,e){var i;return(i=We.aac.isLikelyAacData(t)?function(t){for(var e,i=!1,n=0,r=null,a=null,s=0,o=0;t.length-o>=3;){switch(We.aac.parseType(t,o)){case"timed-metadata":if(t.length-o<10){i=!0;break}if((s=We.aac.parseId3TagSize(t,o))>t.length){i=!0;break}null===a&&(e=t.subarray(o,o+s),a=We.aac.parseAacTimestamp(e)),o+=s;break;case"audio":if(t.length-o<7){i=!0;break}if((s=We.aac.parseAdtsSize(t,o))>t.length){i=!0;break}null===r&&(e=t.subarray(o,o+s),r=We.aac.parseSampleRate(e)),n++,o+=s;break;default:o++}if(i)return null}if(null===r||null===a)return null;var u=9e4/r;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*n*u,pts:a+1024*n*u}]}}(t):function(t){var e={pid:null,table:null},i={};for(var n in function(t,e){for(var i,n=0,r=188;r<t.byteLength;)if(71!==t[n]||71!==t[r])n++,r++;else{switch(i=t.subarray(n,r),We.ts.parseType(i,e.pid)){case"pat":e.pid||(e.pid=We.ts.parsePat(i));break;case"pmt":e.table||(e.table=We.ts.parsePmt(i))}if(e.pid&&e.table)return;n+=188,r+=188}}(t,e),e.table)if(e.table.hasOwnProperty(n))switch(e.table[n]){case 27:i.video=[],ze(t,e,i),0===i.video.length&&delete i.video;break;case 15:i.audio=[],je(t,e,i),0===i.audio.length&&delete i.audio}return i}(t))&&(i.audio||i.video)?(function(t,e){if(t.audio&&t.audio.length){var i=e;void 0===i&&(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=He(t.dts,i),t.pts=He(t.pts,i),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4})}if(t.video&&t.video.length){var n=e;if(void 0===n&&(n=t.video[0].dts),t.video.forEach(function(t){t.dts=He(t.dts,n),t.pts=He(t.pts,n),t.dtsTime=t.dts/9e4,t.ptsTime=t.pts/9e4}),t.firstKeyFrame){var r=t.firstKeyFrame;r.dts=He(r.dts,n),r.pts=He(r.pts,n),r.dtsTime=r.dts/9e4,r.ptsTime=r.dts/9e4}}}(i,e),i):null},Ye=function(t){return t?t.replace(/avc1\.(\d+)\.(\d+)/i,function(t,e,i){return"avc1."+("00"+Number(e).toString(16)).slice(-2)+"00"+("00"+Number(i).toString(16)).slice(-2)}):t},Qe=function(t){void 0===t&&(t="");var e={codecCount:0};e.codecCount=t.split(",").length,e.codecCount=e.codecCount||2;var i=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(t);return i&&(e.videoCodec=i[2],e.videoObjectTypeIndicator=i[3]),e.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(t),e.audioProfile=e.audioProfile&&e.audioProfile[2],e},Ke=function(t,e){var i=e.attributes||{};return t.mediaGroups.AUDIO&&i.AUDIO&&t.mediaGroups.AUDIO[i.AUDIO]},$e=function(t){return ue(t,["moof"]).length>0},Je=function(t){t.forEach(function(t){t.abort()})},Ze=function(t,e){return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:-101,xhr:e}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:-102,xhr:e}:t?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:2,xhr:e}:null},ti=function(t){var e=t.segment,i=t.bytes,n=t.isPartial,r=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.id3Fn,u=t.captionsFn,d=t.dataFn,l=t.doneFn,h=e.map&&e.map.tracks||{},c=Boolean(h.audio&&h.video),f=a.bind(null,e,"audio","start"),p=a.bind(null,e,"audio","end"),m=a.bind(null,e,"video","start"),g=a.bind(null,e,"video","end");if(!n&&!e.lastReachedChar){var y=function(t,e){var i=Xe(t,e*Ge);if(!i)return null;var n={hasVideo:i.video&&2===i.video.length||!1,hasAudio:i.audio&&2===i.audio.length||!1};return n.hasVideo&&(n.videoStart=i.video[0].ptsTime),n.hasAudio&&(n.audioStart=i.audio[0].ptsTime),n}(i,e.baseStartTime);y&&(r(e,{hasAudio:y.hasAudio,hasVideo:y.hasVideo}),r=null,y.hasAudio&&f(y.audioStart),y.hasVideo&&m(y.videoStart),f=null,m=null)}!function(t){if(!se)return se=t,void Ae(t);we.push(t)}({bytes:i,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,isPartial:n,remux:c,onData:function(t){t.type="combined"===t.type?"video":t.type,d(e,t)},onTrackInfo:function(t){r&&r(e,t)},onAudioTimingInfo:function(t){f&&void 0!==t.start&&(f(t.start),f=null),p&&void 0!==t.end&&p(t.end)},onVideoTimingInfo:function(t){m&&void 0!==t.start&&(m(t.start),m=null),g&&void 0!==t.end&&g(t.end)},onVideoSegmentTimingInfo:function(t){s(t)},onId3:function(t,i){o(e,t,i)},onCaptions:function(t){u(e,[t])},onDone:function(t){l&&!n&&(t.type="combined"===t.type?"video":t.type,l(null,e,t))}})},ei=function(t){var e=t.segment,i=t.bytes,n=t.isPartial,r=t.captionParser,a=t.trackInfoFn,s=t.timingInfoFn,o=t.videoSegmentTimingInfoFn,u=t.id3Fn,d=t.captionsFn,l=t.dataFn,h=t.doneFn,c=new Uint8Array(i);if($e(c)){e.isFmp4=!0;var f=e.map.tracks,p={hasVideo:!!f.video,hasAudio:!!f.audio};f.audio&&f.audio.codec&&"enca"!==f.audio.codec&&(p.audioCodec=f.audio.codec),f.video&&f.video.codec&&"encv"!==f.video.codec&&(p.videoCodec=f.video.codec),f.video&&f.audio&&(p.isMuxed=!0,p.hasAudio=!1),a(e,p);var m=oe.startTime(e.map.timescales,c);if(p.hasAudio&&s(e,"audio","start",m),p.hasVideo&&s(e,"video","start",m),l(e,{data:i,type:p.hasAudio?"audio":"video"}),r&&f.video){r.isInitialized()||r.init();var g=r.parse(e.bytes,[f.video.id],e.map.timescales);g&&g.captions&&g.captions.length>0&&d(e,g.captions)}h(null,e,{})}else e.transmuxer?ti({segment:e,bytes:i,isPartial:n,trackInfoFn:a,timingInfoFn:s,videoSegmentTimingInfoFn:o,id3Fn:u,captionsFn:d,dataFn:l,doneFn:h}):h(null,e,{})},ii=function(t){var e=t.xhr,i=t.xhrOptions,r=t.decryptionWorker,a=t.captionParser,s=t.segment,o=t.progressFn,u=t.trackInfoFn,d=t.timingInfoFn,l=t.videoSegmentTimingInfoFn,h=t.id3Fn,c=t.captionsFn,f=t.dataFn,p=t.doneFn,m=t.handlePartialData,g=[],y=function(t){var e=t.activeXhrs,i=t.decryptionWorker,n=t.captionParser,r=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.id3Fn,u=t.captionsFn,d=t.dataFn,l=t.doneFn,h=0,c=!1;return function(t,f){if(!c){if(t)return c=!0,Je(e),l(t,f);if((h+=1)===e.length){if(f.endOfAllRequests=Date.now(),f.encryptedBytes)return function(t){var e,i=t.decryptionWorker,n=t.segment,r=t.captionParser,a=t.trackInfoFn,s=t.timingInfoFn,o=t.videoSegmentTimingInfoFn,u=t.id3Fn,d=t.captionsFn,l=t.dataFn,h=t.doneFn;i.addEventListener("message",function t(e){if(e.data.source===n.requestId){i.removeEventListener("message",t);var c=e.data.decrypted;n.bytes=new Uint8Array(c.bytes,c.byteOffset,c.byteLength),ei({segment:n,bytes:n.bytes,isPartial:!1,captionParser:r,trackInfoFn:a,timingInfoFn:s,videoSegmentTimingInfoFn:o,id3Fn:u,captionsFn:d,dataFn:l,doneFn:h})}}),e=n.key.bytes.slice?n.key.bytes.slice():new Uint32Array(Array.prototype.slice.call(n.key.bytes)),i.postMessage(ft({source:n.requestId,encrypted:n.encryptedBytes,key:e,iv:n.key.iv}),[n.encryptedBytes.buffer,e.buffer])}({decryptionWorker:i,segment:f,captionParser:n,trackInfoFn:r,timingInfoFn:a,videoSegmentTimingInfoFn:s,id3Fn:o,captionsFn:u,dataFn:d,doneFn:l});ei({segment:f,bytes:f.bytes,isPartial:!1,captionParser:n,trackInfoFn:r,timingInfoFn:a,videoSegmentTimingInfoFn:s,id3Fn:o,captionsFn:u,dataFn:d,doneFn:l})}}}}({activeXhrs:g,decryptionWorker:r,captionParser:a,trackInfoFn:u,timingInfoFn:d,videoSegmentTimingInfoFn:l,id3Fn:h,captionsFn:c,dataFn:f,doneFn:p});if(s.key&&!s.key.bytes){var _=e(n.mergeOptions(i,{uri:s.key.resolvedUri,responseType:"arraybuffer"}),function(t,e){return function(i,n){var r=n.response,a=Ze(i,n);if(a)return e(a,t);if(16!==r.byteLength)return e({status:n.status,message:"Invalid HLS key at URL: "+n.uri,code:2,xhr:n},t);var s=new DataView(r);return t.key.bytes=new Uint32Array([s.getUint32(0),s.getUint32(4),s.getUint32(8),s.getUint32(12)]),e(null,t)}}(s,y));g.push(_)}if(s.map&&!s.map.bytes){var v=e(n.mergeOptions(i,{uri:s.map.resolvedUri,responseType:"arraybuffer",headers:J(s.map)}),function(t){var e=t.segment,i=t.finishProcessingFn;return function(t,n){var r=n.response,a=Ze(t,n);return a?i(a,e):0===r.byteLength?i({status:n.status,message:"Empty HLS segment content at URL: "+n.uri,code:2,xhr:n},e):(e.map.bytes=new Uint8Array(n.response),oe.tracks(e.map.bytes).forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale))}),i(null,e))}}({segment:s,captionParser:a,finishProcessingFn:y}));g.push(v)}var b=n.mergeOptions(i,{uri:s.resolvedUri,responseType:"arraybuffer",headers:J(s)});m&&(b.responseType="text",b.beforeSend=function(t){t.overrideMimeType("text/plain; charset=x-user-defined")});var T=e(b,function(t){var e=t.segment,i=t.finishProcessingFn,n=t.responseType;return function(t,r){var a=r.response,s=Ze(t,r);if(s)return i(s,e);var o="arraybuffer"===n?r.response:Ie(r.responseText.substring(e.lastReachedChar||0));return 0===a.byteLength?i({status:r.status,message:"Empty HLS segment content at URL: "+r.uri,code:2,xhr:r},e):(e.stats=function(t){return{bandwidth:t.bandwidth,bytesReceived:t.bytesReceived||0,roundTripTime:t.roundTripTime||0}}(r),e.key?e.encryptedBytes=new Uint8Array(o):e.bytes=new Uint8Array(o),i(null,e))}}({segment:s,finishProcessingFn:y,responseType:b.responseType}));return T.addEventListener("progress",function(t){var e=t.segment,i=t.progressFn,r=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.id3Fn,u=t.captionsFn,d=t.dataFn,l=t.handlePartialData;return function(t){var h=t.target;if(!h.aborted){if(l&&!e.key&&h.responseText.length>=8){var c=Ie(h.responseText.substring(e.lastReachedChar||0));!e.lastReachedChar&&$e(new Uint8Array(c))||(e.lastReachedChar=h.responseText.length,ei({segment:e,bytes:c,isPartial:!0,trackInfoFn:r,timingInfoFn:a,videoSegmentTimingInfoFn:s,id3Fn:o,captionsFn:u,dataFn:d}))}return e.stats=n.mergeOptions(e.stats,function(t){var e=t.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return i.bytesReceived=t.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i}(t)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),i(t,e)}}}({segment:s,progressFn:o,trackInfoFn:u,timingInfoFn:d,videoSegmentTimingInfoFn:l,id3Fn:h,captionsFn:c,dataFn:f,handlePartialData:m})),g.push(T),function(){return Je(g)}},ni="undefined"!=typeof window?window:{},ri="undefined"==typeof Symbol?"__target":Symbol(),ai="application/javascript",si=ni.BlobBuilder||ni.WebKitBlobBuilder||ni.MozBlobBuilder||ni.MSBlobBuilder,oi=ni.URL||ni.webkitURL||oi&&oi.msURL,ui=ni.Worker;function di(t,e){return function(i){var n=this;if(!e)return new ui(t);if(ui&&!i){var r=fi(e.toString().replace(/^function.+?{/,"").slice(0,-1));return this[ri]=new ui(r),function(t,e){if(t&&e){var i=t.terminate;t.objURL=e,t.terminate=function(){t.objURL&&oi.revokeObjectURL(t.objURL),i.call(t)}}}(this[ri],r),this[ri]}var a={postMessage:function(t){n.onmessage&&setTimeout(function(){n.onmessage({data:t,target:a})})}};e.call(a),this.postMessage=function(t){setTimeout(function(){a.onmessage({data:t,target:n})})},this.isThisThread=!0}}if(ui){var li,hi=fi("self.onmessage = function () {}"),ci=new Uint8Array(1);try{(li=new ui(hi)).postMessage(ci,[ci.buffer])}catch(t){ui=null}finally{oi.revokeObjectURL(hi),li&&li.terminate()}}function fi(t){try{return oi.createObjectURL(new Blob([t],{type:ai}))}catch(i){var e=new si;return e.append(t),oi.createObjectURL(e.getBlob(type))}}var pi=new di("./transmuxer-worker.worker.js",function(t,e){var i=this;
/*! @name @videojs/http-streaming @version 1.11.0-alpha.1 @license Apache-2.0 */!function(){var t=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var n;return!!t[e]&&(n=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(n,1),n>-1)},this.trigger=function(e){var i,n,r,a;if(i=t[e])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(a=[],n=arguments.length,n=1;n<arguments.length;++n)a.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,a)}},this.dispose=function(){t={}}}};t.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(e){t.flush(e)}),this.on("partialdone",function(e){t.partialFlush(e)}),this.on("endedtimeline",function(e){t.endTimeline(e)}),this.on("reset",function(e){t.reset(e)}),t},t.prototype.push=function(t){this.trigger("data",t)},t.prototype.flush=function(t){this.trigger("done",t)},t.prototype.partialFlush=function(t){this.trigger("partialdone",t)},t.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},t.prototype.reset=function(t){this.trigger("reset",t)};var e,n,r,a,s,o,u,d,l,h,c,f,p,m,g,y,_,v,b,T,S,I,w,A,L,U,E,k,O,P,D,C,R,x,M,F,B,N,q,V,G=t,H=Math.pow(2,32)-1;!function(){var t;if(I={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(t in I)I.hasOwnProperty(t)&&(I[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);w=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),L=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),U=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),E=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),k={video:U,audio:E},D=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),P=new Uint8Array([0,0,0,0,0,0,0,0]),C=new Uint8Array([0,0,0,0,0,0,0,0]),R=C,x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M=C,O=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),e=function(t){var e,i,n=[],r=0;for(e=1;e<arguments.length;e++)n.push(arguments[e]);for(e=n.length;e--;)r+=n[e].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(t,4),e=0,r=8;e<n.length;e++)i.set(n[e],r),r+=n[e].byteLength;return i},n=function(){return e(I.dinf,e(I.dref,D))},r=function(t){return e(I.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},g=function(t){return e(I.hdlr,k[t])},m=function(t){var i=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(i[12]=t.samplerate>>>24&255,i[13]=t.samplerate>>>16&255,i[14]=t.samplerate>>>8&255,i[15]=255&t.samplerate),e(I.mdhd,i)},p=function(t){return e(I.mdia,m(t),g(t.type),o(t))},s=function(t){return e(I.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},o=function(t){return e(I.minf,"video"===t.type?e(I.vmhd,O):e(I.smhd,P),n(),_(t))},u=function(t,i){for(var n=[],r=i.length;r--;)n[r]=b(i[r]);return e.apply(null,[I.moof,s(t)].concat(n))},d=function(t){for(var i=t.length,n=[];i--;)n[i]=c(t[i]);return e.apply(null,[I.moov,h(4294967295)].concat(n).concat(l(t)))},l=function(t){for(var i=t.length,n=[];i--;)n[i]=T(t[i]);return e.apply(null,[I.mvex].concat(n))},h=function(t){var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e(I.mvhd,i)},y=function(t){var i,n,r=t.samples||[],a=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)i=r[n].flags,a[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e(I.sdtp,a)},_=function(t){return e(I.stbl,v(t),e(I.stts,M),e(I.stsc,R),e(I.stsz,x),e(I.stco,C))},v=function(t){return e(I.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?F(t):B(t))},F=function(t){var i,n,r=t.sps||[],a=t.pps||[],s=[],o=[];for(i=0;i<r.length;i++)s.push((65280&r[i].byteLength)>>>8),s.push(255&r[i].byteLength),s=s.concat(Array.prototype.slice.call(r[i]));for(i=0;i<a.length;i++)o.push((65280&a[i].byteLength)>>>8),o.push(255&a[i].byteLength),o=o.concat(Array.prototype.slice.call(a[i]));if(n=[I.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),e(I.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([r.length],s,[a.length],o))),e(I.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],t.sarRatio){var u=t.sarRatio[0],d=t.sarRatio[1];n.push(e(I.pasp,new Uint8Array([(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u,(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))}return e.apply(null,n)},B=function(t){return e(I.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),r(t))},f=function(t){var i=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return e(I.tkhd,i)},b=function(t){var i,n,r,a,s,o;return i=e(I.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),s=Math.floor(t.baseMediaDecodeTime/(H+1)),o=Math.floor(t.baseMediaDecodeTime%(H+1)),n=e(I.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),"audio"===t.type?(r=S(t,92),e(I.traf,i,n,r)):(a=y(t),r=S(t,a.length+92),e(I.traf,i,n,r,a))},c=function(t){return t.duration=t.duration||4294967295,e(I.trak,f(t),p(t))},T=function(t){var i=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(i[i.length-1]=0),e(I.trex,i)},V=function(t,e){var i=0,n=0,r=0,a=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(r=4),void 0!==t[0].compositionTimeOffset&&(a=8)),[0,0,i|n|r|a,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},q=function(t,i){var n,r,a,s;for(i+=20+16*(r=t.samples||[]).length,n=V(r,i),s=0;s<r.length;s++)a=r[s],n=n.concat([(4278190080&a.duration)>>>24,(16711680&a.duration)>>>16,(65280&a.duration)>>>8,255&a.duration,(4278190080&a.size)>>>24,(16711680&a.size)>>>16,(65280&a.size)>>>8,255&a.size,a.flags.isLeading<<2|a.flags.dependsOn,a.flags.isDependedOn<<6|a.flags.hasRedundancy<<4|a.flags.paddingValue<<1|a.flags.isNonSyncSample,61440&a.flags.degradationPriority,15&a.flags.degradationPriority,(4278190080&a.compositionTimeOffset)>>>24,(16711680&a.compositionTimeOffset)>>>16,(65280&a.compositionTimeOffset)>>>8,255&a.compositionTimeOffset]);return e(I.trun,new Uint8Array(n))},N=function(t,i){var n,r,a,s;for(i+=20+8*(r=t.samples||[]).length,n=V(r,i),s=0;s<r.length;s++)a=r[s],n=n.concat([(4278190080&a.duration)>>>24,(16711680&a.duration)>>>16,(65280&a.duration)>>>8,255&a.duration,(4278190080&a.size)>>>24,(16711680&a.size)>>>16,(65280&a.size)>>>8,255&a.size]);return e(I.trun,new Uint8Array(n))},S=function(t,e){return"audio"===t.type?N(t,e):q(t,e)},a=function(){return e(I.ftyp,w,A,w,L)};var W,j,z,X,Y,Q,K,$,J=function(t){return e(I.mdat,t)},Z=u,tt=function(t){var e,i=a(),n=d(t);return(e=new Uint8Array(i.byteLength+n.byteLength)).set(i),e.set(n,i.byteLength),e},et=function(t,e){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=e,i.compositionTimeOffset=t.pts-t.dts,i.duration=t.duration,i.size=4*t.length,i.size+=t.byteLength,t.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},it=function(t){var e,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,n.byteLength=0,e=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r},nt=function(t){var e,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=t[0].pts,r.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},rt=function(t){var e;return!t[0][0].keyFrame&&t.length>1&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},at=function(t,e){var i,n=[];return i=et(t,e||0),n.push(i),n},st=function(t){var e,i,n=0,r=t.byteLength,a=t.length,s=new Uint8Array(r+4*a),o=new DataView(s.buffer);for(e=0;e<t.length;e++)i=t[e],o.setUint32(n,i.data.byteLength),n+=4,s.set(i.data,n),n+=i.data.byteLength;return s},ot=[33,16,5,32,164,27],ut=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],dt=function(t){for(var e=[];t--;)e.push(0);return e},lt={96000:[ot,[227,64],dt(154),[56]],88200:[ot,[231],dt(170),[56]],64000:[ot,[248,192],dt(240),[56]],48000:[ot,[255,192],dt(268),[55,148,128],dt(54),[112]],44100:[ot,[255,192],dt(268),[55,163,128],dt(84),[112]],32000:[ot,[255,192],dt(268),[55,234],dt(226),[112]],24000:[ot,[255,192],dt(268),[55,255,128],dt(268),[111,112],dt(126),[224]],16000:[ot,[255,192],dt(268),[55,255,128],dt(268),[111,255],dt(269),[223,108],dt(195),[1,192]],12000:[ut,dt(268),[3,127,248],dt(268),[6,255,240],dt(268),[13,255,224],dt(268),[27,253,128],dt(259),[56]],11025:[ut,dt(268),[3,127,248],dt(268),[6,255,240],dt(268),[13,255,224],dt(268),[27,255,192],dt(268),[55,175,128],dt(108),[112]],8000:[ut,dt(268),[3,121,16],dt(47),[7]]},ht=(W=lt,Object.keys(W).reduce(function(t,e){return t[e]=new Uint8Array(W[e].reduce(function(t,e){return t.concat(e)},[])),t},{}));Q=function(t,e){return j(Y(t,e))},K=function(t,e){return z(X(t),e)},$=function(t,e,i){return X(i?t:t-e)};var ct=(z=function(t,e){return t*e},X=function(t){return t/9e4}),ft=(Y=function(t,e){return t/e},Q),pt=K,mt=$,gt=j=function(t){return 9e4*t},yt=ct,_t=function(t,e,i,n){var r,a,s,o,u,d=0,l=0,h=0;if(e.length&&(r=ft(t.baseMediaDecodeTime,t.samplerate),a=Math.ceil(9e4/(t.samplerate/1024)),i&&n&&(d=r-Math.max(i,n),h=(l=Math.floor(d/a))*a),!(l<1||h>45e3))){for((s=ht[t.samplerate])||(s=e[0].data),o=0;o<l;o++)u=e[0],e.splice(0,0,{data:s,dts:u.dts-a,pts:u.pts-a});t.baseMediaDecodeTime-=Math.floor(pt(h,t.samplerate))}},vt=function(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))},bt=function(t){var e,i,n=[];for(e=0;e<t.length;e++)i=t[e],n.push({size:i.data.byteLength,duration:1024});return n},Tt=function(t){var e,i,n=0,r=new Uint8Array(function(t){var e,i=0;for(e=0;e<t.length;e++)i+=t[e].data.byteLength;return i}(t));for(e=0;e<t.length;e++)i=t[e],r.set(i.data,n),n+=i.data.byteLength;return r},St=function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},It=function(t,e){var i,n=t.minSegmentDts;return e||(n-=t.timelineStartInfo.dts),i=t.timelineStartInfo.baseMediaDecodeTime,i+=n,i=Math.max(0,i),"audio"===t.type&&(i*=t.samplerate/9e4,i=Math.floor(i)),i},wt=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))},At=function t(){t.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new Ot(0,0),new Ot(0,1),new Ot(1,0),new Ot(1,1)],this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this)};(At.prototype=new G).push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&4===(e=function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)r+=255,e++;if(r+=t[e++],!i.payload&&4===n){i.payloadType=n,i.payloadSize=r,i.payload=t.subarray(e,e+r);break}e+=r,n=0,r=0}return i}(t.escapedRBSP)).payloadType&&(i=function(t){return 181!==t.payload[0]?null:49!=(t.payload[1]<<8|t.payload[2])?null:"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])?null:3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)}(e)))if(t.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=function(t,e){var i,n,r,a,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a={type:3&e[2+(r=3*i)],pts:t},4&e[r+2]&&(a.ccData=e[r+3]<<8|e[r+4],s.push(a));return s}(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},At.prototype.flushCCStreams=function(t){this.ccStreams_.forEach(function(e){return"flush"===t?e.flush():e.partialFlush()},this)},At.prototype.flushStream=function(t){this.captionPackets_.length?(this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2&&this.dispatchCea608Packet(t)},this),this.captionPackets_.length=0,this.flushCCStreams(t)):this.flushCCStreams(t)},At.prototype.flush=function(){return this.flushStream("flush")},At.prototype.partialFlush=function(){return this.flushStream("partialFlush")},At.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},At.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},At.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},At.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)},At.prototype.setsTextOrXDSActive=function(t){return 256==(28928&t.ccData)||4138==(30974&t.ccData)||6186==(30974&t.ccData)};var Lt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Ut=function(t){return null===t?"":(t=Lt[t]||t,String.fromCharCode(t))},Et=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],kt=function(){for(var t=[],e=15;e--;)t.push("");return t},Ot=function t(e,i){t.prototype.init.call(this),this.field_=e||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,r,a;if((e=32639&t.ccData)!==this.lastControlCode_){if(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,r=255&e,e!==this.PADDING_)if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=kt();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=kt();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=kt()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,r))a=Ut((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=Ut((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&r)&&this.addFormatting(t.pts,["i"]),1==(1&r)&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var s=Et.indexOf(7968&e);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(t.pts,s)),s!==this.row_&&(this.clearFormatting(t.pts),this.row_=s),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)&&(this.column_=4*((14&e)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),a=Ut(n),a+=Ut(r),this[this.mode_](t.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};Ot.prototype=new G,Ot.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){try{return t.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},Ot.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=kt(),this.nonDisplayed_=kt(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ot.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ot.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&e>=48&&e<=63},Ot.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&e>=32&&e<=63},Ot.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&e>=32&&e<=47},Ot.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&e>=33&&e<=35},Ot.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&e>=64&&e<=127},Ot.prototype.isColorPAC=function(t){return t>=64&&t<=79||t>=96&&t<=127},Ot.prototype.isNormalChar=function(t){return t>=32&&t<=127},Ot.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=kt(),this.displayed_=kt()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},Ot.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,i)},Ot.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},"");this.formatting_=[],this[this.mode_](t,e)}},Ot.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},Ot.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},Ot.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},Ot.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i};var Pt={CaptionStream:At,Cea608Stream:Ot},Dt={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Ct=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},Rt=function t(e){var i,n;t.prototype.init.call(this),this.type_=e||"shared",this.push=function(t){"shared"!==this.type_&&t.type!==this.type_||(void 0===n&&(n=t.dts),t.dts=Ct(t.dts,n),t.pts=Ct(t.pts,n),i=t.dts,this.trigger("data",t))},this.flush=function(){n=i,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Rt.prototype=new G;var xt,Mt=Rt,Ft=function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r},Bt=function(t,e,i){return decodeURIComponent(Ft(t,e,i))},Nt=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},qt={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Bt(t.data,1,e),t.value=Bt(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Bt(t.data,1,e),t.url=Bt(t.data,e+1,t.data.length);break}},PRIV:function(t){var e,i;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=(i=t.data,unescape(Ft(i,0,e)));break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};(xt=function(t){var e,i={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},n=0,r=[],a=0;if(xt.prototype.init.call(this),this.dispatchType=Dt.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(e=0;e<i.descriptor.length;e++)this.dispatchType+=("00"+i.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,s,o,u,d;if("timed-metadata"===t.type)if(t.dataAlignmentIndicator&&(a=0,r.length=0),0===r.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))i.debug&&console.log("Skipping unrecognized metadata packet");else if(r.push(t),a+=t.data.byteLength,1===r.length&&(n=Nt(t.data.subarray(6,10)),n+=10),!(a<n)){for(e={data:new Uint8Array(n),frames:[],pts:r[0].pts,dts:r[0].dts},d=0;d<n;)e.data.set(r[0].data.subarray(0,n-d),d),d+=r[0].data.byteLength,a-=r[0].data.byteLength,r.shift();s=10,64&e.data[5]&&(s+=4,s+=Nt(e.data.subarray(10,14)),n-=Nt(e.data.subarray(16,20)));do{if((o=Nt(e.data.subarray(s+4,s+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((u={id:String.fromCharCode(e.data[s],e.data[s+1],e.data[s+2],e.data[s+3]),data:e.data.subarray(s+10,s+o+10)}).key=u.id,qt[u.id]&&(qt[u.id](u),"com.apple.streaming.transportStreamTimestamp"===u.owner)){var l=u.data,h=(1&l[3])<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;h*=4,h+=3&l[7],u.timeStamp=h,void 0===e.pts&&void 0===e.dts&&(e.pts=u.timeStamp,e.dts=u.timeStamp),this.trigger("timestamp",u)}e.frames.push(u),s+=10,s+=o}while(s<n);this.trigger("data",e)}}}).prototype=new G;var Vt,Gt,Ht,Wt=xt,jt=Mt;(Vt=function(){var t=new Uint8Array(188),e=0;Vt.prototype.init.call(this),this.push=function(i){var n,r=0,a=188;for(e?((n=new Uint8Array(i.byteLength+e)).set(t.subarray(0,e)),n.set(i,e),e=0):n=i;a<n.byteLength;)71!==n[r]||71!==n[a]?(r++,a++):(this.trigger("data",n.subarray(r,a)),r+=188,a+=188);r<n.byteLength&&(t.set(n.subarray(r),0),e=n.byteLength-r)},this.flush=function(){188===e&&71===t[0]&&(this.trigger("data",t),e=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){e=0,this.trigger("reset")}}).prototype=new G,(Gt=function(){var t,e,i,n;Gt.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,t=function(t,n){var r=0;n.payloadUnitStartIndicator&&(r+=t[r]+1),"pat"===n.type?e(t.subarray(r),n):i(t.subarray(r),n)},e=function(t,e){e.section_number=t[7],e.last_section_number=t[8],n.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=n.pmtPid},i=function(t,e){var i,r;if(1&t[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&t[1])<<8|t[2])-4,r=12+((15&t[10])<<8|t[11]);r<i;){var a=t[r],s=(31&t[r+1])<<8|t[r+2];a===Dt.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=s:a===Dt.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=s:a===Dt.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][s]=a),r+=5+((15&t[r+3])<<8|t[r+4])}e.programMapTable=n.programMapTable}},this.push=function(e){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&e[1]),i.pid=31&e[1],i.pid<<=8,i.pid|=e[2],(48&e[3])>>>4>1&&(n+=e[n]+1),0===i.pid)i.type="pat",t(e.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",t(e.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,n,i]):this.processPes_(e,n,i)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=Dt.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=Dt.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}}).prototype=new G,Gt.STREAM_TYPES={h264:27,adts:15},(Ht=function(){var t,e=this,i={data:[],size:0},n={data:[],size:0},r={data:[],size:0},a=function(t,i,n){var r,a,s=new Uint8Array(t.size),o={type:i},u=0,d=0;if(t.data.length&&!(t.size<9)){for(o.trackId=t.data[0].pid,u=0;u<t.data.length;u++)a=t.data[u],s.set(a.data,d),d+=a.data.byteLength;var l,h,c;l=s,(h=o).packetLength=6+(l[4]<<8|l[5]),h.dataAlignmentIndicator=0!=(4&l[6]),192&(c=l[7])&&(h.pts=(14&l[9])<<27|(255&l[10])<<20|(254&l[11])<<12|(255&l[12])<<5|(254&l[13])>>>3,h.pts*=4,h.pts+=(6&l[13])>>>1,h.dts=h.pts,64&c&&(h.dts=(14&l[14])<<27|(255&l[15])<<20|(254&l[16])<<12|(255&l[17])<<5|(254&l[18])>>>3,h.dts*=4,h.dts+=(6&l[18])>>>1)),h.data=l.subarray(9+l[8]),r="video"===i||o.packetLength<=t.size,(n||r)&&(t.size=0,t.data.length=0),r&&e.trigger("data",o)}};Ht.prototype.init.call(this),this.push=function(s){({pat:function(){},pes:function(){var t,e;switch(s.streamType){case Dt.H264_STREAM_TYPE:case Dt.H264_STREAM_TYPE:t=i,e="video";break;case Dt.ADTS_STREAM_TYPE:t=n,e="audio";break;case Dt.METADATA_STREAM_TYPE:t=r,e="timed-metadata";break;default:return}s.payloadUnitStartIndicator&&a(t,e,!0),t.data.push(s),t.size+=s.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]};null!==(t=s.programMapTable).video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),e.trigger("data",i)}})[s.type]()},this.reset=function(){i.size=0,i.data.length=0,n.size=0,n.data.length=0,this.trigger("reset")},this.flushStreams_=function(){a(i,"video"),a(n,"audio"),a(r,"timed-metadata")},this.flush=function(){this.flushStreams_(),this.trigger("done")}}).prototype=new G;var zt={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:Vt,TransportParseStream:Gt,ElementaryStream:Ht,TimestampRolloverStream:jt,CaptionStream:Pt.CaptionStream,Cea608Stream:Pt.Cea608Stream,MetadataStream:Wt};for(var Xt in Dt)Dt.hasOwnProperty(Xt)&&(zt[Xt]=Dt[Xt]);var Yt,Qt=zt,Kt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(Yt=function(t){var e,i=0;Yt.prototype.init.call(this),this.push=function(n){var r,a,s,o,u,d,l=0;if(t||(i=0),"audio"===n.type)for(e?(o=e,(e=new Uint8Array(o.byteLength+n.data.byteLength)).set(o),e.set(n.data,o.byteLength)):e=n.data;l+5<e.length;)if(255===e[l]&&240==(246&e[l+1])){if(a=2*(1&~e[l+1]),r=(3&e[l+3])<<11|e[l+4]<<3|(224&e[l+5])>>5,d=9e4*(u=1024*(1+(3&e[l+6])))/Kt[(60&e[l+2])>>>2],s=l+r,e.byteLength<s)return;if(this.trigger("data",{pts:n.pts+i*d,dts:n.dts+i*d,sampleCount:u,audioobjecttype:1+(e[l+2]>>>6&3),channelcount:(1&e[l+2])<<2|(192&e[l+3])>>>6,samplerate:Kt[(60&e[l+2])>>>2],samplingfrequencyindex:(60&e[l+2])>>>2,samplesize:16,data:e.subarray(l+7+a,s)}),i++,e.byteLength===s)return void(e=void 0);e=e.subarray(s)}else l++},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){e=void 0,this.trigger("reset")},this.endTimeline=function(){e=void 0,this.trigger("endedtimeline")}}).prototype=new G;var $t,Jt,Zt,te=Yt,ee=function(t){var e=t.byteLength,i=0,n=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+n},this.loadWord=function(){var r=t.byteLength-e,a=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw new Error("no bytes available");a.set(t.subarray(r,r+s)),i=new DataView(a.buffer).getUint32(0),n=8*s,e-=s},this.skipBits=function(t){var r;n>t?(i<<=t,n-=t):(t-=n,t-=8*(r=Math.floor(t/8)),e-=r,this.loadWord(),i<<=t,n-=t)},this.readBits=function(t){var r=Math.min(n,t),a=i>>>32-r;return(n-=r)>0?i<<=r:e>0&&this.loadWord(),(r=t-r)>0?a<<r|this.readBits(r):a},this.skipLeadingZeros=function(){var t;for(t=0;t<n;++t)if(0!=(i&2147483648>>>t))return i<<=t,n-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(Jt=function(){var t,e,i=0;Jt.prototype.init.call(this),this.push=function(n){var r;e?((r=new Uint8Array(e.byteLength+n.data.byteLength)).set(e),r.set(n.data,e.byteLength),e=r):e=n.data;for(var a=e.byteLength;i<a-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<a;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}i+3!==t-2&&this.trigger("data",e.subarray(i+3,t-2));do{t++}while(1!==e[t]&&t<a);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.reset=function(){e=null,i=0,this.trigger("reset")},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new G,Zt={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},($t=function(){var t,e,i,n,r,a,s,o=new Jt;$t.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(e=t.trackId,i=t.pts,n=t.dts,o.push(t))},o.on("data",function(s){var o={trackId:e,pts:i,dts:n,data:s};switch(31&s[0]){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(s.subarray(1)),o.config=a(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",o)}),o.on("done",function(){t.trigger("done")}),o.on("partialdone",function(){t.trigger("partialdone")}),o.on("reset",function(){t.trigger("reset")}),o.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(t,e){var i,n=8,r=8;for(i=0;i<t;i++)0!==r&&(r=(n+e.readExpGolomb()+256)%256),n=0===r?n:r},r=function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},a=function(t){var e,i,n,r,a,o,u,d,l,h,c,f,p,m=0,g=0,y=0,_=0,v=1;if(i=(e=new ee(t)).readUnsignedByte(),r=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),Zt[i]&&(3===(a=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(c=3!==a?8:12,p=0;p<c;p++)e.readBoolean()&&s(p<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(o=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===o)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),u=e.readUnsignedExpGolomb(),p=0;p<u;p++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),d=e.readUnsignedExpGolomb(),l=e.readUnsignedExpGolomb(),0===(h=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(m=e.readUnsignedExpGolomb(),g=e.readUnsignedExpGolomb(),y=e.readUnsignedExpGolomb(),_=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}f&&(v=f[0]/f[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:Math.ceil((16*(d+1)-2*m-2*g)*v),height:(2-h)*(l+1)*16-2*y-2*_,sarRatio:f}}}).prototype=new G;var ie,ne={H264Stream:$t,NalByteStream:Jt},re=function(t){return t[0]==="I".charCodeAt(0)&&t[1]==="D".charCodeAt(0)&&t[2]==="3".charCodeAt(0)},ae=function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return(16&t[e+5])>>4?i+20:i+10},se=function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i};(ie=function(){var t=new Uint8Array,e=0;ie.prototype.init.call(this),this.setTimestamp=function(t){e=t},this.push=function(i){var n,r,a,s,o=0,u=0;for(t.length?(s=t.length,(t=new Uint8Array(i.byteLength+s)).set(t.subarray(0,s)),t.set(i,s)):t=i;t.length-u>=3;)if(t[u]!=="I".charCodeAt(0)||t[u+1]!=="D".charCodeAt(0)||t[u+2]!=="3".charCodeAt(0))if(255!=(255&t[u])||240!=(240&t[u+1]))u++;else{if(t.length-u<7)break;if(u+(o=se(t,u))>t.length)break;a={type:"audio",data:t.subarray(u,u+o),pts:e,dts:e},this.trigger("data",a),u+=o}else{if(t.length-u<10)break;if(u+(o=ae(t,u))>t.length)break;r={type:"timed-metadata",data:t.subarray(u,u+o)},this.trigger("data",r),u+=o}n=t.length-u,t=n>0?t.subarray(u):new Uint8Array},this.reset=function(){t=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){t=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new G;var oe,ue,de,le,he=ie,ce=ne.H264Stream,fe=re,pe=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],me=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],ge=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},ye=function(t,e,i,n,r,a){return{start:{dts:t,pts:t+(i-e)},end:{dts:t+(n-e),pts:t+(r-i)},prependedContentDuration:a,baseMediaDecodeTime:t}};(ue=function(t,e){var i=[],n=0,r=0,a=0,s=1/0;e=e||{},ue.prototype.init.call(this),this.push=function(e){wt(t,e),t&&pe.forEach(function(i){t[i]=e[i]}),i.push(e)},this.setEarliestDts=function(e){r=e-t.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(t){s=t},this.setAudioAppendStart=function(t){a=t},this.flush=function(){var o,u,d,l,h;0!==i.length?(o=vt(i,t,r),t.baseMediaDecodeTime=It(t,e.keepOriginalTimestamps),_t(t,o,a,s),t.samples=bt(o),d=J(Tt(o)),i=[],u=Z(n,[t]),l=new Uint8Array(u.byteLength+d.byteLength),n++,l.set(u),l.set(d,u.byteLength),St(t),h=Math.ceil(9216e4/t.samplerate),o.length&&this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+o.length*h}),this.trigger("data",{track:t,boxes:l}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){St(t),i=[],this.trigger("reset")}}).prototype=new G,(oe=function(t,e){var i,n,r=0,a=[],s=[];e=e||{},oe.prototype.init.call(this),delete t.minPTS,this.gopCache_=[],this.push=function(e){wt(t,e),"seq_parameter_set_rbsp"!==e.nalUnitType||i||(i=e.config,t.sps=[e.data],me.forEach(function(e){t[e]=i[e]},this)),"pic_parameter_set_rbsp"!==e.nalUnitType||n||(n=e.data,t.pps=[e.data]),a.push(e)},this.flush=function(){for(var i,n,o,u,d,l,h,c,f=0;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=it(a),(o=nt(i))[0][0].keyFrame||((n=this.getGopForFusion_(a[0],t))?(f=n.duration,o.unshift(n),o.byteLength+=n.byteLength,o.nalCount+=n.nalCount,o.pts=n.pts,o.dts=n.dts,o.duration+=n.duration):o=rt(o)),s.length){var p;if(!(p=e.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");St(t),o=p}wt(t,o),t.samples=function(t,e){var i,n,r,a,s,o=e||0,u=[];for(i=0;i<t.length;i++)for(a=t[i],n=0;n<a.length;n++)s=a[n],o+=(r=et(s,o)).size,u.push(r);return u}(o),d=J(function(t){var e,i,n,r,a,s,o=0,u=t.byteLength,d=t.nalCount,l=new Uint8Array(u+4*d),h=new DataView(l.buffer);for(e=0;e<t.length;e++)for(r=t[e],i=0;i<r.length;i++)for(a=r[i],n=0;n<a.length;n++)s=a[n],h.setUint32(o,s.data.byteLength),o+=4,l.set(s.data,o),o+=s.data.byteLength;return l}(o)),t.baseMediaDecodeTime=It(t,e.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}})),h=o[0],c=o[o.length-1],this.trigger("segmentTimingInfo",ye(t.baseMediaDecodeTime,h.dts,h.pts,c.dts+c.duration,c.pts+c.duration,f)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",t.baseMediaDecodeTime),this.trigger("timelineStartInfo",t.timelineStartInfo),u=Z(r,[t]),l=new Uint8Array(u.byteLength+d.byteLength),r++,l.set(u),l.set(d,u.byteLength),this.trigger("data",{track:t,boxes:l}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),a=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){St(t),i=void 0,n=void 0},this.getGopForFusion_=function(e){var i,n,r,a,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)r=(a=this.gopCache_[s]).gop,t.pps&&ge(t.pps[0],a.pps[0])&&t.sps&&ge(t.sps[0],a.sps[0])&&(r.dts<t.timelineStartInfo.dts||(i=e.dts-r.dts-r.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=a,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(t){var e,i,n,r,a,o,u,d;for(a=t.byteLength,o=t.nalCount,u=t.duration,e=i=0;e<s.length&&i<t.length&&(n=s[e],r=t[i],n.pts!==r.pts);)r.pts>n.pts?e++:(i++,a-=r.byteLength,o-=r.nalCount,u-=r.duration);return 0===i?t:i===t.length?null:((d=t.slice(i)).byteLength=a,d.duration=u,d.nalCount=o,d.pts=d[0].pts,d.dts=d[0].dts,d)},this.alignGopsAtEnd_=function(t){var e,i,n,r,a,o,u;for(e=s.length-1,i=t.length-1,a=null,o=!1;e>=0&&i>=0;){if(n=s[e],r=t[i],n.pts===r.pts){o=!0;break}n.pts>r.pts?e--:(e===s.length-1&&(a=i),i--)}if(!o&&null===a)return null;if(0===(u=o?i:a))return t;var d=t.slice(u),l=d.reduce(function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t},{byteLength:0,duration:0,nalCount:0});return d.byteLength=l.byteLength,d.duration=l.duration,d.nalCount=l.nalCount,d.pts=d[0].pts,d.dts=d[0].dts,d},this.alignGopsWith=function(t){s=t}}).prototype=new G,(le=function(t,e){this.numberOfTracks=0,this.metadataStream=e,void 0!==(t=t||{}).remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps?this.keepOriginalTimestamps=t.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,le.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track,this.pendingBoxes.push(t.boxes)),void("audio"===t.track.type&&(this.audioTrack=t.track,this.pendingBoxes.unshift(t.boxes))))}}).prototype=new G,le.prototype.flush=function(t){var e,i,n,r,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,me.forEach(function(t){s.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,pe.forEach(function(t){s.info[t]=this.audioTrack[t]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=tt(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)s.data.set(this.pendingBoxes[r],a),a+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(e=this.pendingCaptions[r]).startTime=mt(e.startPts,o,this.keepOriginalTimestamps),e.endTime=mt(e.endPts,o,this.keepOriginalTimestamps),s.captionStreams[e.stream]=!0,s.captions.push(e);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=mt(i.pts,o,this.keepOriginalTimestamps),s.metadata.push(i);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),r=0;r<s.captions.length;r++)e=s.captions[r],this.trigger("caption",e);for(r=0;r<s.metadata.length;r++)i=s.metadata[r],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},le.prototype.setRemux=function(t){this.remuxTracks=t},(de=function(t){var e,i,n=this,r=!0;de.prototype.init.call(this),t=t||{},this.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new Qt.MetadataStream,r.aacStream=new he,r.audioTimestampRolloverStream=new Qt.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new Qt.TimestampRolloverStream("timed-metadata"),r.adtsStream=new te,r.coalesceStream=new le(t,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(t){r.aacStream.setTimestamp(t.timeStamp)}),r.aacStream.on("data",function(a){"timed-metadata"!==a.type||r.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new ue(i,t),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new Qt.MetadataStream,r.packetStream=new Qt.TransportPacketStream,r.parseStream=new Qt.TransportParseStream,r.elementaryStream=new Qt.ElementaryStream,r.timestampRolloverStream=new Qt.TimestampRolloverStream,r.adtsStream=new te,r.h264Stream=new ce,r.captionStream=new Qt.CaptionStream,r.coalesceStream=new le(t,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(a){var s;if("metadata"===a.type){for(s=a.tracks.length;s--;)e||"video"!==a.tracks[s].type?i||"audio"!==a.tracks[s].type||((i=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(e=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;e&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new oe(e,t),r.videoSegmentStream.on("timelineStartInfo",function(t){i&&(i.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts))}),r.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(t){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(t)}),r.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new ue(i,t),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(t){t.dispatchType=r.metadataStream.dispatchType,n.trigger("id3Frame",t)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(n){var r=this.transmuxPipeline_;t.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,St(i),t.keepOriginalTimestamps||(i.timelineStartInfo.baseMediaDecodeTime=n),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),e&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),e.timelineStartInfo.dts=void 0,e.timelineStartInfo.pts=void 0,St(e),r.captionStream.reset(),t.keepOriginalTimestamps||(e.timelineStartInfo.baseMediaDecodeTime=n)),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.setRemux=function(e){var i=this.transmuxPipeline_;t.remux=e,i&&i.coalesceStream&&i.coalesceStream.setRemux(e)},this.alignGopsWith=function(t){e&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.push=function(t){if(r){var e=fe(t);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new G;var _e={Transmuxer:de,VideoSegmentStream:oe,AudioSegmentStream:ue,AUDIO_PROPERTIES:pe,VIDEO_PROPERTIES:me,generateVideoSegmentTimingInfo:ye}.Transmuxer,ve={Adts:te,h264:ne},be=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Te=function t(e,i){var n=[],r=0,a=0,s=0,o=1/0,u=null,d=null;i=i||{},t.prototype.init.call(this),this.push=function(t){wt(e,t),e&&be.forEach(function(i){e[i]=t[i]}),n.push(t)},this.setEarliestDts=function(t){a=t},this.setVideoBaseMediaDecodeTime=function(t){o=t},this.setAudioAppendStart=function(t){s=t},this.processFrames_=function(){var t,l,h,c,f;0!==n.length&&0!==(t=vt(n,e,a)).length&&(e.baseMediaDecodeTime=It(e,i.keepOriginalTimestamps),_t(e,t,s,o),e.samples=bt(t),h=J(Tt(t)),n=[],l=Z(r,[e]),r++,e.initSegment=tt([e]),(c=new Uint8Array(l.byteLength+h.byteLength)).set(l),c.set(h,l.byteLength),St(e),null===u&&(d=u=t[0].pts),d+=t.length*(9216e4/e.samplerate),f={start:u},this.trigger("timingInfo",f),this.trigger("data",{track:e,boxes:c}))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:u,end:d}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){St(e),u=null,d=null},this.reset=function(){this.resetTiming_(),n=[],this.trigger("reset")}};Te.prototype=new G;var Se=Te,Ie=["width","height","profileIdc","levelIdc","profileCompatibility"],we=function t(e,i){var n,r,a,s=0,o=[],u=[],d=null,l=null,h=!0;i=i||{},t.prototype.init.call(this),this.push=function(t){wt(e,t),void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],Ie.forEach(function(t){e[t]=n[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),o.push(t)},this.processNals_=function(t){var n;for(o=u.concat(o);o.length&&"access_unit_delimiter_rbsp"!==o[0].nalUnitType;)o.shift();if(0!==o.length){var r=it(o);if(r.length)if(u=r[r.length-1],t&&(r.pop(),r.duration-=u.duration,r.nalCount-=u.length,r.byteLength-=u.byteLength),r.length){if(this.trigger("timelineStartInfo",e.timelineStartInfo),h){if(!(a=nt(r))[0][0].keyFrame){if(!(a=rt(a))[0][0].keyFrame)return o=[].concat.apply([],r).concat(u),void(u=[]);(r=[].concat.apply([],a)).duration=a.duration}h=!1}for(null===d&&(d=r[0].pts,l=d),l+=r.duration,this.trigger("timingInfo",{start:d,end:l}),n=0;n<r.length;n++){var c=r[n];e.samples=at(c);var f=J(st(c));St(e),wt(e,c),e.baseMediaDecodeTime=It(e,i.keepOriginalTimestamps);var p=Z(s,[e]);s++,e.initSegment=tt([e]);var m=new Uint8Array(p.byteLength+f.byteLength);m.set(p),m.set(f,p.byteLength),this.trigger("data",{track:e,boxes:m,sequence:s,videoFrameDts:c.dts})}o=[]}else o=[]}},this.resetTimingAndConfig_=function(){n=void 0,r=void 0,d=null,l=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),u=[],o=[],h=!0,this.trigger("reset")}};we.prototype=new G;var Ae=we,Le=re,Ue=function(t){return t.prototype=new G,t.prototype.init.call(t),t},Ee=function(t,e){t.on("data",e.trigger.bind(e,"data")),t.on("done",e.trigger.bind(e,"done")),t.on("partialdone",e.trigger.bind(e,"partialdone")),t.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),t.on("audioTimingInfo",e.trigger.bind(e,"audioTimingInfo")),t.on("videoTimingInfo",e.trigger.bind(e,"videoTimingInfo")),t.on("trackinfo",e.trigger.bind(e,"trackinfo")),t.on("id3Frame",function(i){i.dispatchType=t.metadataStream.dispatchType,i.cueTime=ct(i.pts),e.trigger("id3Frame",i)}),t.on("caption",function(t){e.trigger("caption",t)})},ke=function t(e){var i=null,n=!0;t.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(t){if(n){var r=Le(t);!r||i&&"aac"===i.type?r||i&&"ts"===i.type||(i=function(t){var e={type:"ts",tracks:{audio:null,video:null},packet:new Qt.TransportPacketStream,parse:new Qt.TransportParseStream,elementary:new Qt.ElementaryStream,videoRollover:new Qt.TimestampRolloverStream("video"),audioRollover:new Qt.TimestampRolloverStream("audio"),adts:new ve.Adts,h264:new ve.h264.H264Stream,captionStream:new Qt.CaptionStream,metadataStream:new Qt.MetadataStream,timedMetadataRollover:new Qt.TimestampRolloverStream("timed-metadata")};return e.headOfPipeline=e.packet,e.packet.pipe(e.parse).pipe(e.elementary),e.elementary.pipe(e.videoRollover).pipe(e.h264),e.h264.pipe(e.captionStream),e.elementary.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.elementary.pipe(e.audioRollover).pipe(e.adts),e.elementary.on("data",function(i){if("metadata"===i.type){for(var n=0;n<i.tracks.length;n++)e.tracks[i.tracks[n].type]||(e.tracks[i.tracks[n].type]=i.tracks[n]);e.tracks.video&&!e.videoSegmentStream&&(e.videoSegmentStream=new Ae(e.tracks.video,t),e.videoSegmentStream.on("timelineStartInfo",function(t){e.tracks.audio&&e.audioSegmentStream.setEarliestDts(t.dts)}),e.videoSegmentStream.on("timingInfo",e.trigger.bind(e,"videoTimingInfo")),e.videoSegmentStream.on("data",function(t){e.trigger("data",{type:"video",data:t})}),e.videoSegmentStream.on("done",e.trigger.bind(e,"done")),e.videoSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.videoSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.h264.pipe(e.videoSegmentStream)),e.tracks.audio&&!e.audioSegmentStream&&(e.audioSegmentStream=new Se(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adts.pipe(e.audioSegmentStream)),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video})}}),e.captionStream.on("data",function(i){var n;n=e.tracks.video&&e.tracks.video.timelineStartInfo.pts||0,i.startTime=mt(i.startPts,n,t.keepOriginalTimestamps),i.endTime=mt(i.endPts,n,t.keepOriginalTimestamps),e.trigger("caption",i)}),(e=Ue(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e}(e),Ee(i,this)):(i=function(t){var e={type:"aac",tracks:{audio:null},metadataStream:new Qt.MetadataStream,aacStream:new he,audioRollover:new Qt.TimestampRolloverStream("audio"),timedMetadataRollover:new Qt.TimestampRolloverStream("timed-metadata"),adtsStream:new te(!0)};return e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioRollover).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(i){"timed-metadata"!==i.type||e.audioSegmentStream||(e.tracks.audio=e.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},e.audioSegmentStream=new Se(e.tracks.audio,t),e.audioSegmentStream.on("data",function(t){e.trigger("data",{type:"audio",data:t})}),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video}))}),(e=Ue(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e}(e),Ee(i,this)),n=!1}i.headOfPipeline.push(t)},this.flush=function(){i&&(n=!0,i.headOfPipeline.flush())},this.partialFlush=function(){i&&i.headOfPipeline.partialFlush()},this.endTimeline=function(){i&&i.headOfPipeline.endTimeline()},this.reset=function(){i&&i.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(t){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=t),i&&(i.tracks.audio&&(i.tracks.audio.timelineStartInfo.dts=void 0,i.tracks.audio.timelineStartInfo.pts=void 0,St(i.tracks.audio),e.keepOriginalTimestamps||(i.tracks.audio.timelineStartInfo.baseMediaDecodeTime=t),i.audioRollover&&i.audioRollover.discontinuity()),i.tracks.video&&(i.videoSegmentStream&&(i.videoSegmentStream.gopCache_=[],i.videoRollover.discontinuity()),i.tracks.video.timelineStartInfo.dts=void 0,i.tracks.video.timelineStartInfo.pts=void 0,St(i.tracks.video),e.keepOriginalTimestamps||(i.tracks.video.timelineStartInfo.baseMediaDecodeTime=t)))},this.setRemux=function(t){e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.setAudioAppendStart=function(t){i&&i.tracks.audio&&i.audioSegmentStream&&i.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){}};ke.prototype=new G;var Oe=ke,Pe=function(t){return"AudioSegmentStream"===t?"audio":"VideoSegmentStream"===t?"video":""},De=function(){function t(t,e){this.options=e||{},this.self=t,this.init()}var e=t.prototype;return e.init=function(){var t,e;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=this.options.handlePartialData?new Oe(this.options):new _e(this.options),this.options.handlePartialData?(t=this.self,(e=this.transmuxer).on("data",function(e){var i={data:e.data.track.initSegment.buffer,byteOffset:e.data.track.initSegment.byteOffset,byteLength:e.data.track.initSegment.byteLength},n={boxes:{data:e.data.boxes.buffer,byteOffset:e.data.boxes.byteOffset,byteLength:e.data.boxes.byteLength},initSegment:i,type:e.type,sequence:e.data.sequence};void 0!==e.data.videoFrameDts&&(n.videoFrameDtsTime=yt(e.data.videoFrameDts)),t.postMessage({action:"data",segment:n},[n.boxes.data,n.initSegment.data])}),e.on("id3Frame",function(e){t.postMessage({action:"id3Frame",id3Frame:e})}),e.on("caption",function(e){t.postMessage({action:"caption",caption:e})}),e.on("done",function(e){t.postMessage({action:"done",type:Pe(e)})}),e.on("partialdone",function(e){t.postMessage({action:"partialdone",type:Pe(e)})}),e.on("endedsegment",function(e){t.postMessage({action:"endedSegment",type:Pe(e)})}),e.on("trackinfo",function(e){t.postMessage({action:"trackinfo",trackInfo:e})}),e.on("audioTimingInfo",function(e){if(null!==e.start){var i={start:yt(e.start)};e.end&&(i.end=yt(e.end)),t.postMessage({action:"audioTimingInfo",audioTimingInfo:i})}else t.postMessage({action:"audioTimingInfo",audioTimingInfo:e})}),e.on("videoTimingInfo",function(e){var i={start:yt(e.start)};e.end&&(i.end=yt(e.end)),t.postMessage({action:"videoTimingInfo",videoTimingInfo:i})})):function(t,e){e.on("data",function(e){var i=e.initSegment;e.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};var n=e.data;e.data=n.buffer,t.postMessage({action:"data",segment:e,byteOffset:n.byteOffset,byteLength:n.byteLength},[e.data])}),e.on("done",function(e){t.postMessage({action:"done"})}),e.on("gopInfo",function(e){t.postMessage({action:"gopInfo",gopInfo:e})}),e.on("videoSegmentTimingInfo",function(e){var i={start:{decode:yt(e.start.dts),presentation:yt(e.start.pts)},end:{decode:yt(e.end.dts),presentation:yt(e.end.pts)},baseMediaDecodeTime:yt(e.baseMediaDecodeTime)};e.prependedContentDuration&&(i.prependedContentDuration=yt(e.prependedContentDuration)),t.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:i})}),e.on("id3Frame",function(e){t.postMessage({action:"id3Frame",id3Frame:e})}),e.on("caption",function(e){t.postMessage({action:"caption",caption:e})}),e.on("trackinfo",function(e){t.postMessage({action:"trackinfo",trackInfo:e})}),e.on("audioTimingInfo",function(e){t.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:yt(e.start),end:yt(e.end)}})}),e.on("videoTimingInfo",function(e){t.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:yt(e.start),end:yt(e.end)}})})}(this.self,this.transmuxer)},e.push=function(t){var e=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(e)},e.reset=function(){this.transmuxer.reset()},e.setTimestampOffset=function(t){var e=t.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(gt(e)))},e.setAudioAppendStart=function(t){this.transmuxer.setAudioAppendStart(Math.ceil(gt(t.appendStart)))},e.setRemux=function(t){this.transmuxer.setRemux(t.remux)},e.flush=function(t){this.transmuxer.flush(),i.postMessage({action:"done",type:"transmuxed"})},e.partialFlush=function(t){this.transmuxer.partialFlush(),i.postMessage({action:"partialdone",type:"transmuxed"})},e.endTimeline=function(){this.transmuxer.endTimeline(),i.postMessage({action:"endedtimeline",type:"transmuxed"})},e.alignGopsWith=function(t){this.transmuxer.alignGopsWith(t.gopsToAlignWith.slice())},t}();new function(t){t.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new De(t,e.data.options):(this.messageHandlers||(this.messageHandlers=new De(t)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}}(i)}()}),mi=function(t,e){if(!t)return"";var n=i.getComputedStyle(t);return n?n[e]:""},gi=function(t,e){var i=t.slice();t.sort(function(t,n){var r=e(t,n);return 0===r?i.indexOf(t)-i.indexOf(n):r})},yi=function(t,e){var n,r;return t.attributes.BANDWIDTH&&(n=t.attributes.BANDWIDTH),n=n||i.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(r=e.attributes.BANDWIDTH),n-(r||i.Number.MAX_VALUE)},_i=function(){_i.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new Ii(0,0),new Ii(0,1),new Ii(1,0),new Ii(1,1)],this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this)};_i.prototype=new Pe,_i.prototype.push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&4===(e=function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)r+=255,e++;if(r+=t[e++],!i.payload&&4===n){i.payloadType=n,i.payloadSize=r,i.payload=t.subarray(e,e+r);break}e+=r,n=0,r=0}return i}(t.escapedRBSP)).payloadType&&(i=function(t){return 181!==t.payload[0]?null:49!=(t.payload[1]<<8|t.payload[2])?null:"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])?null:3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)}(e)))if(t.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=function(t,e){var i,n,r,a,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a={type:3&e[2+(r=3*i)],pts:t},4&e[r+2]&&(a.ccData=e[r+3]<<8|e[r+4],s.push(a));return s}(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},_i.prototype.flushCCStreams=function(t){this.ccStreams_.forEach(function(e){return"flush"===t?e.flush():e.partialFlush()},this)},_i.prototype.flushStream=function(t){this.captionPackets_.length?(this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2&&this.dispatchCea608Packet(t)},this),this.captionPackets_.length=0,this.flushCCStreams(t)):this.flushCCStreams(t)},_i.prototype.flush=function(){return this.flushStream("flush")},_i.prototype.partialFlush=function(){return this.flushStream("partialFlush")},_i.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},_i.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},_i.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},_i.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)},_i.prototype.setsTextOrXDSActive=function(t){return 256==(28928&t.ccData)||4138==(30974&t.ccData)||6186==(30974&t.ccData)};var vi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},bi=function(t){return null===t?"":(t=vi[t]||t,String.fromCharCode(t))},Ti=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Si=function(){for(var t=[],e=15;e--;)t.push("");return t},Ii=function(t,e){Ii.prototype.init.call(this),this.field_=t||0,this.dataChannel_=e||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,r,a;if((e=32639&t.ccData)!==this.lastControlCode_){if(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,r=255&e,e!==this.PADDING_)if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=Si();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Si();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=Si()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,r))a=bi((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=bi((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&r)&&this.addFormatting(t.pts,["i"]),1==(1&r)&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var s=Ti.indexOf(7968&e);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(t.pts,s)),s!==this.row_&&(this.clearFormatting(t.pts),this.row_=s),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)&&(this.column_=4*((14&e)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),a=bi(n),a+=bi(r),this[this.mode_](t.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};Ii.prototype=new Pe,Ii.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){try{return t.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},Ii.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Si(),this.nonDisplayed_=Si(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ii.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ii.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&e>=48&&e<=63},Ii.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&e>=32&&e<=63},Ii.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&e>=32&&e<=47},Ii.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&e>=33&&e<=35},Ii.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&e>=64&&e<=127},Ii.prototype.isColorPAC=function(t){return t>=64&&t<=79||t>=96&&t<=127},Ii.prototype.isNormalChar=function(t){return t>=32&&t<=127},Ii.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=Si(),this.displayed_=Si()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},Ii.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,i)},Ii.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},"");this.formatting_=[],this[this.mode_](t,e)}},Ii.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},Ii.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},Ii.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},Ii.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i};var wi=function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},Ai={CaptionStream:_i,Cea608Stream:Ii}.CaptionStream,Li=function(t,e){for(var i=t,n=0;n<e.length;n++){var r=e[n];if(i<r.size)return r;i-=r.size}return null},Ui=function(t,e){var i=oe.findBox(t,["moof","traf"]),n=oe.findBox(t,["mdat"]),r={},a=[];return n.forEach(function(t,e){var n=i[e];a.push({mdat:t,traf:n})}),a.forEach(function(t){var i,n=t.mdat,a=t.traf,s=oe.findBox(a,["tfhd"]),o=pe.parseTfhd(s[0]),u=o.trackId,d=oe.findBox(a,["tfdt"]),l=d.length>0?pe.parseTfdt(d[0]).baseMediaDecodeTime:0,h=oe.findBox(a,["trun"]);e===u&&h.length>0&&(i=function(t,e,i){var n,r,a,s,o=new DataView(t.buffer,t.byteOffset,t.byteLength),u=[];for(r=0;r+4<t.length;r+=a)if(a=o.getUint32(r),r+=4,!(a<=0))switch(31&t[r]){case 6:var d=t.subarray(r+1,r+1+a),l=Li(r,e);n={nalUnitType:"sei_rbsp",size:a,data:d,escapedRBSP:wi(d),trackId:i},l?(n.pts=l.pts,n.dts=l.dts,s=l):(n.pts=s.pts,n.dts=s.dts),u.push(n)}return u}(n,function(t,e,i){var n=e,r=i.defaultSampleDuration||0,a=i.defaultSampleSize||0,s=i.trackId,o=[];return t.forEach(function(t){var e=pe.parseTrun(t).samples;e.forEach(function(t){void 0===t.duration&&(t.duration=r),void 0===t.size&&(t.size=a),t.trackId=s,t.dts=n,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),t.pts=n+t.compositionTimeOffset,n+=t.duration}),o=o.concat(e)}),o}(h,l,o),u),r[u]||(r[u]=[]),r[u]=r[u].concat(i))}),r},Ei=function(){var t,e,i,n,r,a,s=!1;this.isInitialized=function(){return s},this.init=function(e){t=new Ai,s=!0,a=!!e&&e.isPartial,t.on("data",function(t){t.startTime=t.startPts/n,t.endTime=t.endPts/n,r.captions.push(t),r.captionStreams[t.stream]=!0})},this.isNewInit=function(t,e){return!(t&&0===t.length||e&&"object"==typeof e&&0===Object.keys(e).length||i===t[0]&&n===e[i])},this.parse=function(t,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],n=s[i];else if(null===i||!n)return e.push(t),null;for(;e.length>0;){var u=e.shift();this.parse(u,a,s)}return null!==(o=function(t,e,i){return null===e?null:{seiNals:Ui(t,e)[e],timescale:i}}(t,i,n))&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):null},this.pushNals=function(e){if(!this.isInitialized()||!e||0===e.length)return null;e.forEach(function(e){t.push(e)})},this.flushStream=function(){if(!this.isInitialized())return null;a?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){e=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()},ki=function(t){return n.log.debug?n.log.debug.bind(n,"VHS:",t+" >"):function(){}},Oi=function(t,e,i){var n,r;if(i&&i.cues)for(n=i.cues.length;n--;)(r=i.cues[n]).startTime>=t&&r.endTime<=e&&i.removeCue(r)},Pi=function(t){return"number"==typeof t&&isFinite(t)},Di=function(t){return t+"TimingInfo"},Ci=function(t){function e(e,i){var r;if(r=t.call(this)||this,!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");return r.bandwidth=e.bandwidth,r.throughput={rate:0,count:0},r.roundTrip=NaN,r.resetStats_(),r.mediaIndex=null,r.hasPlayed_=e.hasPlayed,r.currentTime_=e.currentTime,r.seekable_=e.seekable,r.seeking_=e.seeking,r.duration_=e.duration,r.mediaSource_=e.mediaSource,r.hls_=e.hls,r.loaderType_=e.loaderType,r.startingMedia_=void 0,r.segmentMetadataTrack_=e.segmentMetadataTrack,r.goalBufferLength_=e.goalBufferLength,r.sourceType_=e.sourceType,r.sourceUpdater_=e.sourceUpdater,r.inbandTextTracks_=e.inbandTextTracks,r.state_="INIT",r.handlePartialData_=e.handlePartialData,r.checkBufferTimeout_=null,r.error_=void 0,r.currentTimeline_=-1,r.pendingSegment_=null,r.xhrOptions_=null,r.pendingSegments_=[],r.audioDisabled_=!1,r.gopBuffer_=[],r.timeMapping_=0,r.safeAppend_=n.browser.IE_VERSION>=11,r.appendInitSegment_={audio:!0,video:!0},r.playlistOfLastInitSegment_={audio:null,video:null},r.callQueue_=[],r.metadataQueue_={id3:[],caption:[]},r.activeInitSegmentId_=null,r.initSegments_={},r.cacheEncryptionKeys_=e.cacheEncryptionKeys,r.keyCache_={},"main"===r.loaderType_?r.captionParser_=new Ei:r.captionParser_=null,r.decrypter_=e.decrypter,r.syncController_=e.syncController,r.syncPoint_={segmentIndex:0,time:0},r.transmuxer_=r.createTransmuxer_(),r.syncController_.on("syncinfoupdate",function(){return r.trigger("syncinfoupdate")}),r.mediaSource_.addEventListener("sourceopen",function(){r.isEndOfStream_()||(r.ended_=!1)}),r.fetchAtBuffer_=!1,r.logger_=ki("SegmentLoader["+r.loaderType_+"]"),Object.defineProperty(a(r),"state",{get:function(){return this.state_},set:function(t){t!==this.state_&&(this.logger_(this.state_+" -> "+t),this.state_=t,this.trigger("statechange"))}}),r.sourceUpdater_.on("ready",function(){r.hasEnoughInfoToAppend_()&&r.processCallQueue_()}),r}r(e,t);var s=e.prototype;return s.createTransmuxer_=function(){var t=new pi;return t.postMessage({action:"init",options:{remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,handlePartialData:this.handlePartialData_}}),t},s.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0},s.dispose=function(){this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&(this.transmuxer_.terminate(),se=null,we.length=0),this.resetStats_(),this.captionParser_&&this.captionParser_.reset()},s.setAudio=function(t){this.audioDisabled_=!t,t&&(this.appendInitSegment_.audio=!0)},s.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},s.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},s.checkForAbort_=function(t){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==t:(this.state="READY",!0)},s.error=function(t){return void 0!==t&&(this.logger_("error occurred:",t),this.error_=t),this.pendingSegment_=null,this.error_},s.endOfStream=function(){this.ended_=!0,this.transmuxer_&&ke(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},s.buffered_=function(){return this.sourceUpdater_&&this.startingMedia_?this.startingMedia_.hasAudio&&this.startingMedia_.hasVideo?this.sourceUpdater_.buffered():this.startingMedia_.hasAudio?this.sourceUpdater_.audioBuffered():this.sourceUpdater_.videoBuffered():n.createTimeRanges()},s.initSegmentForMap=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=pt(t),n=this.initSegments_[i];return e&&!n&&t.bytes&&(this.initSegments_[i]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:t.bytes,tracks:t.tracks,timescales:t.timescales}),n||t},s.segmentKey=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=mt(t),n=this.keyCache_[i];this.cacheEncryptionKeys_&&e&&!n&&t.bytes&&(this.keyCache_[i]=n={resolvedUri:t.resolvedUri,bytes:t.bytes});var r={resolvedUri:(n||t).resolvedUri};return n&&(r.bytes=n.bytes),r},s.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},s.load=function(){if(this.monitorBuffer_(),this.playlist_){if(this.syncController_.setDateTimeMapping(this.playlist_),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}},s.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},s.playlist=function(t,e){if(void 0===e&&(e={}),t){var i=this.playlist_,n=this.pendingSegment_;this.playlist_=t,this.xhrOptions_=e,this.hasPlayed_()||(t.syncInfo={mediaSequence:t.mediaSequence,time:0});var r=null;if(i&&(i.id?r=i.id:i.uri&&(r=i.uri)),this.logger_("playlist update ["+r+" => "+(t.id||t.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(i&&i.uri===t.uri){var a=t.mediaSequence-i.mediaSequence;this.logger_("live window shift ["+a+"]"),null!==this.mediaIndex&&(this.mediaIndex-=a),n&&(n.mediaIndex-=a,n.mediaIndex>=0&&(n.segment=t.segments[n.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(i,t)}else(null!==this.mediaIndex||this.handlePartialData_)&&this.resyncLoader()}},s.pause=function(){this.checkBufferTimeout_&&(i.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},s.paused=function(){return null===this.checkBufferTimeout_},s.resetEverything=function(t){this.ended_=!1,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,this.duration_(),t),this.captionParser_&&this.captionParser_.clearAllCaptions()},s.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},s.resyncLoader=function(){this.transmuxer_&&ke(this.transmuxer_),this.mediaIndex=null,this.syncPoint_=null,this.callQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.captionParser_&&this.captionParser_.clearParsedCaptions()},s.remove=function(t,e,i){if(void 0===i&&(i=function(){}),this.sourceUpdater_&&this.startingMedia_){var n=1,r=function(){0==--n&&i()};for(var a in this.audioDisabled_||(n++,this.sourceUpdater_.removeAudio(t,e,r)),"main"===this.loaderType_&&this.startingMedia_.hasVideo&&(this.gopBuffer_=function(t,e,i,n){for(var r=Math.ceil((e-n)*Ge),a=Math.ceil((i-n)*Ge),s=t.slice(),o=t.length;o--&&!(t[o].pts<=a););if(-1===o)return s;for(var u=o+1;u--&&!(t[u].pts<=r););return u=Math.max(u,0),s.splice(u,o-u+1),s}(this.gopBuffer_,t,e,this.timeMapping_),n++,this.sourceUpdater_.removeVideo(t,e,r)),this.inbandTextTracks_)Oi(t,e,this.inbandTextTracks_[a]);Oi(t,e,this.segmentMetadataTrack_),r()}},s.monitorBuffer_=function(){this.checkBufferTimeout_&&i.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=i.setTimeout(this.monitorBufferTick_.bind(this),1)},s.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&i.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=i.setTimeout(this.monitorBufferTick_.bind(this),500)},s.fillBuffer_=function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var t=this.buffered_(),e=this.checkBuffer_(t,this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);e&&(e.mediaIndex!==this.playlist_.segments.length-1||"ended"!==this.mediaSource_.readyState||this.seeking_())&&((e.timeline!==this.currentTimeline_||this.startsBeforeSourceBufferTimestampOffset(e))&&(e.timestampOffset=t.length?t.end(t.length-1):e.startOfSegment,this.captionParser_&&this.captionParser_.clearAllCaptions()),this.loadSegment_(e))}},s.startsBeforeSourceBufferTimestampOffset=function(t){return null!==t.startOfSegment&&("main"===this.loaderType_&&t.startOfSegment<this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&t.startOfSegment<this.sourceUpdater_.audioTimestampOffset())},s.isEndOfStream_=function(t,e){if(void 0===t&&(t=this.mediaIndex),void 0===e&&(e=this.playlist_),!e||!this.mediaSource_)return!1;var i=t+1===e.segments.length;return e.endList&&"open"===this.mediaSource_.readyState&&i},s.checkBuffer_=function(t,e,i,n,r,a){var s,o=0;t.length&&(o=t.end(t.length-1));var u=Math.max(0,o-r);if(!e.segments.length)return null;if(u>=this.goalBufferLength_())return null;if(!n&&u>=1)return null;if(null===a)return i=this.getSyncSegmentCandidate_(e),this.generateSegmentInfo_(e,i,null,!0);if(null!==i){var d=e.segments[i];return s=d&&d.end?d.end:o,this.generateSegmentInfo_(e,i+1,s,!1)}if(this.fetchAtBuffer_){var l=Y.getMediaInfoForTime(e,o,a.segmentIndex,a.time);i=l.mediaIndex,s=l.startTime}else{var h=Y.getMediaInfoForTime(e,r,a.segmentIndex,a.time);i=h.mediaIndex,s=h.startTime}return this.generateSegmentInfo_(e,i,s,!1)},s.getSyncSegmentCandidate_=function(t){var e=this;if(-1===this.currentTimeline_)return 0;var i=t.segments.map(function(t,e){return{timeline:t.timeline,segmentIndex:e}}).filter(function(t){return t.timeline===e.currentTimeline_});return i.length?i[Math.min(i.length-1,1)].segmentIndex:Math.max(t.segments.length-1,0)},s.generateSegmentInfo_=function(t,e,i,n){if(e<0||e>=t.segments.length)return null;var r,a,s=t.segments[e],o=this.sourceUpdater_.audioBuffered(),u=this.sourceUpdater_.videoBuffered();return o.length&&(r=o.end(o.length-1)-this.sourceUpdater_.audioTimestampOffset()),u.length&&(a=function(t,e,i){if(null==e||!t.length)return[];var n,r=Math.ceil((e-i+3)*Ge);for(n=0;n<t.length&&!(t[n].pts>r);n++);return t.slice(n)}(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),{requestId:"segment-loader-"+Math.random(),uri:s.resolvedUri,mediaIndex:e,isSyncRequest:n,startOfSegment:i,playlist:t,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:s.timeline,duration:s.duration,segment:s,byteLength:0,transmuxer:this.transmuxer_,audioAppendStart:r,gopsToAlignWith:a}},s.abortRequestEarly_=function(t){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return!1;if(Date.now()-(t.firstBytesReceivedAt||Date.now())<1e3)return!1;var e=this.currentTime_(),i=t.bandwidth,n=this.pendingSegment_.duration,r=Y.estimateSegmentRequestTime(n,i,this.playlist_,t.bytesReceived),a=function(t,e,i){return void 0===i&&(i=1),((t.length?t.end(t.length-1):0)-e)/i}(this.buffered_(),e,this.hls_.tech_.playbackRate())-1;if(r<=a)return!1;var s=function(t){var e=t.currentTime,i=t.bandwidth,n=t.duration,r=t.segmentDuration,a=t.timeUntilRebuffer,s=t.currentTimeline,o=t.syncController,u=t.master.playlists.filter(function(t){return!Y.isIncompatible(t)}),d=u.filter(Y.isEnabled);d.length||(d=u.filter(function(t){return!Y.isDisabled(t)}));var l=d.filter(Y.hasAttribute.bind(null,"BANDWIDTH")).map(function(t){var u=o.getSyncPoint(t,n,s,e)?1:2;return{playlist:t,rebufferingImpact:Y.estimateSegmentRequestTime(r,i,t)*u-a}}),h=l.filter(function(t){return t.rebufferingImpact<=0});return gi(h,function(t,e){return yi(e.playlist,t.playlist)}),h.length?h[0]:(gi(l,function(t,e){return t.rebufferingImpact-e.rebufferingImpact}),l[0]||null)}({master:this.hls_.playlists.master,currentTime:e,bandwidth:i,duration:this.duration_(),segmentDuration:n,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(s){var o=r-a-s.rebufferingImpact,u=.5;return a<=1/30&&(u=1),!(!s.playlist||s.playlist.uri===this.playlist_.uri||o<u)&&(this.bandwidth=s.playlist.attributes.BANDWIDTH*Se.BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),!0)}},s.handleProgress_=function(t,e){this.checkForAbort_(e.requestId)||this.abortRequestEarly_(e.stats)||this.trigger("progress")},s.handleTrackInfo_=function(t,e){this.checkForAbort_(t.requestId)||this.abortRequestEarly_(t.stats)||(e||(e={hasAudio:"audio"===this.loaderType_,hasVideo:"main"===this.loaderType_}),void 0===this.startingMedia_&&(e.hasAudio||e.hasVideo)&&(this.startingMedia_=e),this.trigger("trackinfo"),this.checkForIllegalMediaSwitch(e))},s.handleTimingInfo_=function(t,e,i,n){if(!this.checkForAbort_(t.requestId)&&!this.abortRequestEarly_(t.stats)){var r=this.pendingSegment_,a=Di(e);r[a]=r[a]||{},r[a][i]=n,this.logger_("timinginfo: "+e+" - "+i+" - "+n),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}},s.handleCaptions_=function(t,e){var n=this;if(!this.checkForAbort_(t.requestId)&&!this.abortRequestEarly_(t.stats))if(0!==e.length)if(this.pendingSegment_.hasAppendedData_){var r=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),a={};e.forEach(function(t){a[t.stream]=a[t.stream]||{startTime:1/0,captions:[],endTime:0};var e=a[t.stream];e.startTime=Math.min(e.startTime,t.startTime+r),e.endTime=Math.max(e.endTime,t.endTime+r),e.captions.push(t)}),Object.keys(a).forEach(function(t){var e=a[t],s=e.startTime,o=e.endTime,u=e.captions,d=n.inbandTextTracks_;n.logger_("adding cues from "+s+" -> "+o+" for "+t),function(t,e,i){if(!t[i]){e.trigger({type:"usage",name:"hls-608"});var n=e.textTracks().getTrackById(i);t[i]=n||e.addRemoteTextTrack({kind:"captions",id:i,label:i},!1).track}}(d,n.hls_.tech_,t),Oi(s,o,d[t]),function(t){var e=t.inbandTextTracks,n=t.captionArray,r=t.timestampOffset;if(n){var a=i.WebKitDataCue||i.VTTCue;n.forEach(function(t){var i=t.stream;e[i].addCue(new a(t.startTime+r,t.endTime+r,t.text))})}}({captionArray:u,inbandTextTracks:d,timestampOffset:r})}),this.captionParser_&&this.captionParser_.clearParsedCaptions()}else this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,t,e));else this.logger_("SegmentLoader received no captions from a caption event")},s.handleId3_=function(t,e,r){if(!this.checkForAbort_(t.requestId)&&!this.abortRequestEarly_(t.stats))if(this.pendingSegment_.hasAppendedData_){var a=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();!function(t,e,i){t.metadataTrack_||(t.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,t.metadataTrack_.inBandMetadataTrackDispatchType=e)}(this.inbandTextTracks_,r,this.hls_.tech_),function(t){var e=t.inbandTextTracks,r=t.metadataArray,a=t.timestampOffset,s=t.videoDuration;if(r){var o=i.WebKitDataCue||i.VTTCue,u=e.metadataTrack_;if(u&&(r.forEach(function(t){var e=t.cueTime+a;!("number"!=typeof e||i.isNaN(e)||e<0)&&e<1/0&&t.frames.forEach(function(t){var i=new o(e,e,t.value||t.url||t.data||"");i.frame=t,i.value=t,function(t){Object.defineProperties(t.frame,{id:{get:function(){return n.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),t.value.key}},value:{get:function(){return n.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),t.value.data}},privateData:{get:function(){return n.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),t.value.data}}})}(i),u.addCue(i)})}),u.cues&&u.cues.length)){for(var d=u.cues,l=[],h=0;h<d.length;h++)d[h]&&l.push(d[h]);var c=l.reduce(function(t,e){var i=t[e.startTime]||[];return i.push(e),t[e.startTime]=i,t},{}),f=Object.keys(c).sort(function(t,e){return Number(t)-Number(e)});f.forEach(function(t,e){var i=c[t],n=Number(f[e+1])||s;i.forEach(function(t){t.endTime=n})})}}}({inbandTextTracks:this.inbandTextTracks_,metadataArray:e,timestampOffset:a,videoDuration:this.duration_()})}else this.metadataQueue_.id3.push(this.handleId3_.bind(this,t,e,r))},s.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(t){return t()}),this.metadataQueue_.caption.forEach(function(t){return t()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},s.processCallQueue_=function(){var t=this.callQueue_;this.callQueue_=[],t.forEach(function(t){return t()})},s.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready())return!1;var t=this.pendingSegment_;if(!t||!this.startingMedia_)return!1;if(!this.handlePartialData_){if(this.startingMedia_.hasVideo&&!t.videoTimingInfo)return!1;if(this.startingMedia_.hasAudio&&!t.audioTimingInfo)return!1}return!0},s.handleData_=function(t,e){if(!this.checkForAbort_(t.requestId)&&!this.abortRequestEarly_(t.stats))if(!this.callQueue_.length&&this.hasEnoughInfoToAppend_()){var i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.segment),"closed"!==this.mediaSource_.readyState){if(t.map&&(t.map=this.initSegmentForMap(t.map,!0),i.segment.map=t.map),t.key&&this.segmentKey(t.key,!0),i.isFmp4=t.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[Di(e.type)].start;else{var n,r="main"===this.loaderType_&&this.startingMedia_.hasVideo;r&&(n=this.handlePartialData_?e.videoFrameDtsTime:i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:r,firstVideoFrameTimeForData:n,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}this.updateAppendInitSegmentStatus(i,e.type),this.updateSourceBufferTimestampOffset_(i),i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,e)}}else this.callQueue_.push(this.handleData_.bind(this,t,e))},s.updateAppendInitSegmentStatus=function(t,e){"main"!==this.loaderType_||"number"!=typeof t.timestampOffset||t.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[e]!==t.playlist&&(this.appendInitSegment_[e]=!0)},s.getInitSegmentAndUpdateState_=function(t){var e=t.type,i=t.initSegment,n=t.map,r=t.playlist;if(n){var a=pt(n);if(this.activeInitSegmentId_===a)return null;i=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=a}return i&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!!n,this.activeInitSegmentId_=null,i):null},s.appendToSourceBuffer_=function(t){var e=this,i=t.segmentInfo,n=t.type,r=t.initSegment,a=t.data,s=[a],o=a.byteLength;r&&(s.unshift(r),o+=r.byteLength);var u,d,l,h=(l=0,(u={bytes:o,segments:s}).bytes&&(d=new Uint8Array(u.bytes),u.segments.forEach(function(t){d.set(t,l),l+=t.byteLength})),d);this.sourceUpdater_.appendBuffer({segmentInfo:i,type:n,bytes:h},function(t){t&&(e.error("appenderror for "+n+" append with "+h.length+" bytes"),e.trigger("appenderror"))})},s.handleVideoSegmentTimingInfo_=function(t,e){if(this.pendingSegment_&&t===this.pendingSegment_.requestId){var i=this.pendingSegment_.segment;i.videoTimingInfo||(i.videoTimingInfo={}),i.videoTimingInfo.transmuxerPrependedSeconds=e.prependedContentDuration||0,i.videoTimingInfo.transmuxedPresentationStart=e.start.presentation,i.videoTimingInfo.transmuxedPresentationEnd=e.end.presentation,i.videoTimingInfo.baseMediaDecodeTime=e.baseMediaDecodeTime}},s.appendData_=function(t,e){var i=e.type,n=e.data;if(n&&n.byteLength&&("audio"!==i||!this.audioDisabled_)){var r=this.getInitSegmentAndUpdateState_({type:i,initSegment:e.initSegment,playlist:t.playlist,map:t.isFmp4?t.segment.map:null});this.appendToSourceBuffer_({segmentInfo:t,type:i,initSegment:r,data:n})}},s.loadSegment_=function(t){this.state="WAITING",this.pendingSegment_=t,this.trimBackBuffer_(t),this.shouldUpdateTransmuxerTimestampOffset_(t.timestampOffset)&&(this.gopBuffer_.length=0,t.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:t.timestampOffset}));var e=this.createSimplifiedSegmentObj_(t);t.abortRequests=ii({xhr:this.hls_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,captionParser:this.captionParser_,segment:e,handlePartialData:this.handlePartialData_,progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleVideoSegmentTimingInfo_.bind(this,t.requestId),captionsFn:this.handleCaptions_.bind(this),id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this)})},s.trimBackBuffer_=function(t){var e=function(t,e,i){var n;return n=t.length&&t.start(0)>0&&t.start(0)<e?t.start(0):e-30,Math.min(n,e-i)}(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);e>0&&this.remove(0,e)},s.createSimplifiedSegmentObj_=function(t){var e=t.segment,i={resolvedUri:e.resolvedUri,byterange:e.byterange,requestId:t.requestId,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith},n=t.playlist.segments[t.mediaIndex];if(n&&n.end&&n.timeline===e.timeline&&(i.baseStartTime=n.end+t.timestampOffset),e.key){var r=e.key.iv||new Uint32Array([0,0,0,t.mediaIndex+t.playlist.mediaSequence]);i.key=this.segmentKey(e.key),i.key.iv=r}return e.map&&(i.map=this.initSegmentForMap(e.map)),i},s.saveTransferStats_=function(t){this.mediaRequests+=1,t&&(this.mediaBytesTransferred+=t.bytesReceived,this.mediaTransferDuration+=t.roundTripTime)},s.saveBandwidthRelatedStats_=function(t){this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime,this.pendingSegment_.byteLength=t.bytesReceived},s.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")},s.segmentRequestFinished_=function(t,e,i){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,t,e,i));else if(this.saveTransferStats_(e.stats),this.pendingSegment_){if(e.requestId===this.pendingSegment_.requestId){if(t)return this.pendingSegment_=null,this.state="READY",-102===t.code?void(this.mediaRequestsAborted+=1):(this.pause(),-101===t.code?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(t),void this.trigger("error")));this.saveBandwidthRelatedStats_(e.stats);var n=this.pendingSegment_;n.endOfAllRequests=e.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=function(t,e,i){if(!e.length)return t;if(i)return e.slice();for(var n=e[0].pts,r=0;r<t.length&&!(t[r].pts>=n);r++);return t.slice(0,r).concat(e)}(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING";var r=this.isEndOfStream_(n.mediaIndex,n.playlist),a=null!==this.mediaIndex,s=n.timeline!==this.currentTimeline_&&n.timeline>0;!n.isFmp4&&(r||a&&s)&&(o=this.transmuxer_,Ee("endTimeline",o)),this.trigger("appending"),this.waitForAppendsToComplete_(n)}}else this.mediaRequestsAborted+=1;var o},s.setTimeMapping_=function(t){var e=this.syncController_.mappingForTimeline(t);null!==e&&(this.timeMapping_=e)},s.updateMediaSecondsLoaded_=function(t){"number"==typeof t.start&&"number"==typeof t.end?this.mediaSecondsLoaded+=t.end-t.start:this.mediaSecondsLoaded+=t.duration},s.shouldUpdateTransmuxerTimestampOffset_=function(t){return null!==t&&("main"===this.loaderType_&&t!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&t!==this.sourceUpdater_.audioTimestampOffset())},s.trueSegmentStart_=function(t){var e=t.currentStart,i=t.playlist,n=t.mediaIndex,r=t.firstVideoFrameTimeForData,a=t.currentVideoTimestampOffset,s=t.useVideoTimingInfo,o=t.videoTimingInfo,u=t.audioTimingInfo;if(void 0!==e)return e;if(!s)return u.start;var d=i.segments[n-1];return 0!==n&&d&&void 0!==d.start&&d.end===r+a?o.start:r},s.waitForAppendsToComplete_=function(t){var e="main"===this.loaderType_&&this.startingMedia_.hasVideo,i=!this.audioDisabled_&&this.startingMedia_.hasAudio;t.waitingOnAppends=0,e&&t.waitingOnAppends++,i&&t.waitingOnAppends++,e&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,t)),i&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,t))},s.checkAppendsDone_=function(t){this.checkForAbort_(t.requestId)||(t.waitingOnAppends--,0===t.waitingOnAppends&&this.handleAppendsDone_())},s.checkForIllegalMediaSwitch=function(t){var e=function(t,e,i){return"main"===t&&e&&i?i.hasAudio||i.hasVideo?e.hasVideo&&!i.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&i.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null}(this.loaderType_,this.startingMedia_,t);return!!e&&(this.error({message:e,blacklistDuration:1/0}),this.trigger("error"),!0)},s.updateSourceBufferTimestampOffset_=function(t){if(null!==t.timestampOffset&&"number"==typeof t.timingInfo.start&&!t.changedTimestampOffset&&"main"===this.loaderType_){var e=!1;t.timestampOffset-=t.timingInfo.start,t.changedTimestampOffset=!0,t.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(t.timestampOffset),e=!0),t.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(t.timestampOffset),e=!0),e&&this.trigger("timestampoffset")}},s.updateTimingInfoEnd_=function(t){t.timingInfo=t.timingInfo||{};var e="main"===this.loaderType_&&this.startingMedia_.hasVideo&&t.videoTimingInfo?t.videoTimingInfo:t.audioTimingInfo;e&&(t.timingInfo.end="number"==typeof e.end?e.end:e.start+t.duration)},s.handleAppendsDone_=function(){if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var t=this.pendingSegment_;if(this.updateTimingInfoEnd_(t),this.syncController_.saveSegmentTimingInfo(t),this.logger_(function(t){var e=t.segment,i=e.start,n=e.end,r=t.playlist,a=r.mediaSequence,s=r.id,o=r.segments,u=void 0===o?[]:o,d=t.mediaIndex,l=t.timeline;return["appending ["+d+"] of ["+a+", "+(a+u.length)+"] from playlist ["+s+"]","["+i+" => "+n+"] in timeline ["+l+"]"].join(" ")}(t)),this.recordThroughput_(t),this.pendingSegment_=null,this.state="READY",t.isSyncRequest)this.trigger("syncinfoupdate");else{this.addSegmentMetadataCue_(t),this.fetchAtBuffer_=!0,this.currentTimeline_=t.timeline,this.trigger("syncinfoupdate");var e=t.segment;e.end&&this.currentTime_()-e.end>3*t.playlist.targetDuration?this.resetEverything():(null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=t.mediaIndex,this.isEndOfStream_(t.mediaIndex,t.playlist)&&this.endOfStream(),this.trigger("appended"),this.paused()||this.monitorBuffer_())}},s.recordThroughput_=function(t){var e=this.throughput.rate,i=Date.now()-t.endOfAllRequests+1,n=Math.floor(t.byteLength/i*8*1e3);this.throughput.rate+=(n-e)/++this.throughput.count},s.addSegmentMetadataCue_=function(t){if(this.segmentMetadataTrack_){var e=t.segment,n=e.start,r=e.end;if(Pi(n)&&Pi(r)){Oi(n,r,this.segmentMetadataTrack_);var a=i.WebKitDataCue||i.VTTCue,s={custom:e.custom,dateTimeObject:e.dateTimeObject,dateTimeString:e.dateTimeString,bandwidth:t.playlist.attributes.BANDWIDTH,resolution:t.playlist.attributes.RESOLUTION,codecs:t.playlist.attributes.CODECS,byteLength:t.byteLength,uri:t.uri,timeline:t.timeline,playlist:t.playlist.uri,start:n,end:r},o=new a(n,r,JSON.stringify(s));o.value=s,this.segmentMetadataTrack_.addCue(o)}}},e}(n.EventTarget);function Ri(){}var xi,Mi=function(t,e){var i=e[t+"Buffer"];return i&&i.updating||e.queuePending[t]},Fi=function t(e,i){if(0!==i.queue.length){var n=0,r=i.queue[n];if("mediaSource"!==r.type){if("mediaSource"!==e&&i.started_&&!Mi(e,i)){if(r.type!==e){if(null===(n=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if("mediaSource"===n.type)return null;if(n.type===t)return i}return null}(e,i.queue)))return;r=i.queue[n]}i.queue.splice(n,1),r.action(e,i),r.doneFn?i.queuePending[e]=r:t(e,i)}}else i.updating()||(i.queue.shift(),r.action(i),r.doneFn&&r.doneFn(),t("audio",i),t("video",i))}},Bi=function(t,e){return function(i,n){var r=n[i+"Buffer"];n.logger_("Appending segment "+e.mediaIndex+"'s "+t.length+" bytes to "+i+"Buffer"),r.appendBuffer(t)}},Ni=function(t,e){return function(i,n){var r=n[i+"Buffer"];r.removing=!0,n.logger_("Removing "+t+" to "+e+" from "+i+"Buffer"),r.remove(t,e)}},qi=function(t){return function(e,i){var n=i[e+"Buffer"];i.logger_("Setting "+e+"timestampOffset to "+t),n.timestampOffset=t}},Vi=function(t){return function(e,i){t()}},Gi=function(t){return function(e){if("open"===e.mediaSource.readyState){e.logger_("Calling mediaSource endOfStream("+(t||"")+")");try{e.mediaSource.endOfStream(t)}catch(t){n.log.warn("Failed to call media source endOfStream",t)}}}},Hi=function(t){var e=t.type,i=t.sourceUpdater,n=t.action,r=t.doneFn,a=t.name;i.queue.push({type:e,action:n,doneFn:r,name:a}),Fi(e,i)},Wi=function(t,e){return function(i){if(e.queuePending[t]){e[t+"Buffer"].removing=!1;var n=e.queuePending[t].doneFn;e.queuePending[t]=null,n&&n(e[t+"Error_"])}Fi(t,e)}},ji=function(t){function e(e){var i;return(i=t.call(this)||this).mediaSource=e,i.logger_=ki("SourceUpdater"),i.audioTimestampOffset_=0,i.videoTimestampOffset_=0,i.queue=[],i.queuePending={audio:null,video:null},i.delayedAudioAppendQueue_=[],i.videoAppendQueued_=!1,i}r(e,t);var i=e.prototype;return i.ready=function(){return!(!this.audioBuffer&&!this.videoBuffer)},i.createSourceBuffers=function(t){if(!this.ready()){if("closed"===this.mediaSource.readyState)return this.sourceopenListener_=this.createSourceBuffers.bind(this,t),void this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_);t.audio&&(this.audioBuffer=this.mediaSource.addSourceBuffer('audio/mp4;codecs="'+t.audio+'"'),this.audioBuffer.removing=!1,this.logger_('created SourceBuffer audio/mp4;codecs="'+t.audio+'"')),t.video&&(this.videoBuffer=this.mediaSource.addSourceBuffer('video/mp4;codecs="'+t.video+'"'),this.videoBuffer.removing=!1,this.logger_('created SourceBuffer video/mp4;codecs="'+t.video+'"')),this.trigger("ready"),this.start_()}},i.start_=function(){var t=this;this.started_=!0,this.audioBuffer&&(this.onAudioUpdateEnd_=Wi("audio",this),this.audioBuffer.addEventListener("updateend",this.onAudioUpdateEnd_),this.onAudioError_=function(e){t.audioError_=e},this.audioBuffer.addEventListener("error",this.onAudioError_),Fi("audio",this)),this.videoBuffer&&(this.onVideoUpdateEnd_=Wi("video",this),this.videoBuffer.addEventListener("updateend",this.onVideoUpdateEnd_),this.onVideoError_=function(e){t.videoError_=e},this.videoBuffer.addEventListener("error",this.onVideoError_),Fi("video",this))},i.appendBuffer=function(t,e){var i=this,n=t.segmentInfo,r=t.type,a=t.bytes;if(this.processedAppend_=!0,"audio"===r&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([t,e]),void this.logger_("delayed audio append of "+a.length+" until video append");if(Hi({type:r,sourceUpdater:this,action:Bi(a,n||{mediaIndex:-1}),doneFn:e,name:"appendBuffer"}),"video"===r){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;var s=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio "+s.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,s.forEach(function(t){i.appendBuffer.apply(i,t)})}},i.audioBuffered=function(){return this.audioBuffer&&this.audioBuffer.buffered?this.audioBuffer.buffered:n.createTimeRange()},i.videoBuffered=function(){return this.videoBuffer&&this.videoBuffer.buffered?this.videoBuffer.buffered:n.createTimeRange()},i.buffered=function(){return function(t,e,i){var r=null,a=null,s=0,o=[],u=[];if(!t&&!e)return n.createTimeRange();if(!t)return e.buffered;if(!e)return t.buffered;if(0===t.buffered.length&&0===e.buffered.length)return n.createTimeRange();for(var d=t.buffered,l=e.buffered,h=d.length;h--;)o.push({time:d.start(h),type:"start"}),o.push({time:d.end(h),type:"end"});for(h=l.length;h--;)o.push({time:l.start(h),type:"start"}),o.push({time:l.end(h),type:"end"});for(o.sort(function(t,e){return t.time-e.time}),h=0;h<o.length;h++)"start"===o[h].type?2==++s&&(r=o[h].time):"end"===o[h].type&&1==--s&&(a=o[h].time),null!==r&&null!==a&&(u.push([r,a]),r=null,a=null);return n.createTimeRanges(u)}(this.videoBuffer,this.audioBuffer)},i.setDuration=function(t,e){var i;void 0===e&&(e=Ri),Hi({type:"mediaSource",sourceUpdater:this,action:(i=t,function(t){t.logger_("Setting mediaSource duration to "+i);try{t.mediaSource.duration=i}catch(t){n.log.warn("Failed to set media source duration",t)}}),name:"duration",doneFn:e})},i.endOfStream=function(t,e){void 0===t&&(t=null),void 0===e&&(e=Ri),"string"!=typeof t&&(t=void 0),Hi({type:"mediaSource",sourceUpdater:this,action:Gi(t),name:"endOfStream",doneFn:e})},i.removeAudio=function(t,e,i){void 0===i&&(i=Ri),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?Hi({type:"audio",sourceUpdater:this,action:Ni(t,e),doneFn:i,name:"remove"}):i()},i.removeVideo=function(t,e,i){void 0===i&&(i=Ri),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?Hi({type:"video",sourceUpdater:this,action:Ni(t,e),doneFn:i,name:"remove"}):i()},i.updating=function(){return!(!Mi("audio",this)&&!Mi("video",this))},i.audioTimestampOffset=function(t){return void 0!==t&&this.audioBuffer&&this.audioTimestampOffset_!==t&&(Hi({type:"audio",sourceUpdater:this,action:qi(t),name:"timestampOffset"}),this.audioTimestampOffset_=t),this.audioTimestampOffset_},i.videoTimestampOffset=function(t){return void 0!==t&&this.videoBuffer&&this.videoTimestampOffset!==t&&(Hi({type:"video",sourceUpdater:this,action:qi(t),name:"timestampOffset"}),this.videoTimestampOffset_=t),this.videoTimestampOffset_},i.audioQueueCallback=function(t){this.audioBuffer&&Hi({type:"audio",sourceUpdater:this,action:Vi(t),name:"callback"})},i.videoQueueCallback=function(t){this.videoBuffer&&Hi({type:"video",sourceUpdater:this,action:Vi(t),name:"callback"})},i.dispose=function(){var t=this,e=function e(){if("open"===t.mediaSource.readyState)try{t.audioBuffer.abort()}catch(t){n.log.warn("Failed to call abort on audio buffer",t)}t.audioBuffer.removeEventListener("updateend",t.onAudioUpdateEnd_),t.audioBuffer.removeEventListener("updateend",e),t.audioBuffer.removeEventListener("error",t.onAudioError_),t.audioBuffer=null},i=function e(){if("open"===t.mediaSource.readyState)try{t.videoBuffer.abort()}catch(t){n.log.warn("Failed to call abort on video buffer",t)}t.videoBuffer.removeEventListener("updateend",t.onVideoUpdateEnd_),t.videoBuffer.removeEventListener("error",t.onVideoError_),t.videoBuffer.removeEventListener("updateend",e),t.videoBuffer=null};this.audioBuffer&&(this.audioBuffer.removing?this.audioBuffer.addEventListener("updateend",e):e()),this.videoBuffer&&(this.videoBuffer.removing?this.videoBuffer.addEventListener("updateend",i):i()),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_)},e}(n.EventTarget),zi=function(t){return decodeURIComponent(escape(String.fromCharCode.apply(null,t)))},Xi=new Uint8Array("\n\n".split("").map(function(t){return t.charCodeAt(0)})),Yi=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,e,i)||this).handlePartialData_=!1,n.mediaSource_=null,n.subtitlesTrack_=null,n.loaderType_="subtitle",n}r(e,t);var a=e.prototype;return a.createTransmuxer_=function(){return null},a.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return n.createTimeRanges();var t=this.subtitlesTrack_.cues,e=t[0].startTime,i=t[t.length-1].startTime;return n.createTimeRanges([[e,i]])},a.initSegmentForMap=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=pt(t),n=this.initSegments_[i];if(e&&!n&&t.bytes){var r=Xi.byteLength+t.bytes.byteLength,a=new Uint8Array(r);a.set(t.bytes),a.set(Xi,t.bytes.byteLength),this.initSegments_[i]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:a}}return n||t},a.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},a.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},a.track=function(t){return void 0===t?this.subtitlesTrack_:(this.subtitlesTrack_=t,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)},a.remove=function(t,e){Oi(t,e,this.subtitlesTrack_)},a.fillBuffer_=function(){var t=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(e=this.skipEmptySegments_(e)){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline))return this.syncController_.one("timestampoffset",function(){t.state="READY",t.paused()||t.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE");this.loadSegment_(e)}},a.skipEmptySegments_=function(t){for(;t&&t.segment.empty;)t=this.generateSegmentInfo_(t.playlist,t.mediaIndex+1,t.startOfSegment+t.duration,t.isSyncRequest);return t},a.stopForError=function(t){this.error(t),this.state="READY",this.pause(),this.trigger("error")},a.segmentRequestFinished_=function(t,e,n){var r=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(e.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(t)return-101===t.code&&this.handleTimeout_(),-102===t.code?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(t);this.saveBandwidthRelatedStats_(e.stats),this.state="APPENDING",this.trigger("appending");var a=this.pendingSegment_,s=a.segment;if(s.map&&(s.map.bytes=e.map.bytes),a.bytes=e.bytes,"function"!=typeof i.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var o,u=function(){r.subtitlesTrack_.tech_.off("vttjsloaded",o),r.stopForError({message:"Error loading vtt.js"})};return o=function(){r.subtitlesTrack_.tech_.off("vttjserror",u),r.segmentRequestFinished_(t,e,n)},this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",o),void this.subtitlesTrack_.tech_.one("vttjserror",u)}s.requested=!0;try{this.parseVTTCues_(a)}catch(t){return void this.stopForError({message:t.message})}if(this.updateTimeMapping_(a,this.syncController_.timelines[a.timeline],this.playlist_),a.cues.length?a.timingInfo={start:a.cues[0].startTime,end:a.cues[a.cues.length-1].endTime}:a.timingInfo={start:a.startOfSegment,end:a.startOfSegment+a.duration},a.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");a.byteLength=a.bytes.byteLength,this.mediaSecondsLoaded+=s.duration,a.cues.forEach(function(t){r.remove(t.startTime,t.endTime),r.subtitlesTrack_.addCue(t)}),this.handleAppendsDone_()}else this.state="READY"},a.updateTimingInfoEnd_=function(){},a.parseVTTCues_=function(t){var e,r=!1;"function"==typeof i.TextDecoder?e=new i.TextDecoder("utf8"):(e=i.WebVTT.StringDecoder(),r=!0);var a=new i.WebVTT.Parser(i,i.vttjs,e);if(t.cues=[],t.timestampmap={MPEGTS:0,LOCAL:0},a.oncue=t.cues.push.bind(t.cues),a.ontimestampmap=function(e){t.timestampmap=e},a.onparsingerror=function(t){n.log.warn("Error encountered when parsing cues: "+t.message)},t.segment.map){var s=t.segment.map.bytes;r&&(s=zi(s)),a.parse(s)}var o=t.bytes;r&&(o=zi(o)),a.parse(o),a.flush()},a.updateTimeMapping_=function(t,e,i){var n=t.segment;if(e)if(t.cues.length){var r=t.timestampmap,a=r.MPEGTS/Ge-r.LOCAL+e.mapping;if(t.cues.forEach(function(t){t.startTime+=a,t.endTime+=a}),!i.syncInfo){var s=t.cues[0].startTime,o=t.cues[t.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+t.mediaIndex,time:Math.min(s,o-n.duration)}}}else n.empty=!0},e}(Ci),Qi=function(t,e){for(var i=t.cues,n=0;n<i.length;n++){var r=i[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},Ki=[{name:"VOD",run:function(t,e,i,n,r){return i!==1/0?{time:0,segmentIndex:0}:null}},{name:"ProgramDateTime",run:function(t,e,i,n,r){if(!t.datetimeToDisplayTime)return null;var a=e.segments||[],s=null,o=null,u=t.datetimeToDisplayTime;a.length&&a[0].dateTimeObject&&(u-=a[0].dateTimeObject.getTime()/1e3+u),r=r||0;for(var d=0;d<a.length;d++){var l=a[d];if(l.dateTimeObject){var h=l.dateTimeObject.getTime()/1e3,c=h+t.datetimeToDisplayTime-(h+u),f=Math.abs(r-c);if(null!==o&&(0===f||o<f))break;o=f,s={time:c,segmentIndex:d}}u-=l.duration}return s}},{name:"Segment",run:function(t,e,i,n,r){var a=e.segments||[],s=null,o=null;r=r||0;for(var u=0;u<a.length;u++){var d=a[u];if(d.timeline===n&&void 0!==d.start){var l=Math.abs(r-d.start);if(null!==o&&o<l)break;(!s||null===o||o>=l)&&(o=l,s={time:d.start,segmentIndex:u})}}return s}},{name:"Discontinuity",run:function(t,e,i,n,r){var a=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length)for(var s=null,o=0;o<e.discontinuityStarts.length;o++){var u=e.discontinuityStarts[o],d=e.discontinuitySequence+o+1,l=t.discontinuities[d];if(l){var h=Math.abs(r-l.time);if(null!==s&&s<h)break;(!a||null===s||s>=h)&&(s=h,a={time:l.time,segmentIndex:u})}}return a}},{name:"Playlist",run:function(t,e,i,n,r){return e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence}:null}}],$i=function(t){function e(e){var i;return(i=t.call(this)||this).timelines=[],i.discontinuities=[],i.datetimeToDisplayTime=null,i.logger_=ki("SyncController"),i}r(e,t);var i=e.prototype;return i.getSyncPoint=function(t,e,i,n){var r=this.runStrategies_(t,e,i,n);return r.length?this.selectSyncPoint_(r,{key:"time",value:n}):null},i.getExpiredTime=function(t,e){if(!t||!t.segments)return null;var i=this.runStrategies_(t,e,t.discontinuitySequence,0);if(!i.length)return null;var n=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return n.segmentIndex>0&&(n.time*=-1),Math.abs(n.time+M(t,n.segmentIndex,0))},i.runStrategies_=function(t,e,i,n){for(var r=[],a=0;a<Ki.length;a++){var s=Ki[a],o=s.run(this,t,e,i,n);o&&(o.strategy=s.name,r.push({strategy:s.name,syncPoint:o}))}return r},i.selectSyncPoint_=function(t,e){for(var i=t[0].syncPoint,n=Math.abs(t[0].syncPoint[e.key]-e.value),r=t[0].strategy,a=1;a<t.length;a++){var s=Math.abs(t[a].syncPoint[e.key]-e.value);s<n&&(n=s,i=t[a].syncPoint,r=t[a].strategy)}return this.logger_("syncPoint for ["+e.key+": "+e.value+"] chosen with strategy ["+r+"]: [time:"+i.time+", segmentIndex:"+i.segmentIndex+"]"),i},i.saveExpiredSegmentInfo=function(t,e){for(var i=e.mediaSequence-t.mediaSequence-1;i>=0;i--){var n=t.segments[i];if(n&&void 0!==n.start){e.syncInfo={mediaSequence:t.mediaSequence+i,time:n.start},this.logger_("playlist refresh sync: [time:"+e.syncInfo.time+", mediaSequence: "+e.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},i.setDateTimeMapping=function(t){if(!this.datetimeToDisplayTime&&t.segments&&t.segments.length&&t.segments[0].dateTimeObject){var e=t.segments[0].dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-e}},i.saveSegmentTimingInfo=function(t){this.calculateSegmentTimeMapping_(t,t.timingInfo)&&(this.saveDiscontinuitySyncInfo_(t),t.playlist.syncInfo||(t.playlist.syncInfo={mediaSequence:t.playlist.mediaSequence+t.mediaIndex,time:t.segment.start}))},i.timestampOffsetForTimeline=function(t){return void 0===this.timelines[t]?null:this.timelines[t].time},i.mappingForTimeline=function(t){return void 0===this.timelines[t]?null:this.timelines[t].mapping},i.calculateSegmentTimeMapping_=function(t,e){var i=t.segment,n=this.timelines[t.timeline];if(null!==t.timestampOffset)n={time:t.startOfSegment,mapping:t.startOfSegment-e.start},this.timelines[t.timeline]=n,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+t.timeline+": [time: "+n.time+"] [mapping: "+n.mapping+"]"),i.start=t.startOfSegment,i.end=e.end+n.mapping;else{if(!n)return!1;i.start=e.start+n.mapping,i.end=e.end+n.mapping}return!0},i.saveDiscontinuitySyncInfo_=function(t){var e=t.playlist,i=t.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(e.discontinuityStarts&&e.discontinuityStarts.length)for(var n=0;n<e.discontinuityStarts.length;n++){var r=e.discontinuityStarts[n],a=e.discontinuitySequence+n+1,s=r-t.mediaIndex,o=Math.abs(s);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>o){var u;u=s<0?i.start-M(e,t.mediaIndex,r):i.end+M(e,t.mediaIndex+1,r),this.discontinuities[a]={time:u,accuracy:o}}}},e}(n.EventTarget),Ji=new di("./decrypter-worker.worker.js",function(t,e){var i,n,r,a,s,o,u,d,l,h,c=this;
/*! @name @videojs/http-streaming @version 1.11.0-alpha.1 @license Apache-2.0 */i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(){var t=[[[],[],[],[],[]],[[],[],[],[],[]]],e=t[0],i=t[1],n=e[4],r=i[4],a=void 0,s=void 0,o=void 0,u=[],d=[],l=void 0,h=void 0,c=void 0,f=void 0,p=void 0;for(a=0;a<256;a++)d[(u[a]=a<<1^283*(a>>7))^a]=a;for(s=o=0;!n[s];s^=l||1,o=d[o]||1)for(c=(c=o^o<<1^o<<2^o<<3^o<<4)>>8^255&c^99,n[s]=c,r[c]=s,p=16843009*u[h=u[l=u[s]]]^65537*h^257*l^16843008*s,f=257*u[c]^16843008*c,a=0;a<4;a++)e[a][s]=f=f<<24^f>>>8,i[a][c]=p=p<<24^p>>>8;for(a=0;a<5;a++)e[a]=e[a].slice(0),i[a]=i[a].slice(0);return t},s=null,o=function(){function t(e){i(this,t),s||(s=a()),this._tables=[[s[0][0].slice(),s[0][1].slice(),s[0][2].slice(),s[0][3].slice(),s[0][4].slice()],[s[1][0].slice(),s[1][1].slice(),s[1][2].slice(),s[1][3].slice(),s[1][4].slice()]];var n=void 0,r=void 0,o=void 0,u=void 0,d=void 0,l=this._tables[0][4],h=this._tables[1],c=e.length,f=1;if(4!==c&&6!==c&&8!==c)throw new Error("Invalid aes key size");for(u=e.slice(0),d=[],this._key=[u,d],n=c;n<4*c+28;n++)o=u[n-1],(n%c==0||8===c&&n%c==4)&&(o=l[o>>>24]<<24^l[o>>16&255]<<16^l[o>>8&255]<<8^l[255&o],n%c==0&&(o=o<<8^o>>>24^f<<24,f=f<<1^283*(f>>7))),u[n]=u[n-c]^o;for(r=0;n;r++,n--)o=u[3&r?n:n-4],d[r]=n<=4||r<4?o:h[0][l[o>>>24]]^h[1][l[o>>16&255]]^h[2][l[o>>8&255]]^h[3][l[255&o]]}return t.prototype.decrypt=function(t,e,i,n,r,a){var s=this._key[1],o=t^s[0],u=n^s[1],d=i^s[2],l=e^s[3],h=void 0,c=void 0,f=void 0,p=s.length/4-2,m=void 0,g=4,y=this._tables[1],_=y[0],v=y[1],b=y[2],T=y[3],S=y[4];for(m=0;m<p;m++)h=_[o>>>24]^v[u>>16&255]^b[d>>8&255]^T[255&l]^s[g],c=_[u>>>24]^v[d>>16&255]^b[l>>8&255]^T[255&o]^s[g+1],f=_[d>>>24]^v[l>>16&255]^b[o>>8&255]^T[255&u]^s[g+2],l=_[l>>>24]^v[o>>16&255]^b[u>>8&255]^T[255&d]^s[g+3],g+=4,o=h,u=c,d=f;for(m=0;m<4;m++)r[(3&-m)+a]=S[o>>>24]<<24^S[u>>16&255]<<16^S[d>>8&255]<<8^S[255&l]^s[g++],h=o,o=u,u=d,d=l,l=h},t}(),u=function(){function t(){i(this,t),this.listeners={}}return t.prototype.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t].splice(i,1),i>-1},t.prototype.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var i=e.length,n=0;n<i;++n)e[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),a=e.length,s=0;s<a;++s)e[s].apply(this,r)},t.prototype.dispose=function(){this.listeners={}},t.prototype.pipe=function(t){this.on("data",function(e){t.push(e)})},t}(),d=function(t){function e(){i(this,e);var n=r(this,t.call(this,u));return n.jobs=[],n.delay=1,n.timeout_=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},e.prototype.push=function(t){this.jobs.push(t),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},e}(u),l=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},h=function(){function t(e,n,r,a){i(this,t);var s=t.STEP,o=new Int32Array(e.buffer),u=new Uint8Array(e.byteLength),h=0;for(this.asyncStream_=new d,this.asyncStream_.push(this.decryptChunk_(o.subarray(h,h+s),n,r,u)),h=s;h<o.length;h+=s)r=new Uint32Array([l(o[h-4]),l(o[h-3]),l(o[h-2]),l(o[h-1])]),this.asyncStream_.push(this.decryptChunk_(o.subarray(h,h+s),n,r,u));this.asyncStream_.push(function(){var t;a(null,(t=u).subarray(0,t.byteLength-t[t.byteLength-1]))})}return t.prototype.decryptChunk_=function(t,e,i,n){return function(){var r=function(t,e,i){var n=new Int32Array(t.buffer,t.byteOffset,t.byteLength>>2),r=new o(Array.prototype.slice.call(e)),a=new Uint8Array(t.byteLength),s=new Int32Array(a.buffer),u=void 0,d=void 0,h=void 0,c=void 0,f=void 0,p=void 0,m=void 0,g=void 0,y=void 0;for(u=i[0],d=i[1],h=i[2],c=i[3],y=0;y<n.length;y+=4)f=l(n[y]),p=l(n[y+1]),m=l(n[y+2]),g=l(n[y+3]),r.decrypt(f,p,m,g,s,y),s[y]=l(s[y]^u),s[y+1]=l(s[y+1]^d),s[y+2]=l(s[y+2]^h),s[y+3]=l(s[y+3]^c),u=f,d=p,h=m,c=g;return a}(t,e,i);n.set(r,t.byteOffset)}},n(t,null,[{key:"STEP",get:function(){return 32e3}}]),t}(),new function(t){t.onmessage=function(e){var i=e.data,n=new Uint8Array(i.encrypted.bytes,i.encrypted.byteOffset,i.encrypted.byteLength),r=new Uint32Array(i.key.bytes,i.key.byteOffset,i.key.byteLength/4),a=new Uint32Array(i.iv.bytes,i.iv.byteOffset,i.iv.byteLength/4);new h(n,r,a,function(e,n){var r,a;t.postMessage((r={source:i.source,decrypted:n},a={},Object.keys(r).forEach(function(t){var e=r[t];ArrayBuffer.isView(e)?a[t]={bytes:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}:a[t]=e}),a),[n.buffer])})}}(c)}),Zi=function(t){var e=t.default?"main":"alternative";return t.characteristics&&t.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},tn=function(t,e){t.abort(),t.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},en=function(t,e){e.activePlaylistLoader=t,t.load()},nn={AUDIO:function(t,e){return function(){var i=e.segmentLoaders[t],r=e.mediaTypes[t],a=e.blacklistCurrentPlaylist;tn(i,r);var s=r.activeTrack(),o=r.activeGroup(),u=(o.filter(function(t){return t.default})[0]||o[0]).id,d=r.tracks[u];if(s!==d){for(var l in n.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),r.tracks)r.tracks[l].enabled=r.tracks[l]===d;r.onTrackChanged()}else a({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(t,e){return function(){var i=e.segmentLoaders[t],r=e.mediaTypes[t];n.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),tn(i,r);var a=r.activeTrack();a&&(a.mode="disabled"),r.onTrackChanged()}}},rn={AUDIO:function(t,e,i){if(e){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[t];e.on("loadedmetadata",function(){var t=e.media();a.playlist(t,r),(!n.paused()||t.endList&&"none"!==n.preload())&&a.load()}),e.on("loadedplaylist",function(){a.playlist(e.media(),r),n.paused()||a.load()}),e.on("error",nn[t](t,i))}},SUBTITLES:function(t,e,i){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[t],s=i.mediaTypes[t];e.on("loadedmetadata",function(){var t=e.media();a.playlist(t,r),a.track(s.activeTrack()),(!n.paused()||t.endList&&"none"!==n.preload())&&a.load()}),e.on("loadedplaylist",function(){a.playlist(e.media(),r),n.paused()||a.load()}),e.on("error",nn[t](t,i))}},an={AUDIO:function(t,e){var i=e.hls,r=e.sourceType,a=e.segmentLoaders[t],s=e.requestOptions,o=e.master.mediaGroups,u=e.mediaTypes[t],d=u.groups,l=u.tracks,h=e.masterPlaylistLoader;for(var c in o[t]&&0!==Object.keys(o[t]).length||(o[t]={main:{default:{default:!0}}}),o[t])for(var f in d[c]||(d[c]=[]),o[t][c]){var p,m=o[t][c][f];if(p=m.resolvedUri?new D(m.resolvedUri,i,s):m.playlists&&"dash"===r?new Te(m.playlists[0],i,s,h):null,m=n.mergeOptions({id:f,playlistLoader:p},m),rn[t](t,m.playlistLoader,e),d[c].push(m),void 0===l[f]){var g=new n.AudioTrack({id:f,kind:Zi(m),enabled:!1,language:m.language,default:m.default,label:f});l[f]=g}}a.on("error",nn[t](t,e))},SUBTITLES:function(t,e){var i=e.tech,r=e.hls,a=e.sourceType,s=e.segmentLoaders[t],o=e.requestOptions,u=e.master.mediaGroups,d=e.mediaTypes[t],l=d.groups,h=d.tracks,c=e.masterPlaylistLoader;for(var f in u[t])for(var p in l[f]||(l[f]=[]),u[t][f])if(!u[t][f][p].forced){var m=u[t][f][p],g=void 0;if("hls"===a?g=new D(m.resolvedUri,r,o):"dash"===a&&(g=new Te(m.playlists[0],r,o,c)),m=n.mergeOptions({id:p,playlistLoader:g},m),rn[t](t,m.playlistLoader,e),l[f].push(m),void 0===h[p]){var y=i.addRemoteTextTrack({id:p,kind:"subtitles",default:m.default&&m.autoselect,language:m.language,label:p},!1).track;h[p]=y}}s.on("error",nn[t](t,e))},"CLOSED-CAPTIONS":function(t,e){var i=e.tech,r=e.master.mediaGroups,a=e.mediaTypes[t],s=a.groups,o=a.tracks;for(var u in r[t])for(var d in s[u]||(s[u]=[]),r[t][u]){var l=r[t][u][d];if(l.instreamId.match(/CC\d/)&&(s[u].push(n.mergeOptions({id:d},l)),void 0===o[d])){var h=i.addRemoteTextTrack({id:l.instreamId,kind:"captions",default:l.default&&l.autoselect,language:l.language,label:d},!1).track;o[d]=h}}}},sn={AUDIO:function(t,e){return function(){var i=e.mediaTypes[t].tracks;for(var n in i)if(i[n].enabled)return i[n];return null}},SUBTITLES:function(t,e){return function(){var i=e.mediaTypes[t].tracks;for(var n in i)if("showing"===i[n].mode)return i[n];return null}}},on=function(){var t={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(e){t[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Ri,activeTrack:Ri,onGroupChanged:Ri,onTrackChanged:Ri}}),t},un=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],dn=function(t){return this.audioSegmentLoader_[t]+this.mainSegmentLoader_[t]},ln=function(t){function e(e){var r;r=t.call(this)||this;var s=e.url,o=e.handleManifestRedirects,u=e.withCredentials,d=e.tech,l=e.bandwidth,h=e.externHls,c=e.useCueTags,f=e.blacklistDuration,p=e.enableLowInitialPlaylist,m=e.sourceType,g=e.seekTo,y=e.cacheEncryptionKeys,_=e.handlePartialData;if(!s)throw new Error("A non-empty playlist URL is required");xi=h,r.withCredentials=u,r.tech_=d,r.hls_=d.hls,r.seekTo_=g,r.sourceType_=m,r.useCueTags_=c,r.blacklistDuration=f,r.enableLowInitialPlaylist=p,r.useCueTags_&&(r.cueTagsTrack_=r.tech_.addTextTrack("metadata","ad-cues"),r.cueTagsTrack_.inBandMetadataTrackDispatchType=""),r.requestOptions_={withCredentials:u,handleManifestRedirects:o,timeout:null},r.mediaTypes_=on(),r.mediaSource=new i.MediaSource,r.mediaSource.addEventListener("durationchange",function(){r.tech_.trigger("durationchange")}),r.mediaSource.addEventListener("sourceopen",r.handleSourceOpen_.bind(a(r))),r.mediaSource.addEventListener("sourceended",r.handleSourceEnded_.bind(a(r))),r.seekable_=n.createTimeRanges(),r.hasPlayed_=function(){return!1},r.syncController_=new $i(e),r.segmentMetadataTrack_=d.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,r.decrypter_=new Ji,r.sourceUpdater_=new ji(r.mediaSource),r.inbandTextTracks_={};var v={hls:r.hls_,mediaSource:r.mediaSource,currentTime:r.tech_.currentTime.bind(r.tech_),seekable:function(){return r.seekable()},seeking:function(){return r.tech_.seeking()},duration:function(){return r.duration()},hasPlayed:function(){return r.hasPlayed_()},goalBufferLength:function(){return r.goalBufferLength()},bandwidth:l,syncController:r.syncController_,decrypter:r.decrypter_,sourceType:r.sourceType_,inbandTextTracks:r.inbandTextTracks_,cacheEncryptionKeys:y,handlePartialData:_,sourceUpdater:r.sourceUpdater_};return r.masterPlaylistLoader_="dash"===r.sourceType_?new Te(s,r.hls_,r.requestOptions_):new D(s,r.hls_,r.requestOptions_),r.setupMasterPlaylistLoaderListeners_(),r.mainSegmentLoader_=new Ci(n.mergeOptions(v,{segmentMetadataTrack:r.segmentMetadataTrack_,loaderType:"main"}),e),r.audioSegmentLoader_=new Ci(n.mergeOptions(v,{loaderType:"audio"}),e),r.subtitleSegmentLoader_=new Yi(n.mergeOptions(v,{loaderType:"vtt"}),e),r.setupSegmentLoaderListeners_(),un.forEach(function(t){r[t+"_"]=dn.bind(a(r),t)}),r.logger_=ki("MPC"),r.triggeredFmp4Usage=!1,r.masterPlaylistLoader_.load(),r}r(e,t);var s=e.prototype;return s.setupMasterPlaylistLoaderListeners_=function(){var t=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var e=t.masterPlaylistLoader_.media(),i=1.5*e.targetDuration*1e3;X(t.masterPlaylistLoader_.master,t.masterPlaylistLoader_.media())?t.requestOptions_.timeout=0:t.requestOptions_.timeout=i,e.endList&&"none"!==t.tech_.preload()&&(t.mainSegmentLoader_.playlist(e,t.requestOptions_),t.mainSegmentLoader_.load()),function(t){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(e){an[e](e,t)});var e=t.mediaTypes,i=t.masterPlaylistLoader,n=t.tech,r=t.hls;["AUDIO","SUBTITLES"].forEach(function(i){e[i].activeGroup=function(t,e){return function(i){var n=e.masterPlaylistLoader,r=e.mediaTypes[t].groups,a=n.media();if(!a)return null;var s=null;return a.attributes[t]&&(s=r[a.attributes[t]]),s=s||r.main,void 0===i?s:null===i?null:s.filter(function(t){return t.id===i.id})[0]||null}}(i,t),e[i].activeTrack=sn[i](i,t),e[i].onGroupChanged=function(t,e){return function(){var i=e.segmentLoaders,n=i[t],r=i.main,a=e.mediaTypes[t],s=a.activeTrack(),o=a.activeGroup(s),u=a.activePlaylistLoader;tn(n,a),o&&(o.playlistLoader?(n.resyncLoader(),en(o.playlistLoader,a)):u&&r.resetEverything())}}(i,t),e[i].onTrackChanged=function(t,e){return function(){var i=e.segmentLoaders,n=i[t],r=i.main,a=e.mediaTypes[t],s=a.activeTrack(),o=a.activeGroup(s),u=a.activePlaylistLoader;if(tn(n,a),o){if("AUDIO"===t){if(!o.playlistLoader)return r.setAudio(!0),void r.resetEverything();n.setAudio(!0),r.setAudio(!1)}u!==o.playlistLoader?(n.track&&n.track(s),n.resetEverything(),en(o.playlistLoader,a)):en(o.playlistLoader,a)}}}(i,t)});var a=e.AUDIO.activeGroup(),s=(a.filter(function(t){return t.default})[0]||a[0]).id;e.AUDIO.tracks[s].enabled=!0,e.AUDIO.onTrackChanged(),i.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(t){return e[t].onGroupChanged()})});var o=function(){e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"hls-audio-change"})};for(var u in n.audioTracks().addEventListener("change",o),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",function(){n.audioTracks().removeEventListener("change",o),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio"),e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[u])}({sourceType:t.sourceType_,segmentLoaders:{AUDIO:t.audioSegmentLoader_,SUBTITLES:t.subtitleSegmentLoader_,main:t.mainSegmentLoader_},tech:t.tech_,requestOptions:t.requestOptions_,masterPlaylistLoader:t.masterPlaylistLoader_,hls:t.hls_,master:t.master(),mediaTypes:t.mediaTypes_,blacklistCurrentPlaylist:t.blacklistCurrentPlaylist.bind(t)}),t.triggerPresenceUsage_(t.master(),e),t.setupFirstPlay(),!t.mediaTypes_.AUDIO.activePlaylistLoader||t.mediaTypes_.AUDIO.activePlaylistLoader.media()?t.trigger("selectedinitialmedia"):t.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){t.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){var e,i=t.masterPlaylistLoader_.media();if(!i)return t.excludeUnsupportedVariants_(),t.enableLowInitialPlaylist&&(e=t.selectInitialPlaylist()),e||(e=t.selectPlaylist()),t.initialMedia_=e,void t.masterPlaylistLoader_.media(t.initialMedia_);t.useCueTags_&&t.updateAdCues_(i),t.mainSegmentLoader_.playlist(i,t.requestOptions_),t.updateDuration(!i.endList),t.tech_.paused()||(t.mainSegmentLoader_.load(),t.audioSegmentLoader_&&t.audioSegmentLoader_.load())}),this.masterPlaylistLoader_.on("error",function(){t.blacklistCurrentPlaylist(t.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){t.mainSegmentLoader_.abort(),t.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var e=t.masterPlaylistLoader_.media(),i=1.5*e.targetDuration*1e3;X(t.masterPlaylistLoader_.master,t.masterPlaylistLoader_.media())?t.requestOptions_.timeout=0:t.requestOptions_.timeout=i,t.mainSegmentLoader_.playlist(e,t.requestOptions_),t.mainSegmentLoader_.load(),t.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var e=t.masterPlaylistLoader_.media();t.stuckAtPlaylistEnd_(e)&&(t.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),t.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){t.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){t.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},s.triggerPresenceUsage_=function(t,e){var i=t.mediaGroups||{},n=!0,r=Object.keys(i.AUDIO);for(var a in i.AUDIO)for(var s in i.AUDIO[a])i.AUDIO[a][s].uri||(n=!1);n&&this.tech_.trigger({type:"usage",name:"hls-demuxed"}),Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"}),xi.Playlist.isAes(e)&&this.tech_.trigger({type:"usage",name:"hls-aes"}),r.length&&Object.keys(i.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})},s.setupSegmentLoaderListeners_=function(){var t=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var e=t.selectPlaylist(),i=t.masterPlaylistLoader_.media(),n=t.tech_.buffered(),r=n.length?n.end(n.length-1)-t.tech_.currentTime():0,a=t.bufferLowWaterLine();(!i.endList||t.duration()<Se.MAX_BUFFER_LOW_WATER_LINE||e.attributes.BANDWIDTH<i.attributes.BANDWIDTH||r>=a)&&t.masterPlaylistLoader_.media(e),t.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){t.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){t.blacklistCurrentPlaylist(t.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){t.error=t.mainSegmentLoader_.error_,t.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){t.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){t.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){t.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){t.error=t.audioSegmentLoader_.error_,t.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){t.logger_("main segment loader ended"),t.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(){t.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120)}),this.mainSegmentLoader_.on("trackinfo",function(){t.tryToCreateSourceBuffers_()}),this.mainSegmentLoader_.on("fmp4",function(){t.triggeredFmp4Usage||(t.tech_.trigger({type:"usage",name:"hls-fmp4"}),t.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){t.triggeredFmp4Usage||(t.tech_.trigger({type:"usage",name:"hls-fmp4"}),t.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){t.logger_("audioSegmentLoader ended"),t.onEndOfStream()}),this.audioSegmentLoader_.on("trackinfo",function(){t.tryToCreateSourceBuffers_()})},s.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},s.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},s.smoothQualityChange_=function(){var t=this.selectPlaylist();t!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(t),this.mainSegmentLoader_.resetLoader())},s.fastQualityChange_=function(){var t=this,e=this.selectPlaylist();e!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(e),this.mainSegmentLoader_.resetEverything(function(){n.browser.IE_VERSION||n.browser.IS_EDGE?t.tech_.setCurrentTime(t.tech_.currentTime()+.04):t.tech_.setCurrentTime(t.tech_.currentTime())}))},s.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.seekTo_(0),this.hasPlayed_()&&this.load();var t=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<t.start(0)?this.seekTo_(t.end(t.length-1)):void 0}},s.setupFirstPlay=function(){var t=this,e=this.masterPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_())return!1;if(!e.endList){var i=this.seekable();if(!i.length)return!1;if(n.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){t.trigger("firstplay"),t.seekTo_(i.end(0)),t.hasPlayed_=function(){return!0}}),!1;this.trigger("firstplay"),this.seekTo_(i.end(0))}return this.hasPlayed_=function(){return!0},this.load(),!0},s.handleSourceOpen_=function(){try{this.tryToCreateSourceBuffers_()}catch(t){return n.log.warn("Failed to create Source Buffers",t),void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("decode"))}if(this.tech_.autoplay()){var t=this.tech_.play();void 0!==t&&"function"==typeof t.then&&t.then(null,function(t){})}this.trigger("sourceopen")},s.handleSourceEnded_=function(){if(this.inbandTextTracks_.metadataTrack_){var t=this.inbandTextTracks_.metadataTrack_.cues;if(t&&t.length){var e=this.duration();t[t.length-1].endTime=isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e}}},s.onEndOfStream=function(){var t=this.mainSegmentLoader_.ended_;this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=!this.mainSegmentLoader_.startingMedia_||this.mainSegmentLoader_.startingMedia_.hasVideo?t&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_),t&&this.sourceUpdater_.endOfStream()},s.stuckAtPlaylistEnd_=function(t){if(!this.seekable().length)return!1;var e=this.syncController_.getExpiredTime(t,this.duration());if(null===e)return!1;var i=xi.Playlist.playlistEnd(t,e),n=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return i-n<=.1;var a=r.end(r.length-1);return a-n<=.1&&i-a<=.1},s.blacklistCurrentPlaylist=function(t,e){void 0===t&&(t={});var i=t.playlist||this.masterPlaylistLoader_.media();if(e=e||t.blacklistDuration||this.blacklistDuration,!i)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));var r=1===this.masterPlaylistLoader_.master.playlists.filter(j).length,a=this.masterPlaylistLoader_.master.playlists;if(1===a.length)return n.log.warn("Problem encountered with the current playlist. Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(r);r&&(n.log.warn("Removing all playlists from the blacklist because the last rendition is about to be blacklisted."),a.forEach(function(t){t.excludeUntil!==1/0&&delete t.excludeUntil}),this.tech_.trigger("retryplaylist")),i.excludeUntil=Date.now()+1e3*e,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});var s=this.selectPlaylist();return n.log.warn("Problem encountered with the current playlist."+(t.message?" "+t.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(s,r)},s.pauseLoading=function(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()},s.setCurrentTime=function(t){var e=vt(this.tech_.buffered(),t);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?e&&e.length?t:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},s.duration=function(){if(!this.masterPlaylistLoader_)return 0;var t=this.masterPlaylistLoader_.media();return t?t.endList?this.mediaSource?this.mediaSource.duration:xi.Playlist.duration(t):1/0:0},s.seekable=function(){return this.seekable_},s.onSyncInfoUpdate_=function(){var t;if(this.masterPlaylistLoader_){var e=this.masterPlaylistLoader_.media();if(e){var i=this.syncController_.getExpiredTime(e,this.duration());if(null!==i){var r=xi.Playlist.seekable(e,i);if(0!==r.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(e=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(e,this.duration())))return;if(0===(t=xi.Playlist.seekable(e,i)).length)return}var a,s;this.seekable_&&this.seekable_.length&&(a=this.seekable_.end(0),s=this.seekable_.start(0)),t?t.start(0)>r.end(0)||r.start(0)>t.end(0)?this.seekable_=r:this.seekable_=n.createTimeRanges([[t.start(0)>r.start(0)?t.start(0):r.start(0),t.end(0)<r.end(0)?t.end(0):r.end(0)]]):this.seekable_=r,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===a&&this.seekable_.start(0)===s||(this.logger_("seekable updated ["+Tt(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},s.updateDuration=function(t){if("open"===this.mediaSource.readyState)if(t){var e=this.seekable();if(!e.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1))}else{var i=this.tech_.buffered(),n=xi.Playlist.duration(this.masterPlaylistLoader_.media());i.length>0&&(n=Math.max(n,i.end(i.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}else this.mediaSource.addEventListener("sourceopen",this.updateDuration.bind(this,t))},s.dispose=function(){var t=this;this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),["AUDIO","SUBTITLES"].forEach(function(e){var i=t.mediaTypes_[e].groups;for(var n in i)i[n].forEach(function(t){t.playlistLoader&&t.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose()},s.master=function(){return this.masterPlaylistLoader_.master},s.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},s.tryToCreateSourceBuffers_=function(){if("open"===this.mediaSource.readyState&&!this.sourceUpdater_.ready()){var t=this.mainSegmentLoader_.startingMedia_,e=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(t&&(!e||this.audioSegmentLoader_.startingMedia_)){var i=this.audioSegmentLoader_&&this.audioSegmentLoader_.startingMedia_||{},r=this.masterPlaylistLoader_.media(),a=function(t,e){var i=e.attributes||{},n=function(t){var e=t.attributes||{};if(e.CODECS)return Qe(e.CODECS)}(e)||{};Ke(t,e)&&!n.audioProfile&&(function(t,e){if(!Ke(t,e))return!0;var i=e.attributes||{},n=t.mediaGroups.AUDIO[i.AUDIO];for(var r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1}(t,e)||(n.audioProfile=function(t,e){if(!t.mediaGroups.AUDIO||!e)return null;var i=t.mediaGroups.AUDIO[e];if(!i)return null;for(var n in i){var r=i[n];if(r.default&&r.playlists)return Qe(r.playlists[0].attributes.CODECS).audioProfile}return null}(t,i.AUDIO)));var r={};return n.videoCodec&&(r.video=Ye(""+n.videoCodec+n.videoObjectTypeIndicator)),n.audioProfile&&(r.audio=Ye("mp4a.40."+n.audioProfile)),r}(this.masterPlaylistLoader_.master,r),s={};if(t.isMuxed?(s.video=a.video||t.videoCodec||"avc1.4d400d",s.video+=","+(a.audio||t.audioCodec||"mp4a.40.2"),e&&(s.audio=a.audio||i.audioCodec||"mp4a.40.2")):((t.hasAudio||e)&&(s.audio=a.audio||t.audioCodec||i.audioCodec||"mp4a.40.2"),t.hasVideo&&(s.video=a.video||t.videoCodec||"avc1.4d400d")),!s.video&&!s.audio){var o="Failed to create SourceBuffers. No compatible SourceBuffer configuration for the variant stream:"+r.resolvedUri;n.log.warn(o),this.error=o,"open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("decode")}try{this.sourceUpdater_.createSourceBuffers(s)}catch(t){var u="Failed to create SourceBuffers: "+t;return n.log.warn(u),this.error=u,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("decode"))}this.excludeIncompatibleVariants_(r)}}},s.excludeUnsupportedVariants_=function(){this.master().playlists.forEach(function(t){var e;t.attributes.CODECS&&i.MediaSource&&i.MediaSource.isTypeSupported&&!i.MediaSource.isTypeSupported('video/mp4; codecs="'+(e=t.attributes.CODECS,e.replace(/avc1\.(\d+)\.(\d+)/i,function(t){return(e=[t],e.map(Ye))[0];var e}))+'"')&&(t.excludeUntil=1/0)})},s.excludeIncompatibleVariants_=function(t){var e,i=2,n=null;t.attributes.CODECS&&(e=Qe(t.attributes.CODECS),n=e.videoCodec,i=e.codecCount),this.master().playlists.forEach(function(t){var e={codecCount:2,videoCodec:null};t.attributes.CODECS&&(e=Qe(t.attributes.CODECS)),e.codecCount!==i&&(t.excludeUntil=1/0),e.videoCodec!==n&&(t.excludeUntil=1/0)})},s.updateAdCues_=function(t){var e=0,n=this.seekable();n.length&&(e=n.start(0)),function(t,e,n){if(void 0===n&&(n=0),t.segments)for(var r,a=n,s=0;s<t.segments.length;s++){var o=t.segments[s];if(r||(r=Qi(e,a+o.duration/2)),r){if("cueIn"in o){r.endTime=a,r.adEndTime=a,a+=o.duration,r=null;continue}if(a<r.endTime){a+=o.duration;continue}r.endTime+=o.duration}else if("cueOut"in o&&((r=new i.VTTCue(a,a+o.duration,o.cueOut)).adStartTime=a,r.adEndTime=a+parseFloat(o.cueOut),e.addCue(r)),"cueOutCont"in o){var u=o.cueOutCont.split("/").map(parseFloat),d=u[0],l=u[1];(r=new i.VTTCue(a,a+o.duration,"")).adStartTime=a-d,r.adEndTime=r.adStartTime+l,e.addCue(r)}a+=o.duration}}(t,this.cueTagsTrack_,e)},s.goalBufferLength=function(){var t=this.tech_.currentTime(),e=Se.GOAL_BUFFER_LENGTH,i=Se.GOAL_BUFFER_LENGTH_RATE,n=Math.max(e,Se.MAX_GOAL_BUFFER_LENGTH);return Math.min(e+t*i,n)},s.bufferLowWaterLine=function(){var t=this.tech_.currentTime(),e=Se.BUFFER_LOW_WATER_LINE,i=Se.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(e,Se.MAX_BUFFER_LOW_WATER_LINE);return Math.min(e+t*i,n)},e}(n.EventTarget),hn=function(t,e,i){var n,r,a,s=t.masterPlaylistController_,o=s[(t.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(s);if(e.attributes.RESOLUTION){var u=e.attributes.RESOLUTION;this.width=u.width,this.height=u.height}this.bandwidth=e.attributes.BANDWIDTH,this.id=i,this.enabled=(n=t.playlists,r=e.uri,a=o,function(t){var e=n.master.playlists[r],i=W(e),s=j(e);return void 0===t?s:(t?delete e.disabled:e.disabled=!0,t===s||i||(a(),t?n.trigger("renditionenabled"):n.trigger("renditiondisabled")),t)})},cn=["seeking","seeked","pause","playing","error"],fn=function(){function t(t){var e=this;this.tech_=t.tech,this.seekable=t.seekable,this.seekTo=t.seekTo,this.allowSeeksWithinUnsafeLiveWindow=t.allowSeeksWithinUnsafeLiveWindow,this.media=t.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=ki("PlaybackWatcher"),this.logger_("initialize");var n=function(){return e.monitorCurrentTime_()},r=function(){return e.techWaiting_()},a=function(){return e.cancelTimer_()},s=function(){return e.fixesBadSeeks_()};this.tech_.on("seekablechanged",s),this.tech_.on("waiting",r),this.tech_.on(cn,a),this.tech_.on("canplay",n),this.dispose=function(){e.logger_("dispose"),e.tech_.off("seekablechanged",s),e.tech_.off("waiting",r),e.tech_.off(cn,a),e.tech_.off("canplay",n),e.checkCurrentTimeTimeout_&&i.clearTimeout(e.checkCurrentTimeTimeout_),e.cancelTimer_()}}var e=t.prototype;return e.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&i.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=i.setTimeout(this.monitorCurrentTime_.bind(this),250)},e.checkCurrentTime_=function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var t=this.tech_.currentTime(),e=this.tech_.buffered();if(this.lastRecordedTime===t&&(!e.length||t+.1>=e.end(e.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&t===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):t===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=t)}},e.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},e.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var t,e=this.seekable(),i=this.tech_.currentTime();if(this.afterSeekableWindow_(e,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(t=e.end(e.length-1)),this.beforeSeekableWindow_(e,i)){var n=e.start(0);t=n+(n===e.end(0)?0:.1)}return void 0!==t&&(this.logger_("Trying to seek outside of seekable at time "+i+" with seekable range "+Tt(e)+". Seeking to "+t+"."),this.seekTo(t),!0)},e.waiting_=function(){if(!this.techWaiting_()){var t=this.tech_.currentTime(),e=this.tech_.buffered(),i=vt(e,t);return i.length&&t+3<=i.end(0)?(this.cancelTimer_(),this.seekTo(t),this.logger_("Stopped at "+t+" while inside a buffered region ["+i.start(0)+" -> "+i.end(0)+"]. Attempting to resume playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}},e.techWaiting_=function(){var t=this.seekable(),e=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(t,e)){var i=t.end(t.length-1);return this.logger_("Fell out of live window at time "+e+". Seeking to live point (seekable end) "+i),this.cancelTimer_(),this.seekTo(i),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var n=this.tech_.buffered(),r=bt(n,e);if(this.videoUnderflow_(r,n,e))return this.cancelTimer_(),this.seekTo(e),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;if(r.length>0){var a=r.start(0)-e;return this.logger_("Stopped at "+e+", setting timer for "+a+", seeking to "+r.start(0)),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*a,e),!0}return!1},e.afterSeekableWindow_=function(t,e,i,n){if(void 0===n&&(n=!1),!t.length)return!1;var r=t.end(t.length-1)+.1;return!i.endList&&n&&(r=t.end(t.length-1)+3*i.targetDuration),e>r},e.beforeSeekableWindow_=function(t,e){return!!(t.length&&t.start(0)>0&&e<t.start(0)-.1)},e.videoUnderflow_=function(t,e,i){if(0===t.length){var n=this.gapFromVideoUnderflow_(e,i);if(n)return this.logger_("Encountered a gap in video from "+n.start+" to "+n.end+". Seeking to current time "+i),!0}return!1},e.skipTheGap_=function(t){var e=this.tech_.buffered(),i=this.tech_.currentTime(),n=bt(e,i);this.cancelTimer_(),0!==n.length&&i===t&&(this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",t,"nextRange start:",n.start(0)),this.seekTo(n.start(0)+1/30),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},e.gapFromVideoUnderflow_=function(t,e){for(var i=function(t){if(t.length<2)return n.createTimeRanges();for(var e=[],i=1;i<t.length;i++){var r=t.end(i-1),a=t.start(i);e.push([r,a])}return n.createTimeRanges(e)}(t),r=0;r<i.length;r++){var a=i.start(r),s=i.end(r);if(e-a<4&&e-a>2)return{start:a,end:s}}return null},t}(),pn={errorInterval:30,getSource:function(t){return t(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_)}},mn=function(t){!function t(e,i){var r=0,a=0,s=n.mergeOptions(pn,i);e.ready(function(){e.trigger({type:"usage",name:"hls-error-reload-initialized"})});var o=function(){a&&e.currentTime(a)},u=function(t){null!=t&&(a=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",o),e.src(t),e.trigger({type:"usage",name:"hls-error-reload"}),e.play())},d=function(){if(Date.now()-r<1e3*s.errorInterval)e.trigger({type:"usage",name:"hls-error-reload-canceled"});else{if(s.getSource&&"function"==typeof s.getSource)return r=Date.now(),s.getSource.call(e,u);n.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function t(){e.off("loadedmetadata",o),e.off("error",d),e.off("dispose",t)};e.on("error",d),e.on("dispose",l),e.reloadSourceOnError=function(i){l(),t(e,i)}}(this,t)};n.use("*",function(t){return{setSource:function(t,e){e(null,t)},setCurrentTime:function(e){return t.vhs&&t.currentSource().src===t.vhs.source_.src&&t.vhs.setCurrentTime(e),e},play:function(){t.vhs&&t.currentSource().src===t.vhs.source_.src&&t.vhs.setCurrentTime(t.tech_.currentTime())}}});var gn={PlaylistLoader:D,Playlist:Y,Decrypter:dt,AsyncStream:st,decrypt:ut,utils:yt,STANDARD_PLAYLIST_SELECTOR:function(){return function(t,e,n,r,a){var s=t.playlists.map(function(t){var e=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width,n=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.height;return{bandwidth:t.attributes.BANDWIDTH||i.Number.MAX_VALUE,width:e,height:n,playlist:t}});gi(s,function(t,e){return t.bandwidth-e.bandwidth});var o=(s=s.filter(function(t){return!Y.isIncompatible(t.playlist)})).filter(function(t){return Y.isEnabled(t.playlist)});o.length||(o=s.filter(function(t){return!Y.isDisabled(t.playlist)}));var u=o.filter(function(t){return t.bandwidth*Se.BANDWIDTH_VARIANCE<e}),d=u[u.length-1],l=u.filter(function(t){return t.bandwidth===d.bandwidth})[0];if(!1===a){var h=l||o[0]||s[0];return h?h.playlist:null}var c=u.filter(function(t){return t.width&&t.height});gi(c,function(t,e){return t.width-e.width});var f=c.filter(function(t){return t.width===n&&t.height===r});d=f[f.length-1];var p,m,g,y=f.filter(function(t){return t.bandwidth===d.bandwidth})[0];y||(m=(p=c.filter(function(t){return t.width>n||t.height>r})).filter(function(t){return t.width===p[0].width&&t.height===p[0].height}),d=m[m.length-1],g=m.filter(function(t){return t.bandwidth===d.bandwidth})[0]);var _=g||y||l||o[0]||s[0];return _?_.playlist:null}(this.playlists.master,this.systemBandwidth,parseInt(mi(this.tech_.el(),"width"),10),parseInt(mi(this.tech_.el(),"height"),10),this.limitRenditionByPlayerDimensions)},INITIAL_PLAYLIST_SELECTOR:function(){var t=this.playlists.master.playlists.filter(Y.isEnabled);return gi(t,function(t,e){return yi(t,e)}),t.filter(function(t){return Qe(t.attributes.CODECS).videoCodec})[0]||null},comparePlaylistBandwidth:yi,comparePlaylistResolution:function(t,e){var n,r;return t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(n=t.attributes.RESOLUTION.width),n=n||i.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(r=e.attributes.RESOLUTION.width),n===(r=r||i.Number.MAX_VALUE)&&t.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?t.attributes.BANDWIDTH-e.attributes.BANDWIDTH:n-r},xhr:$()};["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(t){Object.defineProperty(gn,t,{get:function(){return n.log.warn("using Hls."+t+" is UNSAFE be sure you know what you are doing"),Se[t]},set:function(e){n.log.warn("using Hls."+t+" is UNSAFE be sure you know what you are doing"),"number"!=typeof e||e<0?n.log.warn("value of Hls."+t+" must be greater than or equal to 0"):Se[t]=e}})});var yn=function(t){return/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(t)?"hls":/^application\/dash\+xml/i.test(t)?"dash":null},_n=function(t,e){for(var i=e.media(),n=-1,r=0;r<t.length;r++)if(t[r].id===i.uri){n=r;break}t.selectedIndex_=n,t.trigger({selectedIndex:n,type:"change"})};gn.canPlaySource=function(){return n.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var vn,bn=function(t,e,i){if(!t)return t;var r={};for(var a in t)r[a]={audioContentType:'audio/mp4; codecs="'+i.attributes.CODECS+'"',videoContentType:'video/mp4; codecs="'+e.attributes.CODECS+'"'},e.contentProtection&&e.contentProtection[a]&&e.contentProtection[a].pssh&&(r[a].pssh=e.contentProtection[a].pssh),"string"==typeof t[a]&&(r[a].url=t[a]);return n.mergeOptions(t,r)},Tn=function(){if(!i.localStorage)return null;var t=i.localStorage.getItem("videojs-vhs");if(!t)return null;try{return JSON.parse(t)}catch(t){return null}};gn.supportsNativeHls=(vn=e.createElement("video"),!!n.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(vn.canPlayType(t))})),gn.supportsNativeDash=!!n.getTech("Html5").isSupported()&&/maybe|probably/i.test(e.createElement("video").canPlayType("application/dash+xml")),gn.supportsTypeNatively=function(t){return"hls"===t?gn.supportsNativeHls:"dash"===t&&gn.supportsNativeDash},gn.isSupported=function(){return n.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Sn=function(t){function s(i,r,s){var o;if(o=t.call(this,r,s.hls)||this,r.options_&&r.options_.playerId){var u=n(r.options_.playerId);u.hasOwnProperty("hls")||Object.defineProperty(u,"hls",{get:function(){return n.log.warn("player.hls is deprecated. Use player.tech().hls instead."),r.trigger({type:"usage",name:"hls-player-access"}),a(o)},configurable:!0}),u.vhs=a(o),u.dash=a(o),o.player_=u}if(o.tech_=r,o.source_=i,o.stats={},o.setOptions_(),o.options_.overrideNative&&r.overrideNativeAudioTracks&&r.overrideNativeVideoTracks)r.overrideNativeAudioTracks(!0),r.overrideNativeVideoTracks(!0);else if(o.options_.overrideNative&&(r.featuresNativeVideoTracks||r.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return o.on(e,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(t){var i=e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement;i&&i.contains(o.tech_.el())&&o.masterPlaylistController_.smoothQualityChange_()}),o.on(o.tech_,"seeking",function(){0===this.tech_.currentTime()&&this.tech_.player_.loop()&&this.setCurrentTime(0)}),o.on(o.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),o.on(o.tech_,"play",o.play),o}r(s,t);var o=s.prototype;return o.setOptions_=function(){var t=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=this.options_.handleManifestRedirects||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.handlePartialData=this.options_.handlePartialData||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var e=Tn();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=Se.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Se.INITIAL_BANDWIDTH,["withCredentials","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","handlePartialData"].forEach(function(e){void 0!==t.source_[e]&&(t.options_[e]=t.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions},o.src=function(t,e){var r=this;t&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=gn,this.options_.sourceType=yn(e),this.options_.seekTo=function(t){r.tech_.setCurrentTime(t),r.setCurrentTime(t)},this.masterPlaylistController_=new ln(this.options_),this.playbackWatcher_=new fn(n.mergeOptions(this.options_,{seekable:function(){return r.seekable()},media:function(){return r.masterPlaylistController_.media()}})),this.masterPlaylistController_.on("error",function(){n.players[r.tech_.options_.playerId].error(r.masterPlaylistController_.error)}),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):gn.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=gn.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(t){this.masterPlaylistController_.selectPlaylist=t.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(t){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=t,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(t){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=t,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var t,e=1/(this.bandwidth||1);return t=this.throughput>0?1/this.throughput:0,Math.floor(1/(e+t))},set:function(){n.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return r.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return r.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return r.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return r.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return r.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return r.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return r.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return r.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return St(r.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return r.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return r.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return r.tech_.name_},enumerable:!0},duration:{get:function(){return r.tech_.duration()},enumerable:!0},master:{get:function(){return r.playlists.master},enumerable:!0},playerDimensions:{get:function(){return r.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return St(r.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return r.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){r.options_.useBandwidthFromLocalStorage&&function(t){if(!i.localStorage)return!1;var e=Tn();e=e?n.mergeOptions(e,t):t;try{i.localStorage.setItem("videojs-vhs",JSON.stringify(e))}catch(t){return!1}}({bandwidth:r.bandwidth,throughput:Math.round(r.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){var t,e;e=(t=r).playlists,t.representations=function(){return e.master.playlists.filter(function(t){return!W(t)}).map(function(e,i){return new hn(t,e,e.uri)})},function(t){if("dash"===t.options_.sourceType){var e=n.players[t.tech_.options_.playerId];if(e.eme){var i=bn(t.source_.keySystems,t.playlists.media(),t.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader.media());i&&(e.currentSource().keySystems=i,e.eme.initializeMediaKeys&&e.eme.initializeMediaKeys())}}}(r)}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.tech_.ready(function(){return r.setupQualityLevels_()}),this.tech_.el()&&this.tech_.src(i.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))},o.setupQualityLevels_=function(){var t=this,e=n.players[this.tech_.options_.playerId];e&&e.qualityLevels&&(this.qualityLevels_=e.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){var e,i;e=t.qualityLevels_,(i=t).representations().forEach(function(t){e.addQualityLevel(t)}),_n(e,i.playlists)}),this.playlists.on("mediachange",function(){_n(t.qualityLevels_,t.playlists)}))},s.version=function(){return{"@videojs/http-streaming":"1.11.0-alpha.1","mux.js":"5.2.1","mpd-parser":"0.8.1","m3u8-parser":"4.4.0","aes-decrypter":"3.0.0"}},o.version=function(){return this.constructor.version()},o.play=function(){this.masterPlaylistController_.play()},o.setCurrentTime=function(t){this.masterPlaylistController_.setCurrentTime(t)},o.duration=function(){return this.masterPlaylistController_.duration()},o.seekable=function(){return this.masterPlaylistController_.seekable()},o.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.hls&&delete this.tech_.hls,t.prototype.dispose.call(this)},o.convertToProgramTime=function(t,e){return function(t){var e=t.playlist,i=t.time,n=void 0===i?void 0:i,r=t.callback;if(!r)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===n)return r({message:"getProgramTime: playlist and time must be provided"});var a=function(t,e){if(!e||!e.segments||0===e.segments.length)return null;for(var i,n=0,r=0;r<e.segments.length&&!(t<=(n=(i=e.segments[r]).videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration));r++);var a=e.segments[e.segments.length-1];if(a.videoTimingInfo&&a.videoTimingInfo.transmuxedPresentationEnd<t)return null;if(t>n){if(t>n+.25*a.duration)return null;i=a}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}}(n,e);if(!a)return r({message:"valid programTime was not found"});if("estimate"===a.type)return r({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:a.estimatedStart});var s={mediaSeconds:n},o=function(t,e){if(!e.dateTimeObject)return null;var i=e.videoTimingInfo.transmuxerPrependedSeconds,n=t-(e.videoTimingInfo.transmuxedPresentationStart+i);return new Date(e.dateTimeObject.getTime()+1e3*n)}(n,a.segment);return o&&(s.programDateTime=o.toISOString()),r(null,s)}({playlist:this.masterPlaylistController_.media(),time:t,callback:e})},o.seekToProgramTime=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=2),function t(e){var i=e.programTime,n=e.playlist,r=e.retryCount,a=void 0===r?2:r,s=e.seekTo,o=e.pauseAfterSeek,u=void 0===o||o,d=e.tech,l=e.callback;if(!l)throw new Error("seekToProgramTime: callback must be provided");if(void 0===i||!n||!s)return l({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!n.endList&&!d.hasStarted_)return l({message:"player must be playing a live stream to start buffering"});if(!function(t){if(!t.segments||0===t.segments.length)return!1;for(var e=0;e<t.segments.length;e++)if(!t.segments[e].dateTimeObject)return!1;return!0}(n))return l({message:"programDateTime tags must be provided in the manifest "+n.resolvedUri});var h=function(t,e){var i;try{i=new Date(t)}catch(t){return null}if(!e||!e.segments||0===e.segments.length)return null;var n=e.segments[0];if(i<n.dateTimeObject)return null;for(var r=0;r<e.segments.length-1&&(n=e.segments[r],!(i<e.segments[r+1].dateTimeObject));r++);var a,s=e.segments[e.segments.length-1],o=s.dateTimeObject,u=s.videoTimingInfo?(a=s.videoTimingInfo).transmuxedPresentationEnd-a.transmuxedPresentationStart-a.transmuxerPrependedSeconds:s.duration+.25*s.duration;return i>new Date(o.getTime()+1e3*u)?null:(i>o&&(n=s),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:Y.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})}(i,n);if(!h)return l({message:i+" was not found in the stream"});var c=h.segment,f=function(t,e){var i,n;try{i=new Date(t),n=new Date(e)}catch(t){}var r=i.getTime();return(n.getTime()-r)/1e3}(c.dateTimeObject,i);if("estimate"===h.type)return 0===a?l({message:i+" is not buffered yet. Try again"}):(s(h.estimatedStart+f),void d.one("seeked",function(){t({programTime:i,playlist:n,retryCount:a-1,seekTo:s,pauseAfterSeek:u,tech:d,callback:l})}));var p=c.start+f;d.one("seeked",function(){return l(null,d.currentTime())}),u&&d.pause(),s(p)}({programTime:t,playlist:this.masterPlaylistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:e})},s}(n.getComponent("Component")),In={name:"videojs-http-streaming",VERSION:"1.11.0-alpha.1",canHandleSource:function(t,e){void 0===e&&(e={});var i=n.mergeOptions(n.options,e);return In.canPlayType(t.type,i)},handleSource:function(t,e,i){void 0===i&&(i={});var r=n.mergeOptions(n.options,i);return e.hls=new Sn(t,e,r),e.hls.xhr=$(),e.hls.src(t.src,t.type),e.hls},canPlayType:function(t,e){void 0===e&&(e={});var i=n.mergeOptions(n.options,e).hls.overrideNative,r=yn(t);return!r||gn.supportsTypeNatively(r)&&!i?"":"maybe"}};i.MediaSource&&i.MediaSource.isTypeSupported&&i.MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')&&n.getTech("Html5").registerSourceHandler(In,0),n.HlsHandler=Sn,n.HlsSourceHandler=In,n.Hls=gn,n.use||n.registerComponent("Hls",gn),n.options.hls=n.options.hls||{},n.registerPlugin?n.registerPlugin("reloadSourceOnError",mn):n.plugin("reloadSourceOnError",mn),t.Hls=gn,t.HlsHandler=Sn,t.HlsSourceHandler=In,t.LOCAL_STORAGE_KEY="videojs-vhs",t.emeKeySystems=bn,t.simpleTypeFromSourceType=yn,Object.defineProperty(t,"__esModule",{value:!0})});
